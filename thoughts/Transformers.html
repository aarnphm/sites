<!DOCTYPE html>
<!--
/*************************************************************************
* Bop got your nose !!!
*
* Hehe
*
* Anw if you see a component you like ping @aarnphm on Discord I can try
* to send it your way. Have a wonderful day!
**************************************************************************/
-->
<html lang="fr">
  <head>
    <title>
      Transformers - Aaron's notes
    </title>
    <meta charset="utf-8"/>
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains Mono&amp;family=Newsreader:wght@400;700&amp;family=Newsreader:ital,wght@0,400;0,600;1,400;1,600&amp;display=swap"/>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="true"/>
    <link rel="preconnect" href="https://plausible.io" crossorigin="true"/>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="og:site_name" content="Aaron's notes"/>
    <meta property="og:locale" content="fr-FR"/>
    <meta property="og:title" content="Transformers - Aaron's notes"/>
    <meta property="og:type" content="website"/>
    <meta name="twitter:site" content="@aarnphm_"/>
    <meta name="twitter:creator" content="@aarnphm_"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:title" content="Transformers - Aaron's notes"/>
    <meta name="twitter:description" content="See also: LLMs, embedding, visualisation from Brendan Bycroft A multi-layer perceptron (MLP) architecture built on top of a multi-head attention mechanism (Vaswani et al., 2023) ..."/>
    <meta property="og:description" content="See also: LLMs, embedding, visualisation from Brendan Bycroft A multi-layer perceptron (MLP) architecture built on top of a multi-head attention mechanism (Vaswani et al., 2023) ..."/>
    <meta property="og:image:type" content="image/webp"/>
    <meta property="og:image:alt" content="See also: LLMs, embedding, visualisation from Brendan Bycroft A multi-layer perceptron (MLP) architecture built on top of a multi-head attention mechanism (Vaswani et al., 2023) ..."/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta property="og:width" content="1200"/>
    <meta property="og:height" content="630"/>
    <meta property="og:image" content="https://aarnphm.xyz/static/social-images/thoughts-Transformers.webp"/>
    <meta property="og:url" content="https:/aarnphm.xyz/thoughts/Transformers"/>
    <meta property="og:image" content="https://aarnphm.xyz/static/social-images/thoughts-Transformers.webp"/>
    <meta name="twitter:image" content="https://aarnphm.xyz/static/social-images/thoughts-Transformers.webp"/>
    <meta property="twitter:domain" content="https://aarnphm.xyz/"/>
    <meta property="twitter:url" content="https:/aarnphm.xyz/thoughts/Transformers"/>
    <link rel="icon" href="../static/icon.webp"/>
    <link rel="canonical" href="https:/aarnphm.xyz/thoughts/Transformers"/>
    <meta name="description" content="See also: LLMs, embedding, visualisation from Brendan Bycroft A multi-layer perceptron (MLP) architecture built on top of a multi-head attention mechanism (Vaswani et al., 2023) ..."/>
    <meta name="generator" content="Quartz"/>
    <link href="../index.css" rel="stylesheet" type="text/css" spa-preserve/>
    <style>
      .collapsible-header {
      position: relative;
      margin-left: -9px;
      }
      .collapsible-header:first-child {
      margin-top: 1rem;
      }
      .collapsible-header:last-child {
      margin-bottom: 1rem;
      }
      .collapsible-header[data-level=&quot;2&quot;] {
      margin-left: 1rem;
      }
      .collapsible-header[data-level=&quot;3&quot;] {
      margin-left: 1.5rem;
      }
      .collapsible-header[data-level=&quot;4&quot;] {
      margin-left: 1.9rem;
      }
      .collapsible-header[data-level=&quot;5&quot;] {
      margin-left: 2.2rem;
      }
      .collapsible-header[data-level=&quot;6&quot;] {
      margin-left: 2.4rem;
      }
      .collapsible-header .collapsed-dots {
      display: none;
      }
      .collapsible-header.collapsed {
      margin-bottom: 1rem;
      }
      .collapsible-header.collapsed .collapsed-dots {
      display: block;
      }
      .collapsible-header .header-controls {
      display: grid;
      grid-template-columns: auto 1fr;
      align-items: center;
      }
      .collapsible-header .header-controls .toggle-button {
      grid-column: 1;
      }
      .collapsible-header .toggle-button {
      background-color: transparent;
      border: none;
      text-align: left;
      cursor: pointer;
      padding: 0;
      color: var(--dark);
      display: inline-flex;
      align-items: center;
      }
      .collapsible-header .toggle-button:hover .circle-icon {
      display: none;
      }
      .collapsible-header .toggle-button:hover[aria-expanded=true] .collapse-icon {
      display: block;
      }
      .collapsible-header .toggle-button:hover[aria-expanded=true] .expand-icon {
      display: none;
      }
      .collapsible-header .toggle-button:hover[aria-expanded=false] .expand-icon {
      display: block;
      }
      .collapsible-header .toggle-button:hover[aria-expanded=false] .collapse-icon {
      display: none;
      }
      .collapsible-header .toggle-icons {
      display: grid;
      grid-template-columns: 1fr;
      }
      .collapsible-header .toggle-icons .circle-icon,
      .collapsible-header .toggle-icons .expand-icon,
      .collapsible-header .toggle-icons .collapse-icon {
      opacity: 0.85;
      grid-column: 1;
      grid-row: 1;
      }
      .collapsible-header .toggle-icons .circle-icon {
      display: block;
      }
      .collapsible-header .toggle-icons .expand-icon,
      .collapsible-header .toggle-icons .collapse-icon {
      display: none;
      }
      .collapsible-header.collapsed :where(h1, h2, h3, h4, h5, h6):not(.popover *) {
      display: inline-flex;
      align-items: center;
      }
      .collapsible-header :where(h1, h2, h3, h4, h5, h6):not(.popover *) {
      margin: 0;
      }
      .collapsible-header .collapsible-header-content-outer {
      padding-left: 9px;
      padding-bottom: 9px;
      }
      .collapsible-header .collapsible-header-content-outer .collapsible-header-content {
      border-left: 1px solid var(--lightgray);
      overflow: hidden;
      padding-left: 9px;
      max-height: none;
      }
      .collapsible-header .collapsible-header-content-outer .collapsible-header-content.collapsed {
      max-height: 0 !important;
      padding-top: 0;
      padding-bottom: 0;
      }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/node-tikzjax@latest/css/fonts.css" rel="stylesheet" type="text/css" spa-preserve/>
    <link href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" rel="stylesheet" type="text/css" spa-preserve/>
    <script src="../prescript.js" type="application/javascript" spa-preserve></script>
    <script type="application/javascript" spa-preserve>
      const fetchData = fetch("../static/contentIndex.json").then(data => data.json())
    </script>
    <script type="application/javascript" spa-preserve>
      var T=Object.create;var g=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var k=Object.getPrototypeOf,O=Object.prototype.hasOwnProperty;var q=(e,u)=>()=>(u||e((u={exports:{}}).exports,u),u.exports);var P=(e,u,t,F)=>{if(u&&typeof u=="object"||typeof u=="function")for(let o of j(u))!O.call(e,o)&&o!==t&&g(e,o,{get:()=>u[o],enumerable:!(F=R(u,o))||F.enumerable});return e};var U=(e,u,t)=>(t=e!=null?T(k(e)):{},P(u||!e||!e.__esModule?g(t,"default",{value:e,enumerable:!0}):t,e));var m=q((X,p)=>{"use strict";p.exports=W;function A(e){return e instanceof Buffer?Buffer.from(e):new e.constructor(e.buffer.slice(),e.byteOffset,e.length)}function W(e){if(e=e||{},e.circles)return $(e);let u=new Map;if(u.set(Date,D=>new Date(D)),u.set(Map,(D,i)=>new Map(F(Array.from(D),i))),u.set(Set,(D,i)=>new Set(F(Array.from(D),i))),e.constructorHandlers)for(let D of e.constructorHandlers)u.set(D[0],D[1]);let t=null;return e.proto?l:o;function F(D,i){let n=Object.keys(D),r=new Array(n.length);for(let c=0;c<n.length;c++){let s=n[c],a=D[s];typeof a!="object"||a===null?r[s]=a:a.constructor!==Object&&(t=u.get(a.constructor))?r[s]=t(a,i):ArrayBuffer.isView(a)?r[s]=A(a):r[s]=i(a)}return r}function o(D){if(typeof D!="object"||D===null)return D;if(Array.isArray(D))return F(D,o);if(D.constructor!==Object&&(t=u.get(D.constructor)))return t(D,o);let i={};for(let n in D){if(Object.hasOwnProperty.call(D,n)===!1)continue;let r=D[n];typeof r!="object"||r===null?i[n]=r:r.constructor!==Object&&(t=u.get(r.constructor))?i[n]=t(r,o):ArrayBuffer.isView(r)?i[n]=A(r):i[n]=o(r)}return i}function l(D){if(typeof D!="object"||D===null)return D;if(Array.isArray(D))return F(D,l);if(D.constructor!==Object&&(t=u.get(D.constructor)))return t(D,l);let i={};for(let n in D){let r=D[n];typeof r!="object"||r===null?i[n]=r:r.constructor!==Object&&(t=u.get(r.constructor))?i[n]=t(r,l):ArrayBuffer.isView(r)?i[n]=A(r):i[n]=l(r)}return i}}function $(e){let u=[],t=[],F=new Map;if(F.set(Date,n=>new Date(n)),F.set(Map,(n,r)=>new Map(l(Array.from(n),r))),F.set(Set,(n,r)=>new Set(l(Array.from(n),r))),e.constructorHandlers)for(let n of e.constructorHandlers)F.set(n[0],n[1]);let o=null;return e.proto?i:D;function l(n,r){let c=Object.keys(n),s=new Array(c.length);for(let a=0;a<c.length;a++){let C=c[a],E=n[C];if(typeof E!="object"||E===null)s[C]=E;else if(E.constructor!==Object&&(o=F.get(E.constructor)))s[C]=o(E,r);else if(ArrayBuffer.isView(E))s[C]=A(E);else{let B=u.indexOf(E);B!==-1?s[C]=t[B]:s[C]=r(E)}}return s}function D(n){if(typeof n!="object"||n===null)return n;if(Array.isArray(n))return l(n,D);if(n.constructor!==Object&&(o=F.get(n.constructor)))return o(n,D);let r={};u.push(n),t.push(r);for(let c in n){if(Object.hasOwnProperty.call(n,c)===!1)continue;let s=n[c];if(typeof s!="object"||s===null)r[c]=s;else if(s.constructor!==Object&&(o=F.get(s.constructor)))r[c]=o(s,D);else if(ArrayBuffer.isView(s))r[c]=A(s);else{let a=u.indexOf(s);a!==-1?r[c]=t[a]:r[c]=D(s)}}return u.pop(),t.pop(),r}function i(n){if(typeof n!="object"||n===null)return n;if(Array.isArray(n))return l(n,i);if(n.constructor!==Object&&(o=F.get(n.constructor)))return o(n,i);let r={};u.push(n),t.push(r);for(let c in n){let s=n[c];if(typeof s!="object"||s===null)r[c]=s;else if(s.constructor!==Object&&(o=F.get(s.constructor)))r[c]=o(s,i);else if(ArrayBuffer.isView(s))r[c]=A(s);else{let a=u.indexOf(s);a!==-1?r[c]=t[a]:r[c]=i(s)}}return u.pop(),t.pop(),r}}});var J=Object.hasOwnProperty;var h=U(m(),1),eu=(0,h.default)();function y(e){return e.document.body.dataset.slug}function I(e,u=100){let t=e.getBoundingClientRect();return t.top>=-u&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)+u}function _(e,u){let t=e.getBoundingClientRect(),F=u.getBoundingClientRect(),o=e.parentElement?.getBoundingClientRect()||t;return F.top-o.top}function V(e,u){let t=e.getBoundingClientRect(),F=u.getBoundingClientRect();return{min:0,max:t.height-F.height}}function L(e,u,t){let F=_(u,e),o=V(t,u);F=Math.max(F,Math.min(o.min,o.max)),u.style.top=`${F}px`}function f(e,u){let t=e.querySelectorAll("a[data-footnote-ref]"),F=document.querySelector(".sidenotes");if(F)for(let o of t){let l=o.getAttribute("href")?.replace("#","sidebar-"),D=F.querySelector(`.sidenote-element[id="${l}"]`);D&&(u?(D.classList.remove("in-view"),o.classList.remove("active"),D.classList.add("collapsed")):I(o)?(D.classList.add("in-view"),o.classList.add("active"),D.classList.remove("collapsed"),L(o,D,F)):D.classList.remove("collapsed"))}}var S=(e,u)=>`${y(e)}-${u}`;function x(e,u){return localStorage.getItem(S(e,u))}function v(e,u,t){localStorage.setItem(S(e,u),t)}function b(e,u,t,F){e.setAttribute("aria-expanded",F?"false":"true"),u.style.maxHeight=F?"0px":"inherit",e.classList.toggle("collapsed",F),u.classList.toggle("collapsed",F),t.classList.toggle("collapsed",F),f(u,F)}function d(){let e=document.querySelector(".center"),u=document.querySelector(".sidenotes");if(!e||!u)return;let t=0,F=e.children;Array.from(F).forEach(l=>{let D=l.getBoundingClientRect();t+=D.height});let o=window.getComputedStyle(e);t+=parseFloat(o.paddingTop)+parseFloat(o.paddingBottom)+parseFloat(o.marginTop)+parseFloat(o.marginBottom),e.style.minHeight=`${t}px`,u.style.height=`${t}px`,u.offsetHeight,requestAnimationFrame(()=>{let l=u.querySelectorAll(".sidenote-element"),D=Array.from(l).filter(i=>i.classList.contains("in-view"));for(let i of D){let n=i.id.replace("sidebar-",""),r=e.querySelector(`a[href="#${n}"]`);r&&L(r,i,u)}})}function H(e,u){let t;return(...F)=>{clearTimeout(t),t=setTimeout(()=>e(...F),u)}}var z=H(d,150);function M(e){let u=e.target;if(!u)return;let t=u.closest(".toggle-button");if(!t||u.parentElement.classList.contains("callout"))return;let F=t.id.replace("collapsible-header-","").replace("-toggle",""),o=document.querySelector(`section.collapsible-header[id="${F}"]`);if(!o)return;e.stopPropagation();let l=document.querySelector(`.collapsible-header-content[data-references="${t.id}"]`);if(!l)return;let D=t.getAttribute("aria-expanded")==="true";t.setAttribute("aria-expanded",D?"false":"true"),l.style.maxHeight=D?"0px":"inherit",l.classList.toggle("collapsed",D),o.classList.toggle("collapsed",D),t.classList.toggle("collapsed",D),f(l,D),v(window,t.id,D?"false":"true"),requestAnimationFrame(()=>{d(),z()})}function w(){let e=document.querySelectorAll(".collapsible-header");for(let t of e){let F=t.querySelector("button.toggle-button");if(F){F.addEventListener("click",M),window.addCleanup(()=>F.removeEventListener("click",M));let o=document.querySelector(`.collapsible-header-content[data-references="${F.id}"]`);if(o){let l=x(window,F.id);l&&b(F,o,t,l==="false")}}}let u=document.querySelectorAll("svg.blockquote-link");for(let t of u){let l=function(){window.spaNavigate(new URL(o,window.location.toString()))},o=t.parentElement.dataset.href;t.addEventListener("click",l),window.addCleanup(()=>t.removeEventListener("click",l))}}document.addEventListener("nav",w);window.addEventListener("resize",w);
    </script>
  </head>
  <body data-slug="thoughts/Transformers" data-language="fr" data-menu="false" data-poem="false">
    <main id="quartz-root" class="page">
      <section id="quartz-body">
        <aside class="left sidebar">
          <div class="toc desktop-only" id="toc" data-layout="minimal">
            <nav id="toc-vertical">
              <button class="depth-0 toc-item" data-depth="0" data-href="#memory-limitations" data-for="memory-limitations" style="--animation-order:1;" aria-label="memory limitations.">
                <div class="fill"></div>
                <div class="indicator">
                  memory limitations.
                </div>
              </button>
              <button class="depth-0 toc-item" data-depth="0" data-href="#inference" data-for="inference" style="--animation-order:2;" aria-label="inference.">
                <div class="fill"></div>
                <div class="indicator">
                  inference.
                </div>
              </button>
              <button class="depth-1 toc-item" data-depth="1" data-href="#next-token-prediction" data-for="next-token-prediction" style="--animation-order:3;" aria-label="next-token prediction.">
                <div class="fill"></div>
                <div class="indicator">
                  next-token prediction.
                </div>
              </button>
              <button class="depth-0 toc-item" data-depth="0" data-href="#feynman-kac" data-for="feynman-kac" style="--animation-order:4;" aria-label="Feynman-Kac">
                <div class="fill"></div>
                <div class="indicator">
                  Feynman-Kac
                </div>
              </button>
              <button class="depth-1 toc-item" data-depth="1" data-href="#reference-label" data-for="reference-label" style="--animation-order:5;" aria-label="References">
                <div class="fill"></div>
                <div class="indicator">
                  References
                </div>
              </button>
              <button class="depth-1 toc-item" data-depth="1" data-href="#backlinks-label" data-for="backlinks-label" style="--animation-order:6;" aria-label="Liens retour">
                <div class="fill"></div>
                <div class="indicator">
                  Liens retour
                </div>
              </button>
            </nav>
          </div>
          <div class="toolbar">
            <div class="toolbar-content">
              <button class="toolbar-item pen-button" aria-label="Toggle toolbar" aria-expanded="false">
                <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="var(--darkgray)" viewBox="0 0 256 256" class="pen-icon">
                  <path d="M227.31,73.37,182.63,28.68a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H92.69A15.86,15.86,0,0,0,104,219.31L227.31,96a16,16,0,0,0,0-22.63ZM92.69,208H48V163.31l88-88L180.69,120ZM192,108.68,147.31,64l24-24L216,84.68Z"></path>
                </svg>
              </button>
              <button class="toolbar-item " id="reader-button" aria-label="Toggle reader mode" data-active="false">
                <span class="tooltip">
                  Reader mode
                </span>
                <svg class="reader-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                </svg>
              </button>
              <button class="toolbar-item " id="pdf-button" aria-label="Export to PDF">
                <span class="tooltip">
                  Export PDF
                </span>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                  <polyline points="14 2 14 8 20 8"></polyline>
                  <line x1="16" y1="13" x2="8" y2="13"></line>
                  <line x1="16" y1="17" x2="8" y2="17"></line>
                  <line x1="10" y1="9" x2="8" y2="9"></line>
                </svg>
              </button>
              <button class="toolbar-item " id="graph-button" aria-label="Toggle global graph">
                <span class="tooltip">
                  Global graph
                </span>
                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 55 55" fill="currentColor" xml:space="preserve">
                  <path d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
                s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
                c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
                C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
                c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
                v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
                s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
                C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
                S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
                s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
                s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"></path>
                </svg>
              </button>
              <button class="toolbar-item " id="skew-button" aria-label="add a tiny bit of skew, cuz why not">
                <span class="tooltip">
                  Skew page
                </span>
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 4l18 16"></path>
                  <path d="M21 4H3"></path>
                  <path d="M21 20H3"></path>
                </svg>
              </button>
            </div>
          </div>
        </aside>
        <section class="center">
          <div class="page-header">
            <header>
              <nav class="breadcrumb-container" aria-label="breadcrumbs">
                <div class="breadcrumb-element">
                  <a href="../">
                    ~
                  </a>
                  <p>
                    /
                  </p>
                </div>
                <div class="breadcrumb-element">
                  <a href="../thoughts/">
                    t
                  </a>
                  <p>
                    /
                  </p>
                </div>
                <div class="breadcrumb-element">
                  <a href>
                    Transformers
                  </a>
                </div>
              </nav>
              <div class="keybind" lang="fr">
                <kbd id="shortcut-key" data-mapping="[&quot;cmd--'&quot;,&quot;ctrl--'&quot;]">
                  ⌘ '
                </kbd>
                <div id="shortcut-container">
                  <div id="shortcut-space">
                    <div id="title">
                      raccourcis clavier
                    </div>
                    <ul id="shortcut-list">
                      <li>
                        <div id="shortcuts" data-key="⌘--/" data-value="recherche"></div>
                      </li>
                      <li>
                        <div id="shortcuts" data-key="⌘--\" data-value="page d'accueil"></div>
                      </li>
                      <li>
                        <div id="shortcuts" data-key="⌘--j" data-value="curius"></div>
                      </li>
                      <li>
                        <div id="shortcuts" data-key="⌘--b" data-value="lecteur"></div>
                      </li>
                      <li>
                        <div id="shortcuts" data-key="⌘--g" data-value="graphique"></div>
                      </li>
                      <li>
                        <div id="shortcuts" data-key="⌘--u" data-value="fausser"></div>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="search">
                <button class="search-button" id="search-button">
                  <svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7">
                    <title>
                      Search
                    </title>
                    <g class="search-path" fill="none">
                      <path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path>
                      <circle cx="8" cy="8" r="7"></circle>
                    </g>
                  </svg>
                </button>
                <div id="search-container">
                  <div id="search-space">
                    <input autocomplete="off" id="search-bar" name="search" type="text" aria-label="Rechercher quelque chose" placeholder="Rechercher quelque chose"/>
                    <div id="search-layout" data-preview="true"></div>
                  </div>
                </div>
              </div>
            </header>
            <div class="popover-hint">
              <hgroup>
                <h1 class="article-title">
                  Transformers
                </h1>
                <p class="description">
                  See also: LLMs, embedding, visualisation from Brendan Bycroft A multi-layer perceptron (MLP) architecture built on top of a multi-head attention mechanism (Vaswani et al., 2023) ...
                </p>
              </hgroup>
              <ul class="content-meta">
                <li>
                  <span class="page-creation" title="Date de création du contenu de la page">
                    <em>
                      06 févr. 2024
                    </em>
                  </span>
                </li>
                <li>
                  <a href="../thoughts/Transformers.html.md" target="_blank" rel="noopener noreferrer" class="llm-source" style="color: inherit;font-weight: inherit;text-decoration: underline">
                    <span title="voir https://github.com/AnswerDotAI/llms-txt">
                      llms.txt
                    </span>
                  </a>
                </li>
              </ul>
              <ul class="tags">
                <li>
                  <a href="../tags/ml" class="internal tag-link">
                    ml
                  </a>
                </li>
              </ul>
              <div class="spacer"></div>
            </div>
          </div>
          <article class="popover-hint">
            <p dir="auto">
              See also:
              <a href="../thoughts/LLMs" class="internal alias" data-slug="thoughts/LLMs">
                <span class="indicator-hook"></span>
                LLMs
              </a>
              ,
              <a href="../thoughts/Embedding" class="internal alias" data-slug="thoughts/Embedding">
                <span class="indicator-hook"></span>
                embedding
              </a>
              ,
              <a href="https://bbycroft.net/llm" class="external alias">
                <span class="indicator-hook"></span>
                visualisation from Brendan Bycroft
              </a>
            </p>
            <blockquote>
              <p dir="auto">
                A multi-layer perceptron (MLP) architecture built on top of a
                <a href="../thoughts/Attention#muti-head-attention" class="internal alias" data-slug="thoughts/Attention">
                  <span class="indicator-hook"></span>
                  multi-head attention
                </a>
                mechanism
                <cite class id="citation--vaswani2023attentionneed--1">
                  (
                  <a href="#bib-vaswani2023attentionneed" data-no-popover data-bib class="internal alias">
                    <span class="indicator-hook"></span>
                    Vaswani et al., 2023
                  </a>
                  )
                </cite>
                to signal high entropy tokens to be amplified and less important tokens to be diminished.
              </p>
            </blockquote>
            <p dir="auto">
              ELI5: Mom often creates a food list consists of
              <span class="katex">
                <span class="katex-mathml">
                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                    <semantics>
                      <mrow>
                        <mi>
                          n
                        </mi>
                      </mrow>
                      <annotation encoding="application/x-tex">
                        n
                      </annotation>
                    </semantics>
                  </math>
                </span>
                <span class="katex-html" aria-hidden="true">
                  <span class="base">
                    <span class="strut" style="height:0.4306em;"></span>
                    <span class="mord mathnormal">
                      n
                    </span>
                  </span>
                </span>
              </span>
              of items to buy. Your job is to guess what the last item on this list would be.
            </p>
            <p dir="auto">
              Most implementations are
              <a href="../thoughts/Autoregressive-models" class="internal alias" data-slug="thoughts/Autoregressive-models">
                <span class="indicator-hook"></span>
                autoregressive
              </a>
              . Most major SOTA are decoder-only, as encoder-decoder models has lack behind due to their expensive encoding phase.
            </p>
            <p dir="auto">
              <a href="../thoughts/state-space-models" class="internal alias" data-slug="thoughts/state-space-models">
                <span class="indicator-hook"></span>
                state-space models
              </a>
              which address transformers’
              <a href="https://arxiv.org/pdf/2009.06732" data-arxiv-id="2009.06732" class="internal alias">
                <span class="indicator-hook"></span>
                efficiency issues
              </a>
              in attention layers within information-dense data
            </p>
            <section class="collapsible-header" id="memory-limitations" data-level="2">
              <div class="header-controls">
                <button id="collapsible-header-memory-limitations-toggle" aria-label="Toggle content visibility" aria-expanded="true" class="toggle-button">
                  <div class="toggle-icons">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="var(--dark)" stroke="var(--dark)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="circle-icon">
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="var(--tertiary)" stroke="var(--tertiary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="expand-icon">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="collapse-icon">
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                  </div>
                </button>
                <h2 id="memory-limitations" dir="auto">
                  memory limitations.
                  <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" style="padding-left:0.2rem;" class="collapsed-dots">
                    <circle cx="6" cy="12" r="2"></circle>
                    <circle cx="12" cy="12" r="2"></circle>
                    <circle cx="18" cy="12" r="2"></circle>
                  </svg>
                  <a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#memory-limitations" class="internal">
                    <span class="indicator-hook"></span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                  </a>
                </h2>
              </div>
              <div class="collapsible-header-content-outer">
                <div class="collapsible-header-content" data-references="collapsible-header-memory-limitations-toggle" data-level="2" data-heading-id="memory-limitations">
                  <p dir="auto">
                    <em>
                      excerpt from
                      <a href="https://arxiv.org/html/2403.14123" data-arxiv-id="2403.14123" class="internal alias">
                        <span class="indicator-hook"></span>
                        arxiv
                      </a>
                    </em>
                  </p>
                  <blockquote class="twitter-tweet" data-lang="fr">
                    <p lang="en" dir="auto">
                      &quot;How is LLaMa.cpp possible?&quot;
                      <br/>
                      great post by
                      <a href="https://twitter.com/finbarrtimbers?ref_src=twsrc%5Etfw" class="external alias">
                        <span class="indicator-hook"></span>
                        @finbarrtimbers
                      </a>
                      <a href="https://t.co/yF43inlY87" class="external">
                        <span class="indicator-hook"></span>
                        https://t.co/yF43inlY87
                      </a>
                      <br/>
                      <br/>
                      llama.cpp surprised many people (myself included) with how quickly you can run large LLMs on small computers, e.g. 7B runs @ ~16 tok/s on a MacBook. Wait don't you need supercomputers to work…
                      <a href="https://t.co/EIp9iPkZ6x" class="external alias">
                        <span class="indicator-hook"></span>
                        pic.twitter.com/EIp9iPkZ6x
                      </a>
                    </p>
                    — Andrej Karpathy (@karpathy)
                    <a href="https://twitter.com/karpathy/status/1691571869051445433?ref_src=twsrc%5Etfw" class="alias">
                      <span class="indicator-hook"></span>
                      15 août 2023
                    </a>
                  </blockquote>
                </div>
              </div>
            </section>
            <section class="collapsible-header" id="inference" data-level="2">
              <div class="header-controls">
                <button id="collapsible-header-inference-toggle" aria-label="Toggle content visibility" aria-expanded="true" class="toggle-button">
                  <div class="toggle-icons">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="var(--dark)" stroke="var(--dark)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="circle-icon">
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="var(--tertiary)" stroke="var(--tertiary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="expand-icon">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="collapse-icon">
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                  </div>
                </button>
                <h2 id="inference" dir="auto">
                  inference.
                  <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" style="padding-left:0.2rem;" class="collapsed-dots">
                    <circle cx="6" cy="12" r="2"></circle>
                    <circle cx="12" cy="12" r="2"></circle>
                    <circle cx="18" cy="12" r="2"></circle>
                  </svg>
                  <a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#inference" class="internal">
                    <span class="indicator-hook"></span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                  </a>
                </h2>
              </div>
              <div class="collapsible-header-content-outer">
                <div class="collapsible-header-content" data-references="collapsible-header-inference-toggle" data-level="2" data-heading-id="inference">
                  <p dir="auto">
                    Either compute-bound (batch inference, saturated usage) or memory-bound (latency)
                  </p>
                  <p dir="auto">
                    <a href="../thoughts/vllm#speculative-decoding" class="internal alias" data-slug="thoughts/vllm">
                      <span class="indicator-hook"></span>
                      speculative decoding
                    </a>
                    <span>
                      ⇒
                    </span>
                    memory-bound (to saturate FLOPs)
                  </p>
                  <section class="collapsible-header" id="next-token-prediction" data-level="3">
                    <div class="header-controls">
                      <button id="collapsible-header-next-token-prediction-toggle" aria-label="Toggle content visibility" aria-expanded="true" class="toggle-button">
                        <div class="toggle-icons">
                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="var(--dark)" stroke="var(--dark)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="circle-icon">
                            <circle cx="12" cy="12" r="3"></circle>
                          </svg>
                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="var(--tertiary)" stroke="var(--tertiary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="expand-icon">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                          </svg>
                          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="collapse-icon">
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                          </svg>
                        </div>
                      </button>
                      <h3 id="next-token-prediction" dir="auto">
                        next-token prediction.
                        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" style="padding-left:0.2rem;" class="collapsed-dots">
                          <circle cx="6" cy="12" r="2"></circle>
                          <circle cx="12" cy="12" r="2"></circle>
                          <circle cx="18" cy="12" r="2"></circle>
                        </svg>
                        <a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#next-token-prediction" class="internal">
                          <span class="indicator-hook"></span>
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                          </svg>
                        </a>
                      </h3>
                    </div>
                    <div class="collapsible-header-content-outer">
                      <div class="collapsible-header-content" data-references="collapsible-header-next-token-prediction-toggle" data-level="3" data-heading-id="next-token-prediction">
                        <p dir="auto">
                          Sampling: we essentially look forward K-tokens, and then we sample from the distribution of the next token.
                        </p>
                      </div>
                    </div>
                  </section>
                </div>
              </div>
            </section>
            <section class="collapsible-header" id="feynman-kac" data-level="2">
              <div class="header-controls">
                <button id="collapsible-header-feynman-kac-toggle" aria-label="Toggle content visibility" aria-expanded="true" class="toggle-button">
                  <div class="toggle-icons">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="var(--dark)" stroke="var(--dark)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="circle-icon">
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="var(--tertiary)" stroke="var(--tertiary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="expand-icon">
                      <line x1="12" y1="5" x2="12" y2="19"></line>
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="collapse-icon">
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                  </div>
                </button>
                <h2 id="feynman-kac" dir="auto">
                  Feynman-Kac
                  <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" style="padding-left:0.2rem;" class="collapsed-dots">
                    <circle cx="6" cy="12" r="2"></circle>
                    <circle cx="12" cy="12" r="2"></circle>
                    <circle cx="18" cy="12" r="2"></circle>
                  </svg>
                  <a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#feynman-kac" class="internal">
                    <span class="indicator-hook"></span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                  </a>
                </h2>
              </div>
              <div class="collapsible-header-content-outer">
                <div class="collapsible-header-content" data-references="collapsible-header-feynman-kac-toggle" data-level="2" data-heading-id="feynman-kac">
                  <p dir="auto">
                    Let
                    <span class="katex">
                      <span class="katex-mathml">
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                          <semantics>
                            <mrow>
                              <mi mathvariant="script">
                                V
                              </mi>
                            </mrow>
                            <annotation encoding="application/x-tex">
                              \mathcal{V}
                            </annotation>
                          </semantics>
                        </math>
                      </span>
                      <span class="katex-html" aria-hidden="true">
                        <span class="base">
                          <span class="strut" style="height:0.6833em;"></span>
                          <span class="mord mathcal" style="margin-right:0.08222em;">
                            V
                          </span>
                        </span>
                      </span>
                    </span>
                    be the vocab of given transformers model, and
                    <span class="katex">
                      <span class="katex-mathml">
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                          <semantics>
                            <mrow>
                              <mi mathvariant="script">
                                S
                              </mi>
                              <mo>
                                =
                              </mo>
                              <msup>
                                <mi mathvariant="script">
                                  V
                                </mi>
                                <mo lspace="0em" rspace="0em">
                                  ∗
                                </mo>
                              </msup>
                            </mrow>
                            <annotation encoding="application/x-tex">
                              \mathcal{S} = \mathcal{V}^{*}
                            </annotation>
                          </semantics>
                        </math>
                      </span>
                      <span class="katex-html" aria-hidden="true">
                        <span class="base">
                          <span class="strut" style="height:0.6833em;"></span>
                          <span class="mord mathcal" style="margin-right:0.075em;">
                            S
                          </span>
                          <span class="mspace" style="margin-right:0.2778em;"></span>
                          <span class="mrel">
                            =
                          </span>
                          <span class="mspace" style="margin-right:0.2778em;"></span>
                        </span>
                        <span class="base">
                          <span class="strut" style="height:0.6887em;"></span>
                          <span class="mord">
                            <span class="mord mathcal" style="margin-right:0.08222em;">
                              V
                            </span>
                            <span class="msupsub">
                              <span class="vlist-t">
                                <span class="vlist-r">
                                  <span class="vlist" style="height:0.6887em;">
                                    <span style="top:-3.063em;margin-right:0.05em;">
                                      <span class="pstrut" style="height:2.7em;"></span>
                                      <span class="sizing reset-size6 size3 mtight">
                                        <span class="mord mtight">
                                          <span class="mord mtight">
                                            ∗
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                        </span>
                      </span>
                    </span>
                    the set of multi-token strings. Assume
                    <span class="katex">
                      <span class="katex-mathml">
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                          <semantics>
                            <mrow>
                              <mi mathvariant="script">
                                V
                              </mi>
                            </mrow>
                            <annotation encoding="application/x-tex">
                              \mathcal{V}
                            </annotation>
                          </semantics>
                        </math>
                      </span>
                      <span class="katex-html" aria-hidden="true">
                        <span class="base">
                          <span class="strut" style="height:0.6833em;"></span>
                          <span class="mord mathcal" style="margin-right:0.08222em;">
                            V
                          </span>
                        </span>
                      </span>
                    </span>
                    contains token
                    <code>
                      EOS
                    </code>
                    and write
                    <span class="katex">
                      <span class="katex-mathml">
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                          <semantics>
                            <mrow>
                              <mi mathvariant="script">
                                F
                              </mi>
                              <mo>
                                ⊆
                              </mo>
                              <mi mathvariant="script">
                                S
                              </mi>
                            </mrow>
                            <annotation encoding="application/x-tex">
                              \mathcal{F} \subseteq \mathcal{S}
                            </annotation>
                          </semantics>
                        </math>
                      </span>
                      <span class="katex-html" aria-hidden="true">
                        <span class="base">
                          <span class="strut" style="height:0.8193em;vertical-align:-0.136em;"></span>
                          <span class="mord mathcal" style="margin-right:0.09931em;">
                            F
                          </span>
                          <span class="mspace" style="margin-right:0.2778em;"></span>
                          <span class="mrel">
                            ⊆
                          </span>
                          <span class="mspace" style="margin-right:0.2778em;"></span>
                        </span>
                        <span class="base">
                          <span class="strut" style="height:0.6833em;"></span>
                          <span class="mord mathcal" style="margin-right:0.075em;">
                            S
                          </span>
                        </span>
                      </span>
                    </span>
                    for the set of
                    <code>
                      EOS
                    </code>
                    -terminated strings.
                  </p>
                  <blockquote class="callout definition" data-callout="definition">
                    <div class="callout-title" dir="auto">
                      <div class="callout-icon" dir="auto"></div>
                      <div class="callout-title-inner" dir="auto">
                        <p dir="auto">
                          <em>
                            Feynman-Kac Transformer model
                          </em>
                        </p>
                      </div>
                    </div>
                    <div class="callout-content" dir="auto">
                      <p dir="auto">
                        is a tuple
                        <span class="katex">
                          <span class="katex-mathml">
                            <math xmlns="http://www.w3.org/1998/Math/MathML">
                              <semantics>
                                <mrow>
                                  <mo stretchy="false">
                                    (
                                  </mo>
                                  <msub>
                                    <mi>
                                      s
                                    </mi>
                                    <mn>
                                      0
                                    </mn>
                                  </msub>
                                  <mo separator="true">
                                    ,
                                  </mo>
                                  <mo stretchy="false">
                                    {
                                  </mo>
                                  <msub>
                                    <mi>
                                      M
                                    </mi>
                                    <mi>
                                      t
                                    </mi>
                                  </msub>
                                  <msub>
                                    <mo stretchy="false">
                                      }
                                    </mo>
                                    <mrow>
                                      <mi>
                                        t
                                      </mi>
                                      <mo>
                                        ≥
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                    </mrow>
                                  </msub>
                                  <mo separator="true">
                                    ,
                                  </mo>
                                  <mo stretchy="false">
                                    {
                                  </mo>
                                  <msub>
                                    <mi>
                                      G
                                    </mi>
                                    <mi>
                                      t
                                    </mi>
                                  </msub>
                                  <msub>
                                    <mo stretchy="false">
                                      }
                                    </mo>
                                    <mrow>
                                      <mi>
                                        t
                                      </mi>
                                      <mo>
                                        ≥
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                    </mrow>
                                  </msub>
                                  <mo stretchy="false">
                                    )
                                  </mo>
                                </mrow>
                                <annotation encoding="application/x-tex">
                                  (s_{0}, \{M_t\}_{t\ge 1}, \{G_t\}_{t\ge 1})
                                </annotation>
                              </semantics>
                            </math>
                          </span>
                          <span class="katex-html" aria-hidden="true">
                            <span class="base">
                              <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                              <span class="mopen">
                                (
                              </span>
                              <span class="mord">
                                <span class="mord mathnormal">
                                  s
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.3011em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mtight">
                                              <span class="mord mtight">
                                                0
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.15em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mpunct">
                                ,
                              </span>
                              <span class="mspace" style="margin-right:0.1667em;"></span>
                              <span class="mopen">
                                {
                              </span>
                              <span class="mord">
                                <span class="mord mathnormal" style="margin-right:0.10903em;">
                                  M
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2806em;">
                                        <span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight">
                                              t
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.15em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mclose">
                                <span class="mclose">
                                  }
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.3011em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                              <span class="mrel mtight">
                                                ≥
                                              </span>
                                              <span class="mord mtight">
                                                1
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2452em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mpunct">
                                ,
                              </span>
                              <span class="mspace" style="margin-right:0.1667em;"></span>
                              <span class="mopen">
                                {
                              </span>
                              <span class="mord">
                                <span class="mord mathnormal">
                                  G
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2806em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight">
                                              t
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.15em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mclose">
                                <span class="mclose">
                                  }
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.3011em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                              <span class="mrel mtight">
                                                ≥
                                              </span>
                                              <span class="mord mtight">
                                                1
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2452em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mclose">
                                )
                              </span>
                            </span>
                          </span>
                        </span>
                        where:
                      </p>
                      <ul dir="auto">
                        <li>
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mn>
                                        0
                                      </mn>
                                    </msub>
                                    <mo>
                                      ∈
                                    </mo>
                                    <mi mathvariant="script">
                                      S
                                    </mi>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    s_{0} \in \mathcal{S}
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    s
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3011em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mtight">
                                                <span class="mord mtight">
                                                  0
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  ∈
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:0.6833em;"></span>
                                <span class="mord mathcal" style="margin-right:0.075em;">
                                  S
                                </span>
                              </span>
                            </span>
                          </span>
                          is an
                          <em>
                            initial state
                          </em>
                          , which will take as empty string
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mi>
                                      ϵ
                                    </mi>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    \epsilon
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.4306em;"></span>
                                <span class="mord mathnormal">
                                  ϵ
                                </span>
                              </span>
                            </span>
                          </span>
                        </li>
                        <li>
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <msub>
                                      <mi>
                                        M
                                      </mi>
                                      <mi>
                                        t
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      (
                                    </mo>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mi>
                                        t
                                      </mi>
                                    </msub>
                                    <mo>
                                      ∣
                                    </mo>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mrow>
                                        <mi>
                                          t
                                        </mi>
                                        <mo>
                                          −
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                      </mrow>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <msub>
                                      <mi>
                                        f
                                      </mi>
                                      <mi>
                                        θ
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      )
                                    </mo>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    M_t(s_t \mid s_{t-1}, f_\theta)
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal" style="margin-right:0.10903em;">
                                    M
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2806em;">
                                          <span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mopen">
                                  (
                                </span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    s
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2806em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  ∣
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    s
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3011em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mtight">
                                                <span class="mord mathnormal mtight">
                                                  t
                                                </span>
                                                <span class="mbin mtight">
                                                  −
                                                </span>
                                                <span class="mord mtight">
                                                  1
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2083em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal" style="margin-right:0.10764em;">
                                    f
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3361em;">
                                          <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                θ
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mclose">
                                  )
                                </span>
                              </span>
                            </span>
                          </span>
                          is a
                          <em>
                            Markov kernel
                          </em>
                          from
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mrow>
                                        <mi>
                                          t
                                        </mi>
                                        <mo>
                                          −
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                      </mrow>
                                    </msub>
                                    <mo>
                                      ∈
                                    </mo>
                                    <msup>
                                      <mi mathvariant="script">
                                        F
                                      </mi>
                                      <mi>
                                        c
                                      </mi>
                                    </msup>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    s_{t-1} \in \mathcal{F}^c
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.7474em;vertical-align:-0.2083em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    s
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3011em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mtight">
                                                <span class="mord mathnormal mtight">
                                                  t
                                                </span>
                                                <span class="mbin mtight">
                                                  −
                                                </span>
                                                <span class="mord mtight">
                                                  1
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2083em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  ∈
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:0.6833em;"></span>
                                <span class="mord">
                                  <span class="mord mathcal" style="margin-right:0.09931em;">
                                    F
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.6644em;">
                                          <span style="top:-3.063em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                c
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                          to
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mi>
                                        t
                                      </mi>
                                    </msub>
                                    <mo>
                                      ∈
                                    </mo>
                                    <mi mathvariant="script">
                                      S
                                    </mi>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    s_t \in \mathcal{S}
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    s
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2806em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  ∈
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:0.6833em;"></span>
                                <span class="mord mathcal" style="margin-right:0.075em;">
                                  S
                                </span>
                              </span>
                            </span>
                          </span>
                          , parameterised by a transformer network
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <msub>
                                      <mi>
                                        f
                                      </mi>
                                      <mi>
                                        θ
                                      </mi>
                                    </msub>
                                    <mo>
                                      :
                                    </mo>
                                    <msup>
                                      <mi mathvariant="script">
                                        F
                                      </mi>
                                      <mi>
                                        c
                                      </mi>
                                    </msup>
                                    <mo>
                                      →
                                    </mo>
                                    <msup>
                                      <mi mathvariant="double-struck">
                                        R
                                      </mi>
                                      <mrow>
                                        <mo>
                                          ∣
                                        </mo>
                                        <mi mathvariant="script">
                                          V
                                        </mi>
                                        <mo>
                                          ∣
                                        </mo>
                                      </mrow>
                                    </msup>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    f_\theta: \mathcal{F}^c \to \mathbb{R}^{\mid \mathcal{V} \mid}
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal" style="margin-right:0.10764em;">
                                    f
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3361em;">
                                          <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                θ
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  :
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:0.6833em;"></span>
                                <span class="mord">
                                  <span class="mord mathcal" style="margin-right:0.09931em;">
                                    F
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.6644em;">
                                          <span style="top:-3.063em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                c
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  →
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:0.888em;"></span>
                                <span class="mord">
                                  <span class="mord mathbb">
                                    R
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.888em;">
                                          <span style="top:-3.063em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mtight">
                                                <span class="mrel mtight">
                                                  ∣
                                                </span>
                                                <span class="mord mathcal mtight" style="margin-right:0.08222em;">
                                                  V
                                                </span>
                                                <span class="mrel mtight">
                                                  ∣
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                          mapping non-
                          <code>
                            EOS
                          </code>
                          -terminated strings to vectors of logits
                        </li>
                        <li>
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <msub>
                                      <mi>
                                        G
                                      </mi>
                                      <mi>
                                        t
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      (
                                    </mo>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mrow>
                                        <mi>
                                          t
                                        </mi>
                                        <mo>
                                          −
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                      </mrow>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mi>
                                        t
                                      </mi>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <msub>
                                      <mi>
                                        f
                                      </mi>
                                      <mi>
                                        θ
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      )
                                    </mo>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    G_t(s_{t-1}, s_t, f_\theta)
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    G
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2806em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mopen">
                                  (
                                </span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    s
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3011em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mtight">
                                                <span class="mord mathnormal mtight">
                                                  t
                                                </span>
                                                <span class="mbin mtight">
                                                  −
                                                </span>
                                                <span class="mord mtight">
                                                  1
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2083em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    s
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2806em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal" style="margin-right:0.10764em;">
                                    f
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3361em;">
                                          <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                θ
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mclose">
                                  )
                                </span>
                              </span>
                            </span>
                          </span>
                          is a
                          <em>
                            potential function
                          </em>
                          , mapping a pair
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mo stretchy="false">
                                      (
                                    </mo>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mrow>
                                        <mi>
                                          t
                                        </mi>
                                        <mo>
                                          −
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                      </mrow>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mi>
                                        t
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      )
                                    </mo>
                                    <mo>
                                      ∈
                                    </mo>
                                    <msup>
                                      <mi mathvariant="script">
                                        F
                                      </mi>
                                      <mi>
                                        c
                                      </mi>
                                    </msup>
                                    <mo>
                                      ×
                                    </mo>
                                    <mi mathvariant="script">
                                      S
                                    </mi>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    (s_{t-1}, s_t) \in \mathcal{F}^c \times \mathcal{S}
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                <span class="mopen">
                                  (
                                </span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    s
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3011em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mtight">
                                                <span class="mord mathnormal mtight">
                                                  t
                                                </span>
                                                <span class="mbin mtight">
                                                  −
                                                </span>
                                                <span class="mord mtight">
                                                  1
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2083em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    s
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2806em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mclose">
                                  )
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  ∈
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span>
                                <span class="mord">
                                  <span class="mord mathcal" style="margin-right:0.09931em;">
                                    F
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.6644em;">
                                          <span style="top:-3.063em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                c
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mspace" style="margin-right:0.2222em;"></span>
                                <span class="mbin">
                                  ×
                                </span>
                                <span class="mspace" style="margin-right:0.2222em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:0.6833em;"></span>
                                <span class="mord mathcal" style="margin-right:0.075em;">
                                  S
                                </span>
                              </span>
                            </span>
                          </span>
                          to a real-valued non-negative score.
                        </li>
                      </ul>
                    </div>
                  </blockquote>
                  <p dir="auto">
                    Goal: generate from distribution
                    <span class="katex">
                      <span class="katex-mathml">
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                          <semantics>
                            <mrow>
                              <mi mathvariant="double-struck">
                                P
                              </mi>
                            </mrow>
                            <annotation encoding="application/x-tex">
                              \mathbb{P}
                            </annotation>
                          </semantics>
                        </math>
                      </span>
                      <span class="katex-html" aria-hidden="true">
                        <span class="base">
                          <span class="strut" style="height:0.6889em;"></span>
                          <span class="mord mathbb">
                            P
                          </span>
                        </span>
                      </span>
                    </span>
                    that reweights Markove chain
                    <span class="katex">
                      <span class="katex-mathml">
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                          <semantics>
                            <mrow>
                              <mi mathvariant="double-struck">
                                M
                              </mi>
                            </mrow>
                            <annotation encoding="application/x-tex">
                              \mathbb{M}
                            </annotation>
                          </semantics>
                        </math>
                      </span>
                      <span class="katex-html" aria-hidden="true">
                        <span class="base">
                          <span class="strut" style="height:0.6889em;"></span>
                          <span class="mord mathbb">
                            M
                          </span>
                        </span>
                      </span>
                    </span>
                    by potential functions
                    <span class="katex">
                      <span class="katex-mathml">
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                          <semantics>
                            <mrow>
                              <msub>
                                <mi>
                                  G
                                </mi>
                                <mi>
                                  t
                                </mi>
                              </msub>
                            </mrow>
                            <annotation encoding="application/x-tex">
                              G_t
                            </annotation>
                          </semantics>
                        </math>
                      </span>
                      <span class="katex-html" aria-hidden="true">
                        <span class="base">
                          <span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span>
                          <span class="mord">
                            <span class="mord mathnormal">
                              G
                            </span>
                            <span class="msupsub">
                              <span class="vlist-t vlist-t2">
                                <span class="vlist-r">
                                  <span class="vlist" style="height:0.2806em;">
                                    <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                      <span class="pstrut" style="height:2.7em;"></span>
                                      <span class="sizing reset-size6 size3 mtight">
                                        <span class="mord mathnormal mtight">
                                          t
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="vlist-s">
                                    ​
                                  </span>
                                </span>
                                <span class="vlist-r">
                                  <span class="vlist" style="height:0.15em;">
                                    <span></span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                        </span>
                      </span>
                    </span>
                    . We define
                    <mark>
                      <em>
                        step-t filtering posteriors
                      </em>
                      :
                    </mark>
                  </p>
                  <span class="katex-display">
                    <span class="katex">
                      <span class="katex-mathml">
                        <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                          <semantics>
                            <mrow>
                              <msub>
                                <mi>
                                  P
                                </mi>
                                <mi>
                                  t
                                </mi>
                              </msub>
                              <mo stretchy="false">
                                (
                              </mo>
                              <msub>
                                <mi>
                                  s
                                </mi>
                                <mi>
                                  t
                                </mi>
                              </msub>
                              <mo stretchy="false">
                                )
                              </mo>
                              <mo>
                                =
                              </mo>
                              <mfrac>
                                <mrow>
                                  <msub>
                                    <mi mathvariant="double-struck">
                                      E
                                    </mi>
                                    <mi mathvariant="double-struck">
                                      M
                                    </mi>
                                  </msub>
                                  <mrow>
                                    <mo fence="true">
                                      [
                                    </mo>
                                    <munderover>
                                      <mo>
                                        ∏
                                      </mo>
                                      <mrow>
                                        <mi>
                                          i
                                        </mi>
                                        <mo>
                                          =
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                      </mrow>
                                      <mrow>
                                        <mi>
                                          t
                                        </mi>
                                        <mo>
                                          ∧
                                        </mo>
                                        <mi>
                                          T
                                        </mi>
                                      </mrow>
                                    </munderover>
                                    <msub>
                                      <mi>
                                        G
                                      </mi>
                                      <mi>
                                        i
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      (
                                    </mo>
                                    <msub>
                                      <mi>
                                        S
                                      </mi>
                                      <mrow>
                                        <mi>
                                          i
                                        </mi>
                                        <mo>
                                          −
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                      </mrow>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <msub>
                                      <mi>
                                        S
                                      </mi>
                                      <mi>
                                        i
                                      </mi>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <msub>
                                      <mi>
                                        f
                                      </mi>
                                      <mi>
                                        θ
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      )
                                    </mo>
                                    <mo>
                                      ⋅
                                    </mo>
                                    <mo stretchy="false">
                                      [
                                    </mo>
                                    <msub>
                                      <mi>
                                        S
                                      </mi>
                                      <mi>
                                        t
                                      </mi>
                                    </msub>
                                    <mo>
                                      =
                                    </mo>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mi>
                                        t
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      ]
                                    </mo>
                                    <mo fence="true">
                                      ]
                                    </mo>
                                  </mrow>
                                </mrow>
                                <mrow>
                                  <msub>
                                    <mi mathvariant="double-struck">
                                      E
                                    </mi>
                                    <mi mathvariant="double-struck">
                                      M
                                    </mi>
                                  </msub>
                                  <mrow>
                                    <mo fence="true">
                                      [
                                    </mo>
                                    <munderover>
                                      <mo>
                                        ∏
                                      </mo>
                                      <mrow>
                                        <mi>
                                          i
                                        </mi>
                                        <mo>
                                          =
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                      </mrow>
                                      <mrow>
                                        <mi>
                                          t
                                        </mi>
                                        <mo>
                                          ∧
                                        </mo>
                                        <mi>
                                          T
                                        </mi>
                                      </mrow>
                                    </munderover>
                                    <msub>
                                      <mi>
                                        G
                                      </mi>
                                      <mi>
                                        i
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      (
                                    </mo>
                                    <msub>
                                      <mi>
                                        S
                                      </mi>
                                      <mrow>
                                        <mi>
                                          i
                                        </mi>
                                        <mo>
                                          −
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                      </mrow>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <msub>
                                      <mi>
                                        S
                                      </mi>
                                      <mi>
                                        i
                                      </mi>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <msub>
                                      <mi>
                                        f
                                      </mi>
                                      <mi>
                                        θ
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      )
                                    </mo>
                                    <mo fence="true">
                                      ]
                                    </mo>
                                  </mrow>
                                </mrow>
                              </mfrac>
                            </mrow>
                            <annotation encoding="application/x-tex">
                              P_t(s_t) = \frac{\mathbb{E}_\mathbb{M} \left[ \prod_{i=1}^{t \wedge T} G_i(S_{i-1}, S_i, f_\theta) \cdot [S_t = s_t] \right]}{\mathbb{E}_\mathbb{M} \left[ \prod_{i=1}^{t \wedge T} G_i(S_{i-1}, S_i, f_\theta) \right]}
                            </annotation>
                          </semantics>
                        </math>
                      </span>
                      <span class="katex-html" aria-hidden="true">
                        <span class="base">
                          <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                          <span class="mord">
                            <span class="mord mathnormal" style="margin-right:0.13889em;">
                              P
                            </span>
                            <span class="msupsub">
                              <span class="vlist-t vlist-t2">
                                <span class="vlist-r">
                                  <span class="vlist" style="height:0.2806em;">
                                    <span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;">
                                      <span class="pstrut" style="height:2.7em;"></span>
                                      <span class="sizing reset-size6 size3 mtight">
                                        <span class="mord mathnormal mtight">
                                          t
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="vlist-s">
                                    ​
                                  </span>
                                </span>
                                <span class="vlist-r">
                                  <span class="vlist" style="height:0.15em;">
                                    <span></span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                          <span class="mopen">
                            (
                          </span>
                          <span class="mord">
                            <span class="mord mathnormal">
                              s
                            </span>
                            <span class="msupsub">
                              <span class="vlist-t vlist-t2">
                                <span class="vlist-r">
                                  <span class="vlist" style="height:0.2806em;">
                                    <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                      <span class="pstrut" style="height:2.7em;"></span>
                                      <span class="sizing reset-size6 size3 mtight">
                                        <span class="mord mathnormal mtight">
                                          t
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="vlist-s">
                                    ​
                                  </span>
                                </span>
                                <span class="vlist-r">
                                  <span class="vlist" style="height:0.15em;">
                                    <span></span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                          <span class="mclose">
                            )
                          </span>
                          <span class="mspace" style="margin-right:0.2778em;"></span>
                          <span class="mrel">
                            =
                          </span>
                          <span class="mspace" style="margin-right:0.2778em;"></span>
                        </span>
                        <span class="base">
                          <span class="strut" style="height:3.88em;vertical-align:-1.69em;"></span>
                          <span class="mord">
                            <span class="mopen nulldelimiter"></span>
                            <span class="mfrac">
                              <span class="vlist-t vlist-t2">
                                <span class="vlist-r">
                                  <span class="vlist" style="height:2.19em;">
                                    <span style="top:-2.11em;">
                                      <span class="pstrut" style="height:3.15em;"></span>
                                      <span class="mord">
                                        <span class="mord">
                                          <span class="mord mathbb">
                                            E
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3322em;">
                                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathbb mtight">
                                                        M
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="minner">
                                          <span class="mopen delimcenter" style="top:0em;">
                                            <span class="delimsizing size2">
                                              [
                                            </span>
                                          </span>
                                          <span class="mop">
                                            <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                              ∏
                                            </span>
                                            <span class="msupsub">
                                              <span class="vlist-t vlist-t2">
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.9812em;">
                                                    <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mtight">
                                                          <span class="mord mathnormal mtight">
                                                            i
                                                          </span>
                                                          <span class="mrel mtight">
                                                            =
                                                          </span>
                                                          <span class="mord mtight">
                                                            1
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                    <span style="top:-3.2029em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mtight">
                                                          <span class="mord mathnormal mtight">
                                                            t
                                                          </span>
                                                          <span class="mbin mtight">
                                                            ∧
                                                          </span>
                                                          <span class="mord mathnormal mtight" style="margin-right:0.13889em;">
                                                            T
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="vlist-s">
                                                    ​
                                                  </span>
                                                </span>
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.2997em;">
                                                    <span></span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mspace" style="margin-right:0.1667em;"></span>
                                          <span class="mord">
                                            <span class="mord mathnormal">
                                              G
                                            </span>
                                            <span class="msupsub">
                                              <span class="vlist-t vlist-t2">
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.3117em;">
                                                    <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mathnormal mtight">
                                                          i
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="vlist-s">
                                                    ​
                                                  </span>
                                                </span>
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.15em;">
                                                    <span></span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mopen">
                                            (
                                          </span>
                                          <span class="mord">
                                            <span class="mord mathnormal" style="margin-right:0.05764em;">
                                              S
                                            </span>
                                            <span class="msupsub">
                                              <span class="vlist-t vlist-t2">
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.3117em;">
                                                    <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mtight">
                                                          <span class="mord mathnormal mtight">
                                                            i
                                                          </span>
                                                          <span class="mbin mtight">
                                                            −
                                                          </span>
                                                          <span class="mord mtight">
                                                            1
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="vlist-s">
                                                    ​
                                                  </span>
                                                </span>
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.2083em;">
                                                    <span></span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mpunct">
                                            ,
                                          </span>
                                          <span class="mspace" style="margin-right:0.1667em;"></span>
                                          <span class="mord">
                                            <span class="mord mathnormal" style="margin-right:0.05764em;">
                                              S
                                            </span>
                                            <span class="msupsub">
                                              <span class="vlist-t vlist-t2">
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.3117em;">
                                                    <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mathnormal mtight">
                                                          i
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="vlist-s">
                                                    ​
                                                  </span>
                                                </span>
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.15em;">
                                                    <span></span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mpunct">
                                            ,
                                          </span>
                                          <span class="mspace" style="margin-right:0.1667em;"></span>
                                          <span class="mord">
                                            <span class="mord mathnormal" style="margin-right:0.10764em;">
                                              f
                                            </span>
                                            <span class="msupsub">
                                              <span class="vlist-t vlist-t2">
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.3361em;">
                                                    <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                          θ
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="vlist-s">
                                                    ​
                                                  </span>
                                                </span>
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.15em;">
                                                    <span></span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mclose">
                                            )
                                          </span>
                                          <span class="mclose delimcenter" style="top:0em;">
                                            <span class="delimsizing size2">
                                              ]
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span style="top:-3.38em;">
                                      <span class="pstrut" style="height:3.15em;"></span>
                                      <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                    </span>
                                    <span style="top:-4.19em;">
                                      <span class="pstrut" style="height:3.15em;"></span>
                                      <span class="mord">
                                        <span class="mord">
                                          <span class="mord mathbb">
                                            E
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3322em;">
                                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathbb mtight">
                                                        M
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="minner">
                                          <span class="mopen delimcenter" style="top:0em;">
                                            <span class="delimsizing size2">
                                              [
                                            </span>
                                          </span>
                                          <span class="mop">
                                            <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                              ∏
                                            </span>
                                            <span class="msupsub">
                                              <span class="vlist-t vlist-t2">
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.9812em;">
                                                    <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mtight">
                                                          <span class="mord mathnormal mtight">
                                                            i
                                                          </span>
                                                          <span class="mrel mtight">
                                                            =
                                                          </span>
                                                          <span class="mord mtight">
                                                            1
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                    <span style="top:-3.2029em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mtight">
                                                          <span class="mord mathnormal mtight">
                                                            t
                                                          </span>
                                                          <span class="mbin mtight">
                                                            ∧
                                                          </span>
                                                          <span class="mord mathnormal mtight" style="margin-right:0.13889em;">
                                                            T
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="vlist-s">
                                                    ​
                                                  </span>
                                                </span>
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.2997em;">
                                                    <span></span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mspace" style="margin-right:0.1667em;"></span>
                                          <span class="mord">
                                            <span class="mord mathnormal">
                                              G
                                            </span>
                                            <span class="msupsub">
                                              <span class="vlist-t vlist-t2">
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.3117em;">
                                                    <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mathnormal mtight">
                                                          i
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="vlist-s">
                                                    ​
                                                  </span>
                                                </span>
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.15em;">
                                                    <span></span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mopen">
                                            (
                                          </span>
                                          <span class="mord">
                                            <span class="mord mathnormal" style="margin-right:0.05764em;">
                                              S
                                            </span>
                                            <span class="msupsub">
                                              <span class="vlist-t vlist-t2">
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.3117em;">
                                                    <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mtight">
                                                          <span class="mord mathnormal mtight">
                                                            i
                                                          </span>
                                                          <span class="mbin mtight">
                                                            −
                                                          </span>
                                                          <span class="mord mtight">
                                                            1
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="vlist-s">
                                                    ​
                                                  </span>
                                                </span>
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.2083em;">
                                                    <span></span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mpunct">
                                            ,
                                          </span>
                                          <span class="mspace" style="margin-right:0.1667em;"></span>
                                          <span class="mord">
                                            <span class="mord mathnormal" style="margin-right:0.05764em;">
                                              S
                                            </span>
                                            <span class="msupsub">
                                              <span class="vlist-t vlist-t2">
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.3117em;">
                                                    <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mathnormal mtight">
                                                          i
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="vlist-s">
                                                    ​
                                                  </span>
                                                </span>
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.15em;">
                                                    <span></span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mpunct">
                                            ,
                                          </span>
                                          <span class="mspace" style="margin-right:0.1667em;"></span>
                                          <span class="mord">
                                            <span class="mord mathnormal" style="margin-right:0.10764em;">
                                              f
                                            </span>
                                            <span class="msupsub">
                                              <span class="vlist-t vlist-t2">
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.3361em;">
                                                    <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                          θ
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="vlist-s">
                                                    ​
                                                  </span>
                                                </span>
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.15em;">
                                                    <span></span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mclose">
                                            )
                                          </span>
                                          <span class="mspace" style="margin-right:0.2222em;"></span>
                                          <span class="mbin">
                                            ⋅
                                          </span>
                                          <span class="mspace" style="margin-right:0.2222em;"></span>
                                          <span class="mopen">
                                            [
                                          </span>
                                          <span class="mord">
                                            <span class="mord mathnormal" style="margin-right:0.05764em;">
                                              S
                                            </span>
                                            <span class="msupsub">
                                              <span class="vlist-t vlist-t2">
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.2806em;">
                                                    <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mathnormal mtight">
                                                          t
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="vlist-s">
                                                    ​
                                                  </span>
                                                </span>
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.15em;">
                                                    <span></span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mspace" style="margin-right:0.2778em;"></span>
                                          <span class="mrel">
                                            =
                                          </span>
                                          <span class="mspace" style="margin-right:0.2778em;"></span>
                                          <span class="mord">
                                            <span class="mord mathnormal">
                                              s
                                            </span>
                                            <span class="msupsub">
                                              <span class="vlist-t vlist-t2">
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.2806em;">
                                                    <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                      <span class="pstrut" style="height:2.7em;"></span>
                                                      <span class="sizing reset-size6 size3 mtight">
                                                        <span class="mord mathnormal mtight">
                                                          t
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="vlist-s">
                                                    ​
                                                  </span>
                                                </span>
                                                <span class="vlist-r">
                                                  <span class="vlist" style="height:0.15em;">
                                                    <span></span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mclose">
                                            ]
                                          </span>
                                          <span class="mclose delimcenter" style="top:0em;">
                                            <span class="delimsizing size2">
                                              ]
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="vlist-s">
                                    ​
                                  </span>
                                </span>
                                <span class="vlist-r">
                                  <span class="vlist" style="height:1.69em;">
                                    <span></span>
                                  </span>
                                </span>
                              </span>
                            </span>
                            <span class="mclose nulldelimiter"></span>
                          </span>
                        </span>
                      </span>
                    </span>
                  </span>
                  <p dir="auto">
                    <em>
                      Given that
                      <span class="katex">
                        <span class="katex-mathml">
                          <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <semantics>
                              <mrow>
                                <mi>
                                  T
                                </mi>
                              </mrow>
                              <annotation encoding="application/x-tex">
                                T
                              </annotation>
                            </semantics>
                          </math>
                        </span>
                        <span class="katex-html" aria-hidden="true">
                          <span class="base">
                            <span class="strut" style="height:0.6833em;"></span>
                            <span class="mord mathnormal" style="margin-right:0.13889em;">
                              T
                            </span>
                          </span>
                        </span>
                      </span>
                      is mostly finite
                    </em>
                    we can then define
                    <em>
                      overall posterior
                    </em>
                    <span class="katex">
                      <span class="katex-mathml">
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                          <semantics>
                            <mrow>
                              <mi mathvariant="double-struck">
                                P
                              </mi>
                              <mo stretchy="false">
                                (
                              </mo>
                              <mi>
                                s
                              </mi>
                              <mo stretchy="false">
                                )
                              </mo>
                              <mo>
                                =
                              </mo>
                              <msub>
                                <mrow>
                                  <mi>
                                    lim
                                  </mi>
                                  <mo>
                                    ⁡
                                  </mo>
                                </mrow>
                                <mrow>
                                  <mi>
                                    t
                                  </mi>
                                  <mo>
                                    →
                                  </mo>
                                  <mi mathvariant="normal">
                                    ∞
                                  </mi>
                                </mrow>
                              </msub>
                              <msub>
                                <mi mathvariant="double-struck">
                                  P
                                </mi>
                                <mi>
                                  t
                                </mi>
                              </msub>
                              <mo stretchy="false">
                                (
                              </mo>
                              <mi>
                                s
                              </mi>
                              <mo stretchy="false">
                                )
                              </mo>
                            </mrow>
                            <annotation encoding="application/x-tex">
                              \mathbb{P}(s) = \lim_{t \to \infty} \mathbb{P}_t(s)
                            </annotation>
                          </semantics>
                        </math>
                      </span>
                      <span class="katex-html" aria-hidden="true">
                        <span class="base">
                          <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                          <span class="mord mathbb">
                            P
                          </span>
                          <span class="mopen">
                            (
                          </span>
                          <span class="mord mathnormal">
                            s
                          </span>
                          <span class="mclose">
                            )
                          </span>
                          <span class="mspace" style="margin-right:0.2778em;"></span>
                          <span class="mrel">
                            =
                          </span>
                          <span class="mspace" style="margin-right:0.2778em;"></span>
                        </span>
                        <span class="base">
                          <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                          <span class="mop">
                            <span class="mop">
                              lim
                            </span>
                            <span class="msupsub">
                              <span class="vlist-t vlist-t2">
                                <span class="vlist-r">
                                  <span class="vlist" style="height:0.2806em;">
                                    <span style="top:-2.55em;margin-right:0.05em;">
                                      <span class="pstrut" style="height:2.7em;"></span>
                                      <span class="sizing reset-size6 size3 mtight">
                                        <span class="mord mtight">
                                          <span class="mord mathnormal mtight">
                                            t
                                          </span>
                                          <span class="mrel mtight">
                                            →
                                          </span>
                                          <span class="mord mtight">
                                            ∞
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="vlist-s">
                                    ​
                                  </span>
                                </span>
                                <span class="vlist-r">
                                  <span class="vlist" style="height:0.15em;">
                                    <span></span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                          <span class="mspace" style="margin-right:0.1667em;"></span>
                          <span class="mord">
                            <span class="mord mathbb">
                              P
                            </span>
                            <span class="msupsub">
                              <span class="vlist-t vlist-t2">
                                <span class="vlist-r">
                                  <span class="vlist" style="height:0.2806em;">
                                    <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                      <span class="pstrut" style="height:2.7em;"></span>
                                      <span class="sizing reset-size6 size3 mtight">
                                        <span class="mord mathnormal mtight">
                                          t
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="vlist-s">
                                    ​
                                  </span>
                                </span>
                                <span class="vlist-r">
                                  <span class="vlist" style="height:0.15em;">
                                    <span></span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                          <span class="mopen">
                            (
                          </span>
                          <span class="mord mathnormal">
                            s
                          </span>
                          <span class="mclose">
                            )
                          </span>
                        </span>
                      </span>
                    </span>
                    <cite class id="citation--lew2023sequentialmontecarlosteering--2">
                      (
                      <a href="#bib-lew2023sequentialmontecarlosteering" data-no-popover data-bib class="internal alias">
                        <span class="indicator-hook"></span>
                        Lew et al., 2023, p. see 2.2 for examples
                      </a>
                      )
                    </cite>
                  </p>
                  <div class="ps-root" data-inline-macros data-settings="{&quot;code&quot;:&quot;pseudo&quot;,&quot;css&quot;:&quot;latex-pseudo&quot;,&quot;removeCaptionCount&quot;:false,&quot;renderer&quot;:{&quot;indentSize&quot;:&quot;0.6em&quot;,&quot;commentDelimiter&quot;:&quot;  ▷&quot;,&quot;lineNumberPunc&quot;:&quot;:&quot;,&quot;lineNumber&quot;:true,&quot;noEnd&quot;:false,&quot;scopeLines&quot;:false,&quot;titlePrefix&quot;:&quot;Algorithm&quot;,&quot;mathEngine&quot;:&quot;katex&quot;}}" dir="auto">
                    <button class="clipboard-button ps-clipboard" aria-label="Copy pseudocode to clipboard" tabindex="-1">
                      <svg aria-hidden="true" class="copy-icon" width="16" height="16" version="1.1" viewBox="0 0 16 16" data-view-component>
                        <path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path>
                        <path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path>
                      </svg>
                      <svg aria-hidden="true" class="check-icon" version="1.1" width="16" height="16" viewBox="0 0 16 16" data-view-component>
                        <path fill-rule="evenodd" fill="rgb(63, 185, 80)" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
                      </svg>
                    </button>
                    <span class="ps-mathml">
                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                          <annotation encoding="application/x-tex">
                            &quot;\\begin{algorithm}\n\\caption{Sequential Monte Carlo Transformer Steering}\n\\begin{algorithmic}\n\\State \\textbf{Input:} $N$ (\\# particles), $K$ (factor), Feynman-Kac Transformer model $\\{s_0, \\{M_t\\}_{t \\geq 1}, \\{G_t\\}_{t \\geq 1}\\}$\n\\State \\textbf{Output:} Weighted particle approximation $\\{(x_i, w_i)\\}_{i=1,\\ldots,N}$ of the posterior $\\mathbb{P}$ \\\\\n\\State \\textbf{Output:} Unbiased estimate $\\hat{Z}$ of the partition function $Z = \\mathbb{E}_\\mathbb{M}[\\prod_{t=1}^T G_t(s_t, s_{t-1}, f_\\theta)]$ \\\\\n\\State Initialize $f_\\theta \\gets \\texttt{CachedTransformer}()$\n\\State Initialize $(x_i, w_i) \\gets (s_0, 1)$ for $i = 1, \\ldots, N$\n\\State Initialize $t \\gets 1$\n\\While{$x_i \\not\\in \\mathcal{F}$ for some $i \\in \\{1, \\ldots, N\\}$}\n    \\State $K_i \\gets K (1 - \\mathbb{1}_{\\mathcal{F}}(x_i)) + \\mathbb{1}_{\\mathcal{F}}(x_i)$ for $i = 1, \\ldots, N$\n    \\State $N' \\gets \\sum_{i=1}^N K_i$\n    \\For{$i \\in \\{1, \\ldots, N\\}$}\n        \\If{$x_i \\in \\mathcal{F}$}\n            \\State Set $(x_{i,1}, w_{i,1}) \\gets (x_i, w_i \\cdot \\frac{N'}{N})$\n        \\Else\n            \\State Generate $x_{i,k} \\sim M_t(\\cdot \\mid x_i, f_\\theta)$ for $k = 1, \\ldots, K$\n            \\State Set $w_{i,k} \\gets w_i \\cdot G_t(x_i, x_{i,k}, f_\\theta) \\cdot \\frac{N'}{K N}$ for $k = 1, \\ldots, K$\n        \\EndIf\n    \\EndFor\n    \\State Set normalized weights $\\hat{w}_{i,k} \\gets \\frac{w_{(i,k)}}{\\sum_{j=1}^N \\sum_{l=1}^{K_j} w_{(j,l)}}$ for $i = 1, \\ldots, N$ and $k = 1, \\ldots, K_i$\n    \\State Set $c^* \\gets \\inf\\{c \\in \\mathbb{R}_{> 0} \\mid \\sum_{i=1}^N \\sum_{k=1}^{K_i} (\\mathbb{1} \\wedge c \\hat{w}_{(i,k)}) > N\\}$\n    \\State Set $(I_\\text{det}, I_\\text{stoch}, I_\\text{strat}) \\gets (\\{(i,k) \\mid c^{*} \\hat{w}_{i,k} \\geq 1\\}, \\{(i,k) \\mid c^{*} \\cdot \\hat{w}_{i,k} &lt; 1\\}, \\{\\})$\n    \\State Set $\\alpha \\gets \\frac{\\sum_{i \\in I_\\text{stoch}} \\hat{w}_i}{|I_\\text{det}|}$ and generate $U \\sim \\text{Uniform}([0, \\alpha])$\n    \\For{$i \\in I_\\text{stoch}$}\n        \\State Set $U \\gets U - \\hat{w}_i$\n        \\If{$U &lt; 0$}\n            \\State Set $I_\\text{strat} \\gets I_\\text{strat} \\cup \\{i\\}$\n            \\State Set $U \\gets U + \\alpha$\n        \\EndIf\n    \\EndFor\n    \\State Set particles $\\{(x_i, w_i)\\}_{i=1,\\ldots,|I_\\text{det}|} \\gets \\{(x_j, w_j \\cdot \\frac{N}{N'}) \\mid j \\in I_\\text{det}\\}$\n    \\State Set particles $\\{(x_i, w_i)\\}_{i=|I_\\text{det}|+1,\\ldots,N} \\gets \\{(x_j, \\frac{N}{c^* N'} \\sum_{l=1}^{N} \\sum_{k=1}^{K_l} w_{(j,k)}) \\mid j \\in I_\\text{strat}\\}$\n\\EndWhile\n\\State \\Return $\\left((x_i, w_i)_{i=1,\\ldots,N}, \\hat{Z} = \\frac{1}{N} \\sum_{i=1}^N w_i \\right)$\n\\end{algorithmic}\n\\end{algorithm}&quot;
                          </annotation>
                        </semantics>
                      </math>
                    </span>
                    <div class="ps-algorithm with-caption" dir="auto">
                      <p class="ps-line" style="text-indent:-0.6em;padding-left:0.6em;" dir="auto">
                        <span class="ps-keyword">
                          Algorithm 5
                        </span>
                        Sequential Monte Carlo Transformer Steering
                      </p>
                      <div class="ps-algorithmic" dir="auto">
                        <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                          <p class="ps-line ps-code" dir="auto">
                            <span style="font-weight:bold;">
                              Input:
                            </span>
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi>
                                        N
                                      </mi>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      N
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6833em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.10903em;">
                                    N
                                  </span>
                                </span>
                              </span>
                            </span>
                            (# particles),
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi>
                                        K
                                      </mi>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      K
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6833em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.07153em;">
                                    K
                                  </span>
                                </span>
                              </span>
                            </span>
                            (factor), Feynman-Kac Transformer model
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <msub>
                                        <mi>
                                          s
                                        </mi>
                                        <mn>
                                          0
                                        </mn>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <msub>
                                        <mi>
                                          M
                                        </mi>
                                        <mi>
                                          t
                                        </mi>
                                      </msub>
                                      <msub>
                                        <mo stretchy="false">
                                          }
                                        </mo>
                                        <mrow>
                                          <mi>
                                            t
                                          </mi>
                                          <mo>
                                            ≥
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                        </mrow>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <msub>
                                        <mi>
                                          G
                                        </mi>
                                        <mi>
                                          t
                                        </mi>
                                      </msub>
                                      <msub>
                                        <mo stretchy="false">
                                          }
                                        </mo>
                                        <mrow>
                                          <mi>
                                            t
                                          </mi>
                                          <mo>
                                            ≥
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                        </mrow>
                                      </msub>
                                      <mo stretchy="false">
                                        }
                                      </mo>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      \{s_0, \{M_t\}_{t \geq 1}, \{G_t\}_{t \geq 1}\}
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mopen">
                                    {
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      s
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3011em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  0
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mopen">
                                    {
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.10903em;">
                                      M
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2806em;">
                                            <span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  t
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    <span class="mclose">
                                      }
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3011em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    t
                                                  </span>
                                                  <span class="mrel mtight">
                                                    ≥
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2452em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mopen">
                                    {
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      G
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2806em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  t
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    <span class="mclose">
                                      }
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3011em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    t
                                                  </span>
                                                  <span class="mrel mtight">
                                                    ≥
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2452em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    }
                                  </span>
                                </span>
                              </span>
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            <span style="font-weight:bold;">
                              Output:
                            </span>
                            Weighted particle approximation
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <msub>
                                        <mi>
                                          x
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <msub>
                                        <mi>
                                          w
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <msub>
                                        <mo stretchy="false">
                                          }
                                        </mo>
                                        <mrow>
                                          <mi>
                                            i
                                          </mi>
                                          <mo>
                                            =
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mo>
                                            …
                                          </mo>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mi>
                                            N
                                          </mi>
                                        </mrow>
                                      </msub>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      \{(x_i, w_i)\}_{i=1,\ldots,N}
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span>
                                  <span class="mopen">
                                    {(
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      x
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.02691em;">
                                      w
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    )
                                  </span>
                                  <span class="mclose">
                                    <span class="mclose">
                                      }
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3283em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                  <span class="mrel mtight">
                                                    =
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                  <span class="mpunct mtight">
                                                    ,
                                                  </span>
                                                  <span class="minner mtight">
                                                    …
                                                  </span>
                                                  <span class="mpunct mtight">
                                                    ,
                                                  </span>
                                                  <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                    N
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2861em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                            of the posterior
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi mathvariant="double-struck">
                                        P
                                      </mi>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      \mathbb{P}
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6889em;"></span>
                                  <span class="mord mathbb">
                                    P
                                  </span>
                                </span>
                              </span>
                            </span>
                            <br/>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            <span style="font-weight:bold;">
                              Output:
                            </span>
                            Unbiased estimate
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mover accent="true">
                                        <mi>
                                          Z
                                        </mi>
                                        <mo>
                                          ^
                                        </mo>
                                      </mover>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      \hat{Z}
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.9468em;"></span>
                                  <span class="mord accent">
                                    <span class="vlist-t">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.9468em;">
                                          <span style="top:-3em;">
                                            <span class="pstrut" style="height:3em;"></span>
                                            <span class="mord mathnormal" style="margin-right:0.07153em;">
                                              Z
                                            </span>
                                          </span>
                                          <span style="top:-3.2523em;">
                                            <span class="pstrut" style="height:3em;"></span>
                                            <span class="accent-body" style="left:-0.1667em;">
                                              <span class="mord">
                                                ^
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                            of the partition function
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi>
                                        Z
                                      </mi>
                                      <mo>
                                        =
                                      </mo>
                                      <msub>
                                        <mi mathvariant="double-struck">
                                          E
                                        </mi>
                                        <mi mathvariant="double-struck">
                                          M
                                        </mi>
                                      </msub>
                                      <mo stretchy="false">
                                        [
                                      </mo>
                                      <msubsup>
                                        <mo>
                                          ∏
                                        </mo>
                                        <mrow>
                                          <mi>
                                            t
                                          </mi>
                                          <mo>
                                            =
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                        </mrow>
                                        <mi>
                                          T
                                        </mi>
                                      </msubsup>
                                      <msub>
                                        <mi>
                                          G
                                        </mi>
                                        <mi>
                                          t
                                        </mi>
                                      </msub>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <msub>
                                        <mi>
                                          s
                                        </mi>
                                        <mi>
                                          t
                                        </mi>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <msub>
                                        <mi>
                                          s
                                        </mi>
                                        <mrow>
                                          <mi>
                                            t
                                          </mi>
                                          <mo>
                                            −
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                        </mrow>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <msub>
                                        <mi>
                                          f
                                        </mi>
                                        <mi>
                                          θ
                                        </mi>
                                      </msub>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <mo stretchy="false">
                                        ]
                                      </mo>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      Z = \mathbb{E}_\mathbb{M}[\prod_{t=1}^T G_t(s_t, s_{t-1}, f_\theta)]
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6833em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.07153em;">
                                    Z
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    =
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1.2809em;vertical-align:-0.2997em;"></span>
                                  <span class="mord">
                                    <span class="mord mathbb">
                                      E
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3322em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathbb mtight">
                                                  M
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mopen">
                                    [
                                  </span>
                                  <span class="mop">
                                    <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                      ∏
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.9812em;">
                                            <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    t
                                                  </span>
                                                  <span class="mrel mtight">
                                                    =
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span style="top:-3.2029em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight" style="margin-right:0.13889em;">
                                                  T
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2997em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      G
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2806em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  t
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mopen">
                                    (
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      s
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2806em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  t
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      s
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3011em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    t
                                                  </span>
                                                  <span class="mbin mtight">
                                                    −
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2083em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.10764em;">
                                      f
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3361em;">
                                            <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                  θ
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    )]
                                  </span>
                                </span>
                              </span>
                            </span>
                            <br/>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            Initialize
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <msub>
                                        <mi>
                                          f
                                        </mi>
                                        <mi>
                                          θ
                                        </mi>
                                      </msub>
                                      <mo>
                                        ←
                                      </mo>
                                      <mtext mathvariant="monospace">
                                        CachedTransformer
                                      </mtext>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      f_\theta \gets \texttt{CachedTransformer}()
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.10764em;">
                                      f
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3361em;">
                                            <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                  θ
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ←
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mord text">
                                    <span class="mord texttt">
                                      CachedTransformer
                                    </span>
                                  </span>
                                  <span class="mopen">
                                    (
                                  </span>
                                  <span class="mclose">
                                    )
                                  </span>
                                </span>
                              </span>
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            Initialize
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <msub>
                                        <mi>
                                          x
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <msub>
                                        <mi>
                                          w
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <mo>
                                        ←
                                      </mo>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <msub>
                                        <mi>
                                          s
                                        </mi>
                                        <mn>
                                          0
                                        </mn>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      (x_i, w_i) \gets (s_0, 1)
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mopen">
                                    (
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      x
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.02691em;">
                                      w
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    )
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ←
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mopen">
                                    (
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      s
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3011em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  0
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    1
                                  </span>
                                  <span class="mclose">
                                    )
                                  </span>
                                </span>
                              </span>
                            </span>
                            for
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi>
                                        i
                                      </mi>
                                      <mo>
                                        =
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mo>
                                        …
                                      </mo>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mi>
                                        N
                                      </mi>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      i = 1, \ldots, N
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6595em;"></span>
                                  <span class="mord mathnormal">
                                    i
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    =
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span>
                                  <span class="mord">
                                    1
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="minner">
                                    …
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.10903em;">
                                    N
                                  </span>
                                </span>
                              </span>
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            Initialize
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi>
                                        t
                                      </mi>
                                      <mo>
                                        ←
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      t \gets 1
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6151em;"></span>
                                  <span class="mord mathnormal">
                                    t
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ←
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:0.6444em;"></span>
                                  <span class="mord">
                                    1
                                  </span>
                                </span>
                              </span>
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            <span class="ps-keyword">
                              while
                            </span>
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <msub>
                                        <mi>
                                          x
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo>
                                        ∉
                                      </mo>
                                      <mi mathvariant="script">
                                        F
                                      </mi>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      x_i \not\in \mathcal{F}
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      x
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    <span class="mord vbox">
                                      <span class="thinbox">
                                        <span class="rlap">
                                          <span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span>
                                          <span class="inner">
                                            <span class="mord">
                                              <span class="mrel">
                                                
                                              </span>
                                            </span>
                                          </span>
                                          <span class="fix"></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span>
                                  <span class="mrel">
                                    ∈
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:0.6833em;"></span>
                                  <span class="mord mathcal" style="margin-right:0.09931em;">
                                    F
                                  </span>
                                </span>
                              </span>
                            </span>
                            for some
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi>
                                        i
                                      </mi>
                                      <mo>
                                        ∈
                                      </mo>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mo>
                                        …
                                      </mo>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mi>
                                        N
                                      </mi>
                                      <mo stretchy="false">
                                        }
                                      </mo>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      i \in \{1, \ldots, N\}
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6986em;vertical-align:-0.0391em;"></span>
                                  <span class="mord mathnormal">
                                    i
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ∈
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mopen">
                                    {
                                  </span>
                                  <span class="mord">
                                    1
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="minner">
                                    …
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.10903em;">
                                    N
                                  </span>
                                  <span class="mclose">
                                    }
                                  </span>
                                </span>
                              </span>
                            </span>
                            <span class="ps-keyword">
                              do
                            </span>
                          </p>
                          <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                            <p class="ps-line ps-code" dir="auto">
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <msub>
                                          <mi>
                                            K
                                          </mi>
                                          <mi>
                                            i
                                          </mi>
                                        </msub>
                                        <mo>
                                          ←
                                        </mo>
                                        <mi>
                                          K
                                        </mi>
                                        <mo stretchy="false">
                                          (
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                        <mo>
                                          −
                                        </mo>
                                        <msub>
                                          <mn mathvariant="double-struck">
                                            1
                                          </mn>
                                          <mi mathvariant="script">
                                            F
                                          </mi>
                                        </msub>
                                        <mo stretchy="false">
                                          (
                                        </mo>
                                        <msub>
                                          <mi>
                                            x
                                          </mi>
                                          <mi>
                                            i
                                          </mi>
                                        </msub>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                        <mo>
                                          +
                                        </mo>
                                        <msub>
                                          <mn mathvariant="double-struck">
                                            1
                                          </mn>
                                          <mi mathvariant="script">
                                            F
                                          </mi>
                                        </msub>
                                        <mo stretchy="false">
                                          (
                                        </mo>
                                        <msub>
                                          <mi>
                                            x
                                          </mi>
                                          <mi>
                                            i
                                          </mi>
                                        </msub>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        K_i \gets K (1 - \mathbb{1}_{\mathcal{F}}(x_i)) + \mathbb{1}_{\mathcal{F}}(x_i)
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.07153em;">
                                        K
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ←
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.07153em;">
                                      K
                                    </span>
                                    <span class="mopen">
                                      (
                                    </span>
                                    <span class="mord">
                                      1
                                    </span>
                                    <span class="mspace" style="margin-right:0.2222em;"></span>
                                    <span class="mbin">
                                      −
                                    </span>
                                    <span class="mspace" style="margin-right:0.2222em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mord">
                                      <span class="mord">
                                        1
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3283em;">
                                              <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathcal mtight" style="margin-right:0.09931em;">
                                                      F
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mopen">
                                      (
                                    </span>
                                    <span class="mord">
                                      <span class="mord mathnormal">
                                        x
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose">
                                      ))
                                    </span>
                                    <span class="mspace" style="margin-right:0.2222em;"></span>
                                    <span class="mbin">
                                      +
                                    </span>
                                    <span class="mspace" style="margin-right:0.2222em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mord">
                                      <span class="mord">
                                        1
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3283em;">
                                              <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathcal mtight" style="margin-right:0.09931em;">
                                                      F
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mopen">
                                      (
                                    </span>
                                    <span class="mord">
                                      <span class="mord mathnormal">
                                        x
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose">
                                      )
                                    </span>
                                  </span>
                                </span>
                              </span>
                              for
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <mi>
                                          i
                                        </mi>
                                        <mo>
                                          =
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mo>
                                          …
                                        </mo>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mi>
                                          N
                                        </mi>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        i = 1, \ldots, N
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.6595em;"></span>
                                    <span class="mord mathnormal">
                                      i
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      =
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span>
                                    <span class="mord">
                                      1
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="minner">
                                      …
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.10903em;">
                                      N
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </p>
                            <p class="ps-line ps-code" dir="auto">
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <msup>
                                          <mi>
                                            N
                                          </mi>
                                          <mo mathvariant="normal" lspace="0em" rspace="0em">
                                            ′
                                          </mo>
                                        </msup>
                                        <mo>
                                          ←
                                        </mo>
                                        <msubsup>
                                          <mo>
                                            ∑
                                          </mo>
                                          <mrow>
                                            <mi>
                                              i
                                            </mi>
                                            <mo>
                                              =
                                            </mo>
                                            <mn>
                                              1
                                            </mn>
                                          </mrow>
                                          <mi>
                                            N
                                          </mi>
                                        </msubsup>
                                        <msub>
                                          <mi>
                                            K
                                          </mi>
                                          <mi>
                                            i
                                          </mi>
                                        </msub>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        N' \gets \sum_{i=1}^N K_i
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.7519em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                                        N
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.7519em;">
                                              <span style="top:-3.063em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mtight">
                                                      ′
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ←
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1.2809em;vertical-align:-0.2997em;"></span>
                                    <span class="mop">
                                      <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                        ∑
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.9812em;">
                                              <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                    <span class="mrel mtight">
                                                      =
                                                    </span>
                                                    <span class="mord mtight">
                                                      1
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span style="top:-3.2029em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                    N
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2997em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.07153em;">
                                        K
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </p>
                            <p class="ps-line ps-code" dir="auto">
                              <span class="ps-keyword">
                                for
                              </span>
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <mi>
                                          i
                                        </mi>
                                        <mo>
                                          ∈
                                        </mo>
                                        <mo stretchy="false">
                                          {
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mo>
                                          …
                                        </mo>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mi>
                                          N
                                        </mi>
                                        <mo stretchy="false">
                                          }
                                        </mo>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        i \in \{1, \ldots, N\}
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.6986em;vertical-align:-0.0391em;"></span>
                                    <span class="mord mathnormal">
                                      i
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ∈
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mopen">
                                      {
                                    </span>
                                    <span class="mord">
                                      1
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="minner">
                                      …
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.10903em;">
                                      N
                                    </span>
                                    <span class="mclose">
                                      }
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="ps-keyword">
                                do
                              </span>
                            </p>
                            <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                              <p class="ps-line ps-code" dir="auto">
                                <span class="ps-keyword">
                                  if
                                </span>
                                <span class="katex">
                                  <span class="katex-mathml">
                                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                                      <semantics>
                                        <mrow>
                                          <msub>
                                            <mi>
                                              x
                                            </mi>
                                            <mi>
                                              i
                                            </mi>
                                          </msub>
                                          <mo>
                                            ∈
                                          </mo>
                                          <mi mathvariant="script">
                                            F
                                          </mi>
                                        </mrow>
                                        <annotation encoding="application/x-tex">
                                          x_i \in \mathcal{F}
                                        </annotation>
                                      </semantics>
                                    </math>
                                  </span>
                                  <span class="katex-html" aria-hidden="true">
                                    <span class="base">
                                      <span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal">
                                          x
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3117em;">
                                                <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                      <span class="mrel">
                                        ∈
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:0.6833em;"></span>
                                      <span class="mord mathcal" style="margin-right:0.09931em;">
                                        F
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="ps-keyword">
                                  then
                                </span>
                              </p>
                              <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                                <p class="ps-line ps-code" dir="auto">
                                  Set
                                  <span class="katex">
                                    <span class="katex-mathml">
                                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                                        <semantics>
                                          <mrow>
                                            <mo stretchy="false">
                                              (
                                            </mo>
                                            <msub>
                                              <mi>
                                                x
                                              </mi>
                                              <mrow>
                                                <mi>
                                                  i
                                                </mi>
                                                <mo separator="true">
                                                  ,
                                                </mo>
                                                <mn>
                                                  1
                                                </mn>
                                              </mrow>
                                            </msub>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <msub>
                                              <mi>
                                                w
                                              </mi>
                                              <mrow>
                                                <mi>
                                                  i
                                                </mi>
                                                <mo separator="true">
                                                  ,
                                                </mo>
                                                <mn>
                                                  1
                                                </mn>
                                              </mrow>
                                            </msub>
                                            <mo stretchy="false">
                                              )
                                            </mo>
                                            <mo>
                                              ←
                                            </mo>
                                            <mo stretchy="false">
                                              (
                                            </mo>
                                            <msub>
                                              <mi>
                                                x
                                              </mi>
                                              <mi>
                                                i
                                              </mi>
                                            </msub>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <msub>
                                              <mi>
                                                w
                                              </mi>
                                              <mi>
                                                i
                                              </mi>
                                            </msub>
                                            <mo>
                                              ⋅
                                            </mo>
                                            <mfrac>
                                              <msup>
                                                <mi>
                                                  N
                                                </mi>
                                                <mo mathvariant="normal" lspace="0em" rspace="0em">
                                                  ′
                                                </mo>
                                              </msup>
                                              <mi>
                                                N
                                              </mi>
                                            </mfrac>
                                            <mo stretchy="false">
                                              )
                                            </mo>
                                          </mrow>
                                          <annotation encoding="application/x-tex">
                                            (x_{i,1}, w_{i,1}) \gets (x_i, w_i \cdot \frac{N'}{N})
                                          </annotation>
                                        </semantics>
                                      </math>
                                    </span>
                                    <span class="katex-html" aria-hidden="true">
                                      <span class="base">
                                        <span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span>
                                        <span class="mopen">
                                          (
                                        </span>
                                        <span class="mord">
                                          <span class="mord mathnormal">
                                            x
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3117em;">
                                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight">
                                                          i
                                                        </span>
                                                        <span class="mpunct mtight">
                                                          ,
                                                        </span>
                                                        <span class="mord mtight">
                                                          1
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2861em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mpunct">
                                          ,
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.02691em;">
                                            w
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3117em;">
                                                  <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight">
                                                          i
                                                        </span>
                                                        <span class="mpunct mtight">
                                                          ,
                                                        </span>
                                                        <span class="mord mtight">
                                                          1
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2861em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mclose">
                                          )
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                        <span class="mrel">
                                          ←
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                      </span>
                                      <span class="base">
                                        <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                        <span class="mopen">
                                          (
                                        </span>
                                        <span class="mord">
                                          <span class="mord mathnormal">
                                            x
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3117em;">
                                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mpunct">
                                          ,
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.02691em;">
                                            w
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3117em;">
                                                  <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mspace" style="margin-right:0.2222em;"></span>
                                        <span class="mbin">
                                          ⋅
                                        </span>
                                        <span class="mspace" style="margin-right:0.2222em;"></span>
                                      </span>
                                      <span class="base">
                                        <span class="strut" style="height:1.3185em;vertical-align:-0.345em;"></span>
                                        <span class="mord">
                                          <span class="mopen nulldelimiter"></span>
                                          <span class="mfrac">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.9735em;">
                                                  <span style="top:-2.655em;">
                                                    <span class="pstrut" style="height:3em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                          N
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span style="top:-3.23em;">
                                                    <span class="pstrut" style="height:3em;"></span>
                                                    <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                                  </span>
                                                  <span style="top:-3.394em;">
                                                    <span class="pstrut" style="height:3em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mtight">
                                                          <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                            N
                                                          </span>
                                                          <span class="msupsub">
                                                            <span class="vlist-t">
                                                              <span class="vlist-r">
                                                                <span class="vlist" style="height:0.8278em;">
                                                                  <span style="top:-2.931em;margin-right:0.0714em;">
                                                                    <span class="pstrut" style="height:2.5em;"></span>
                                                                    <span class="sizing reset-size3 size1 mtight">
                                                                      <span class="mord mtight">
                                                                        <span class="mord mtight">
                                                                          ′
                                                                        </span>
                                                                      </span>
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.345em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mclose nulldelimiter"></span>
                                        </span>
                                        <span class="mclose">
                                          )
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </p>
                              </div>
                              <p class="ps-line ps-code" dir="auto">
                                <span class="ps-keyword">
                                  else
                                </span>
                              </p>
                              <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                                <p class="ps-line ps-code" dir="auto">
                                  Generate
                                  <span class="katex">
                                    <span class="katex-mathml">
                                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                                        <semantics>
                                          <mrow>
                                            <msub>
                                              <mi>
                                                x
                                              </mi>
                                              <mrow>
                                                <mi>
                                                  i
                                                </mi>
                                                <mo separator="true">
                                                  ,
                                                </mo>
                                                <mi>
                                                  k
                                                </mi>
                                              </mrow>
                                            </msub>
                                            <mo>
                                              ∼
                                            </mo>
                                            <msub>
                                              <mi>
                                                M
                                              </mi>
                                              <mi>
                                                t
                                              </mi>
                                            </msub>
                                            <mo stretchy="false">
                                              (
                                            </mo>
                                            <mo>
                                              ⋅
                                            </mo>
                                            <mo>
                                              ∣
                                            </mo>
                                            <msub>
                                              <mi>
                                                x
                                              </mi>
                                              <mi>
                                                i
                                              </mi>
                                            </msub>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <msub>
                                              <mi>
                                                f
                                              </mi>
                                              <mi>
                                                θ
                                              </mi>
                                            </msub>
                                            <mo stretchy="false">
                                              )
                                            </mo>
                                          </mrow>
                                          <annotation encoding="application/x-tex">
                                            x_{i,k} \sim M_t(\cdot \mid x_i, f_\theta)
                                          </annotation>
                                        </semantics>
                                      </math>
                                    </span>
                                    <span class="katex-html" aria-hidden="true">
                                      <span class="base">
                                        <span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal">
                                            x
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3361em;">
                                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight">
                                                          i
                                                        </span>
                                                        <span class="mpunct mtight">
                                                          ,
                                                        </span>
                                                        <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                          k
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2861em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                        <span class="mrel">
                                          ∼
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                      </span>
                                      <span class="base">
                                        <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.10903em;">
                                            M
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2806em;">
                                                  <span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight">
                                                        t
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mopen">
                                          (
                                        </span>
                                        <span class="mord">
                                          ⋅
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                        <span class="mrel">
                                          ∣
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                      </span>
                                      <span class="base">
                                        <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal">
                                            x
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3117em;">
                                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mpunct">
                                          ,
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.10764em;">
                                            f
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3361em;">
                                                  <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                        θ
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mclose">
                                          )
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  for
                                  <span class="katex">
                                    <span class="katex-mathml">
                                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                                        <semantics>
                                          <mrow>
                                            <mi>
                                              k
                                            </mi>
                                            <mo>
                                              =
                                            </mo>
                                            <mn>
                                              1
                                            </mn>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mo>
                                              …
                                            </mo>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mi>
                                              K
                                            </mi>
                                          </mrow>
                                          <annotation encoding="application/x-tex">
                                            k = 1, \ldots, K
                                          </annotation>
                                        </semantics>
                                      </math>
                                    </span>
                                    <span class="katex-html" aria-hidden="true">
                                      <span class="base">
                                        <span class="strut" style="height:0.6944em;"></span>
                                        <span class="mord mathnormal" style="margin-right:0.03148em;">
                                          k
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                        <span class="mrel">
                                          =
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                      </span>
                                      <span class="base">
                                        <span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span>
                                        <span class="mord">
                                          1
                                        </span>
                                        <span class="mpunct">
                                          ,
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="minner">
                                          …
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mpunct">
                                          ,
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mord mathnormal" style="margin-right:0.07153em;">
                                          K
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </p>
                                <p class="ps-line ps-code" dir="auto">
                                  Set
                                  <span class="katex">
                                    <span class="katex-mathml">
                                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                                        <semantics>
                                          <mrow>
                                            <msub>
                                              <mi>
                                                w
                                              </mi>
                                              <mrow>
                                                <mi>
                                                  i
                                                </mi>
                                                <mo separator="true">
                                                  ,
                                                </mo>
                                                <mi>
                                                  k
                                                </mi>
                                              </mrow>
                                            </msub>
                                            <mo>
                                              ←
                                            </mo>
                                            <msub>
                                              <mi>
                                                w
                                              </mi>
                                              <mi>
                                                i
                                              </mi>
                                            </msub>
                                            <mo>
                                              ⋅
                                            </mo>
                                            <msub>
                                              <mi>
                                                G
                                              </mi>
                                              <mi>
                                                t
                                              </mi>
                                            </msub>
                                            <mo stretchy="false">
                                              (
                                            </mo>
                                            <msub>
                                              <mi>
                                                x
                                              </mi>
                                              <mi>
                                                i
                                              </mi>
                                            </msub>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <msub>
                                              <mi>
                                                x
                                              </mi>
                                              <mrow>
                                                <mi>
                                                  i
                                                </mi>
                                                <mo separator="true">
                                                  ,
                                                </mo>
                                                <mi>
                                                  k
                                                </mi>
                                              </mrow>
                                            </msub>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <msub>
                                              <mi>
                                                f
                                              </mi>
                                              <mi>
                                                θ
                                              </mi>
                                            </msub>
                                            <mo stretchy="false">
                                              )
                                            </mo>
                                            <mo>
                                              ⋅
                                            </mo>
                                            <mfrac>
                                              <msup>
                                                <mi>
                                                  N
                                                </mi>
                                                <mo mathvariant="normal" lspace="0em" rspace="0em">
                                                  ′
                                                </mo>
                                              </msup>
                                              <mrow>
                                                <mi>
                                                  K
                                                </mi>
                                                <mi>
                                                  N
                                                </mi>
                                              </mrow>
                                            </mfrac>
                                          </mrow>
                                          <annotation encoding="application/x-tex">
                                            w_{i,k} \gets w_i \cdot G_t(x_i, x_{i,k}, f_\theta) \cdot \frac{N'}{K N}
                                          </annotation>
                                        </semantics>
                                      </math>
                                    </span>
                                    <span class="katex-html" aria-hidden="true">
                                      <span class="base">
                                        <span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.02691em;">
                                            w
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3361em;">
                                                  <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight">
                                                          i
                                                        </span>
                                                        <span class="mpunct mtight">
                                                          ,
                                                        </span>
                                                        <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                          k
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2861em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                        <span class="mrel">
                                          ←
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                      </span>
                                      <span class="base">
                                        <span class="strut" style="height:0.5945em;vertical-align:-0.15em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.02691em;">
                                            w
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3117em;">
                                                  <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mspace" style="margin-right:0.2222em;"></span>
                                        <span class="mbin">
                                          ⋅
                                        </span>
                                        <span class="mspace" style="margin-right:0.2222em;"></span>
                                      </span>
                                      <span class="base">
                                        <span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal">
                                            G
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2806em;">
                                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight">
                                                        t
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mopen">
                                          (
                                        </span>
                                        <span class="mord">
                                          <span class="mord mathnormal">
                                            x
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3117em;">
                                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mpunct">
                                          ,
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal">
                                            x
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3361em;">
                                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight">
                                                          i
                                                        </span>
                                                        <span class="mpunct mtight">
                                                          ,
                                                        </span>
                                                        <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                          k
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2861em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mpunct">
                                          ,
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.10764em;">
                                            f
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3361em;">
                                                  <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                        θ
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mclose">
                                          )
                                        </span>
                                        <span class="mspace" style="margin-right:0.2222em;"></span>
                                        <span class="mbin">
                                          ⋅
                                        </span>
                                        <span class="mspace" style="margin-right:0.2222em;"></span>
                                      </span>
                                      <span class="base">
                                        <span class="strut" style="height:1.3185em;vertical-align:-0.345em;"></span>
                                        <span class="mord">
                                          <span class="mopen nulldelimiter"></span>
                                          <span class="mfrac">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.9735em;">
                                                  <span style="top:-2.655em;">
                                                    <span class="pstrut" style="height:3em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight" style="margin-right:0.07153em;">
                                                          K
                                                        </span>
                                                        <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                          N
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span style="top:-3.23em;">
                                                    <span class="pstrut" style="height:3em;"></span>
                                                    <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                                  </span>
                                                  <span style="top:-3.394em;">
                                                    <span class="pstrut" style="height:3em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mtight">
                                                          <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                            N
                                                          </span>
                                                          <span class="msupsub">
                                                            <span class="vlist-t">
                                                              <span class="vlist-r">
                                                                <span class="vlist" style="height:0.8278em;">
                                                                  <span style="top:-2.931em;margin-right:0.0714em;">
                                                                    <span class="pstrut" style="height:2.5em;"></span>
                                                                    <span class="sizing reset-size3 size1 mtight">
                                                                      <span class="mord mtight">
                                                                        <span class="mord mtight">
                                                                          ′
                                                                        </span>
                                                                      </span>
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.345em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="mclose nulldelimiter"></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  for
                                  <span class="katex">
                                    <span class="katex-mathml">
                                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                                        <semantics>
                                          <mrow>
                                            <mi>
                                              k
                                            </mi>
                                            <mo>
                                              =
                                            </mo>
                                            <mn>
                                              1
                                            </mn>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mo>
                                              …
                                            </mo>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mi>
                                              K
                                            </mi>
                                          </mrow>
                                          <annotation encoding="application/x-tex">
                                            k = 1, \ldots, K
                                          </annotation>
                                        </semantics>
                                      </math>
                                    </span>
                                    <span class="katex-html" aria-hidden="true">
                                      <span class="base">
                                        <span class="strut" style="height:0.6944em;"></span>
                                        <span class="mord mathnormal" style="margin-right:0.03148em;">
                                          k
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                        <span class="mrel">
                                          =
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                      </span>
                                      <span class="base">
                                        <span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span>
                                        <span class="mord">
                                          1
                                        </span>
                                        <span class="mpunct">
                                          ,
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="minner">
                                          …
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mpunct">
                                          ,
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mord mathnormal" style="margin-right:0.07153em;">
                                          K
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </p>
                              </div>
                              <p class="ps-line ps-code" dir="auto">
                                <span class="ps-keyword">
                                  end if
                                </span>
                              </p>
                            </div>
                            <p class="ps-line ps-code" dir="auto">
                              <span class="ps-keyword">
                                end for
                              </span>
                            </p>
                            <p class="ps-line ps-code" dir="auto">
                              Set normalized weights
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <msub>
                                          <mover accent="true">
                                            <mi>
                                              w
                                            </mi>
                                            <mo>
                                              ^
                                            </mo>
                                          </mover>
                                          <mrow>
                                            <mi>
                                              i
                                            </mi>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mi>
                                              k
                                            </mi>
                                          </mrow>
                                        </msub>
                                        <mo>
                                          ←
                                        </mo>
                                        <mfrac>
                                          <msub>
                                            <mi>
                                              w
                                            </mi>
                                            <mrow>
                                              <mo stretchy="false">
                                                (
                                              </mo>
                                              <mi>
                                                i
                                              </mi>
                                              <mo separator="true">
                                                ,
                                              </mo>
                                              <mi>
                                                k
                                              </mi>
                                              <mo stretchy="false">
                                                )
                                              </mo>
                                            </mrow>
                                          </msub>
                                          <mrow>
                                            <msubsup>
                                              <mo>
                                                ∑
                                              </mo>
                                              <mrow>
                                                <mi>
                                                  j
                                                </mi>
                                                <mo>
                                                  =
                                                </mo>
                                                <mn>
                                                  1
                                                </mn>
                                              </mrow>
                                              <mi>
                                                N
                                              </mi>
                                            </msubsup>
                                            <msubsup>
                                              <mo>
                                                ∑
                                              </mo>
                                              <mrow>
                                                <mi>
                                                  l
                                                </mi>
                                                <mo>
                                                  =
                                                </mo>
                                                <mn>
                                                  1
                                                </mn>
                                              </mrow>
                                              <msub>
                                                <mi>
                                                  K
                                                </mi>
                                                <mi>
                                                  j
                                                </mi>
                                              </msub>
                                            </msubsup>
                                            <msub>
                                              <mi>
                                                w
                                              </mi>
                                              <mrow>
                                                <mo stretchy="false">
                                                  (
                                                </mo>
                                                <mi>
                                                  j
                                                </mi>
                                                <mo separator="true">
                                                  ,
                                                </mo>
                                                <mi>
                                                  l
                                                </mi>
                                                <mo stretchy="false">
                                                  )
                                                </mo>
                                              </mrow>
                                            </msub>
                                          </mrow>
                                        </mfrac>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        \hat{w}_{i,k} \gets \frac{w_{(i,k)}}{\sum_{j=1}^N \sum_{l=1}^{K_j} w_{(j,l)}}
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span>
                                    <span class="mord">
                                      <span class="mord accent">
                                        <span class="vlist-t">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.6944em;">
                                              <span style="top:-3em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="mord mathnormal" style="margin-right:0.02691em;">
                                                  w
                                                </span>
                                              </span>
                                              <span style="top:-3em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="accent-body" style="left:-0.1667em;">
                                                  <span class="mord">
                                                    ^
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3361em;">
                                              <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                    <span class="mpunct mtight">
                                                      ,
                                                    </span>
                                                    <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                      k
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2861em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ←
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1.8399em;vertical-align:-0.9698em;"></span>
                                    <span class="mord">
                                      <span class="mopen nulldelimiter"></span>
                                      <span class="mfrac">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.87em;">
                                              <span style="top:-2.3524em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mop mtight">
                                                      <span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">
                                                        ∑
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t vlist-t2">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.8852em;">
                                                              <span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord mtight">
                                                                    <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                                      j
                                                                    </span>
                                                                    <span class="mrel mtight">
                                                                      =
                                                                    </span>
                                                                    <span class="mord mtight">
                                                                      1
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                              <span style="top:-2.8971em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                                    N
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                            <span class="vlist-s">
                                                              ​
                                                            </span>
                                                          </span>
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.4603em;">
                                                              <span></span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                    <span class="mspace mtight" style="margin-right:0.1952em;"></span>
                                                    <span class="mop mtight">
                                                      <span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">
                                                        ∑
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t vlist-t2">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:1.1966em;">
                                                              <span style="top:-2.1528em;margin-left:0em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord mtight">
                                                                    <span class="mord mathnormal mtight" style="margin-right:0.01968em;">
                                                                      l
                                                                    </span>
                                                                    <span class="mrel mtight">
                                                                      =
                                                                    </span>
                                                                    <span class="mord mtight">
                                                                      1
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                              <span style="top:-3.2085em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord mtight">
                                                                    <span class="mord mtight">
                                                                      <span class="mord mathnormal mtight" style="margin-right:0.07153em;">
                                                                        K
                                                                      </span>
                                                                      <span class="msupsub">
                                                                        <span class="vlist-t vlist-t2">
                                                                          <span class="vlist-r">
                                                                            <span class="vlist" style="height:0.3448em;">
                                                                              <span style="top:-2.3448em;margin-left:-0.0715em;margin-right:0.1em;">
                                                                                <span class="pstrut" style="height:2.6595em;"></span>
                                                                                <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                                                  j
                                                                                </span>
                                                                              </span>
                                                                            </span>
                                                                            <span class="vlist-s">
                                                                              ​
                                                                            </span>
                                                                          </span>
                                                                          <span class="vlist-r">
                                                                            <span class="vlist" style="height:0.5092em;">
                                                                              <span></span>
                                                                            </span>
                                                                          </span>
                                                                        </span>
                                                                      </span>
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                            <span class="vlist-s">
                                                              ​
                                                            </span>
                                                          </span>
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.3472em;">
                                                              <span></span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                    <span class="mspace mtight" style="margin-right:0.1952em;"></span>
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.02691em;">
                                                        w
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t vlist-t2">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.3448em;">
                                                              <span style="top:-2.3448em;margin-left:-0.0269em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5357em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord mtight">
                                                                    <span class="mopen mtight">
                                                                      (
                                                                    </span>
                                                                    <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                                      j
                                                                    </span>
                                                                    <span class="mpunct mtight">
                                                                      ,
                                                                    </span>
                                                                    <span class="mord mathnormal mtight" style="margin-right:0.01968em;">
                                                                      l
                                                                    </span>
                                                                    <span class="mclose mtight">
                                                                      )
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                            <span class="vlist-s">
                                                              ​
                                                            </span>
                                                          </span>
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.3695em;">
                                                              <span></span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span style="top:-3.23em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                              </span>
                                              <span style="top:-3.5686em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.02691em;">
                                                        w
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t vlist-t2">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.3448em;">
                                                              <span style="top:-2.3448em;margin-left:-0.0269em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5357em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord mtight">
                                                                    <span class="mopen mtight">
                                                                      (
                                                                    </span>
                                                                    <span class="mord mathnormal mtight">
                                                                      i
                                                                    </span>
                                                                    <span class="mpunct mtight">
                                                                      ,
                                                                    </span>
                                                                    <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                                      k
                                                                    </span>
                                                                    <span class="mclose mtight">
                                                                      )
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                            <span class="vlist-s">
                                                              ​
                                                            </span>
                                                          </span>
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.3695em;">
                                                              <span></span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.9698em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mclose nulldelimiter"></span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              for
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <mi>
                                          i
                                        </mi>
                                        <mo>
                                          =
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mo>
                                          …
                                        </mo>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mi>
                                          N
                                        </mi>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        i = 1, \ldots, N
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.6595em;"></span>
                                    <span class="mord mathnormal">
                                      i
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      =
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span>
                                    <span class="mord">
                                      1
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="minner">
                                      …
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.10903em;">
                                      N
                                    </span>
                                  </span>
                                </span>
                              </span>
                              and
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <mi>
                                          k
                                        </mi>
                                        <mo>
                                          =
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mo>
                                          …
                                        </mo>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <msub>
                                          <mi>
                                            K
                                          </mi>
                                          <mi>
                                            i
                                          </mi>
                                        </msub>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        k = 1, \ldots, K_i
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.6944em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.03148em;">
                                      k
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      =
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span>
                                    <span class="mord">
                                      1
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="minner">
                                      …
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.07153em;">
                                        K
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </p>
                            <p class="ps-line ps-code" dir="auto">
                              Set
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <msup>
                                          <mi>
                                            c
                                          </mi>
                                          <mo>
                                            ∗
                                          </mo>
                                        </msup>
                                        <mo>
                                          ←
                                        </mo>
                                        <mi>
                                          inf
                                        </mi>
                                        <mo>
                                          ⁡
                                        </mo>
                                        <mo stretchy="false">
                                          {
                                        </mo>
                                        <mi>
                                          c
                                        </mi>
                                        <mo>
                                          ∈
                                        </mo>
                                        <msub>
                                          <mi mathvariant="double-struck">
                                            R
                                          </mi>
                                          <mrow>
                                            <mo>
                                              >
                                            </mo>
                                            <mn>
                                              0
                                            </mn>
                                          </mrow>
                                        </msub>
                                        <mo>
                                          ∣
                                        </mo>
                                        <msubsup>
                                          <mo>
                                            ∑
                                          </mo>
                                          <mrow>
                                            <mi>
                                              i
                                            </mi>
                                            <mo>
                                              =
                                            </mo>
                                            <mn>
                                              1
                                            </mn>
                                          </mrow>
                                          <mi>
                                            N
                                          </mi>
                                        </msubsup>
                                        <msubsup>
                                          <mo>
                                            ∑
                                          </mo>
                                          <mrow>
                                            <mi>
                                              k
                                            </mi>
                                            <mo>
                                              =
                                            </mo>
                                            <mn>
                                              1
                                            </mn>
                                          </mrow>
                                          <msub>
                                            <mi>
                                              K
                                            </mi>
                                            <mi>
                                              i
                                            </mi>
                                          </msub>
                                        </msubsup>
                                        <mo stretchy="false">
                                          (
                                        </mo>
                                        <mn mathvariant="double-struck">
                                          1
                                        </mn>
                                        <mo>
                                          ∧
                                        </mo>
                                        <mi>
                                          c
                                        </mi>
                                        <msub>
                                          <mover accent="true">
                                            <mi>
                                              w
                                            </mi>
                                            <mo>
                                              ^
                                            </mo>
                                          </mover>
                                          <mrow>
                                            <mo stretchy="false">
                                              (
                                            </mo>
                                            <mi>
                                              i
                                            </mi>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mi>
                                              k
                                            </mi>
                                            <mo stretchy="false">
                                              )
                                            </mo>
                                          </mrow>
                                        </msub>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                        <mo>
                                          >
                                        </mo>
                                        <mi>
                                          N
                                        </mi>
                                        <mo stretchy="false">
                                          }
                                        </mo>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        c^* \gets \inf\{c \in \mathbb{R}_{> 0} \mid \sum_{i=1}^N \sum_{k=1}^{K_i} (\mathbb{1} \wedge c \hat{w}_{(i,k)}) > N\}
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.6887em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal">
                                        c
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.6887em;">
                                              <span style="top:-3.063em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mbin mtight">
                                                    ∗
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ←
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mop">
                                      in
                                      <span style="margin-right:0.07778em;">
                                        f
                                      </span>
                                    </span>
                                    <span class="mopen">
                                      {
                                    </span>
                                    <span class="mord mathnormal">
                                      c
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ∈
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mord">
                                      <span class="mord mathbb">
                                        R
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3011em;">
                                              <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mrel mtight">
                                                      >
                                                    </span>
                                                    <span class="mord mtight">
                                                      0
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.1774em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ∣
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1.2809em;vertical-align:-0.2997em;"></span>
                                    <span class="mop">
                                      <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                        ∑
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.9812em;">
                                              <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                    <span class="mrel mtight">
                                                      =
                                                    </span>
                                                    <span class="mord mtight">
                                                      1
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span style="top:-3.2029em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                    N
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2997em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mop">
                                      <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                        ∑
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.9812em;">
                                              <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                      k
                                                    </span>
                                                    <span class="mrel mtight">
                                                      =
                                                    </span>
                                                    <span class="mord mtight">
                                                      1
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span style="top:-3.2029em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.07153em;">
                                                        K
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t vlist-t2">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.3281em;">
                                                              <span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord mathnormal mtight">
                                                                    i
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                            <span class="vlist-s">
                                                              ​
                                                            </span>
                                                          </span>
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.143em;">
                                                              <span></span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2997em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mopen">
                                      (
                                    </span>
                                    <span class="mord">
                                      1
                                    </span>
                                    <span class="mspace" style="margin-right:0.2222em;"></span>
                                    <span class="mbin">
                                      ∧
                                    </span>
                                    <span class="mspace" style="margin-right:0.2222em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span>
                                    <span class="mord mathnormal">
                                      c
                                    </span>
                                    <span class="mord">
                                      <span class="mord accent">
                                        <span class="vlist-t">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.6944em;">
                                              <span style="top:-3em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="mord mathnormal" style="margin-right:0.02691em;">
                                                  w
                                                </span>
                                              </span>
                                              <span style="top:-3em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="accent-body" style="left:-0.1667em;">
                                                  <span class="mord">
                                                    ^
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3448em;">
                                              <span style="top:-2.5198em;margin-left:-0.0269em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mopen mtight">
                                                      (
                                                    </span>
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                    <span class="mpunct mtight">
                                                      ,
                                                    </span>
                                                    <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                      k
                                                    </span>
                                                    <span class="mclose mtight">
                                                      )
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3552em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose">
                                      )
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      >
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.10903em;">
                                      N
                                    </span>
                                    <span class="mclose">
                                      }
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </p>
                            <p class="ps-line ps-code" dir="auto">
                              Set
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <mo stretchy="false">
                                          (
                                        </mo>
                                        <msub>
                                          <mi>
                                            I
                                          </mi>
                                          <mtext>
                                            det
                                          </mtext>
                                        </msub>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <msub>
                                          <mi>
                                            I
                                          </mi>
                                          <mtext>
                                            stoch
                                          </mtext>
                                        </msub>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <msub>
                                          <mi>
                                            I
                                          </mi>
                                          <mtext>
                                            strat
                                          </mtext>
                                        </msub>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                        <mo>
                                          ←
                                        </mo>
                                        <mo stretchy="false">
                                          (
                                        </mo>
                                        <mo stretchy="false">
                                          {
                                        </mo>
                                        <mo stretchy="false">
                                          (
                                        </mo>
                                        <mi>
                                          i
                                        </mi>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mi>
                                          k
                                        </mi>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                        <mo>
                                          ∣
                                        </mo>
                                        <msup>
                                          <mi>
                                            c
                                          </mi>
                                          <mo lspace="0em" rspace="0em">
                                            ∗
                                          </mo>
                                        </msup>
                                        <msub>
                                          <mover accent="true">
                                            <mi>
                                              w
                                            </mi>
                                            <mo>
                                              ^
                                            </mo>
                                          </mover>
                                          <mrow>
                                            <mi>
                                              i
                                            </mi>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mi>
                                              k
                                            </mi>
                                          </mrow>
                                        </msub>
                                        <mo>
                                          ≥
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                        <mo stretchy="false">
                                          }
                                        </mo>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mo stretchy="false">
                                          {
                                        </mo>
                                        <mo stretchy="false">
                                          (
                                        </mo>
                                        <mi>
                                          i
                                        </mi>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mi>
                                          k
                                        </mi>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                        <mo>
                                          ∣
                                        </mo>
                                        <msup>
                                          <mi>
                                            c
                                          </mi>
                                          <mo lspace="0em" rspace="0em">
                                            ∗
                                          </mo>
                                        </msup>
                                        <mo>
                                          ⋅
                                        </mo>
                                        <msub>
                                          <mover accent="true">
                                            <mi>
                                              w
                                            </mi>
                                            <mo>
                                              ^
                                            </mo>
                                          </mover>
                                          <mrow>
                                            <mi>
                                              i
                                            </mi>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mi>
                                              k
                                            </mi>
                                          </mrow>
                                        </msub>
                                        <mo>
                                          &lt;
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                        <mo stretchy="false">
                                          }
                                        </mo>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mo stretchy="false">
                                          {
                                        </mo>
                                        <mo stretchy="false">
                                          }
                                        </mo>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        (I_\text{det}, I_\text{stoch}, I_\text{strat}) \gets (\{(i,k) \mid c^{*} \hat{w}_{i,k} \geq 1\}, \{(i,k) \mid c^{*} \cdot \hat{w}_{i,k} &lt; 1\}, \{\})
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mopen">
                                      (
                                    </span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.07847em;">
                                        I
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3361em;">
                                              <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord text mtight">
                                                    <span class="mord mtight">
                                                      det
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.07847em;">
                                        I
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3361em;">
                                              <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord text mtight">
                                                    <span class="mord mtight">
                                                      stoch
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.07847em;">
                                        I
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2806em;">
                                              <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord text mtight">
                                                    <span class="mord mtight">
                                                      strat
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose">
                                      )
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ←
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mopen">
                                      ({(
                                    </span>
                                    <span class="mord mathnormal">
                                      i
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.03148em;">
                                      k
                                    </span>
                                    <span class="mclose">
                                      )
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ∣
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal">
                                        c
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.6887em;">
                                              <span style="top:-3.063em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mtight">
                                                      ∗
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mord">
                                      <span class="mord accent">
                                        <span class="vlist-t">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.6944em;">
                                              <span style="top:-3em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="mord mathnormal" style="margin-right:0.02691em;">
                                                  w
                                                </span>
                                              </span>
                                              <span style="top:-3em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="accent-body" style="left:-0.1667em;">
                                                  <span class="mord">
                                                    ^
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3361em;">
                                              <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                    <span class="mpunct mtight">
                                                      ,
                                                    </span>
                                                    <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                      k
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2861em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ≥
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mord">
                                      1
                                    </span>
                                    <span class="mclose">
                                      }
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mopen">
                                      {(
                                    </span>
                                    <span class="mord mathnormal">
                                      i
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.03148em;">
                                      k
                                    </span>
                                    <span class="mclose">
                                      )
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ∣
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:0.6887em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal">
                                        c
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.6887em;">
                                              <span style="top:-3.063em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mtight">
                                                      ∗
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.2222em;"></span>
                                    <span class="mbin">
                                      ⋅
                                    </span>
                                    <span class="mspace" style="margin-right:0.2222em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span>
                                    <span class="mord">
                                      <span class="mord accent">
                                        <span class="vlist-t">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.6944em;">
                                              <span style="top:-3em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="mord mathnormal" style="margin-right:0.02691em;">
                                                  w
                                                </span>
                                              </span>
                                              <span style="top:-3em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="accent-body" style="left:-0.1667em;">
                                                  <span class="mord">
                                                    ^
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3361em;">
                                              <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                    <span class="mpunct mtight">
                                                      ,
                                                    </span>
                                                    <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                      k
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2861em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      &lt;
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mord">
                                      1
                                    </span>
                                    <span class="mclose">
                                      }
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mopen">
                                      {
                                    </span>
                                    <span class="mclose">
                                      })
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </p>
                            <p class="ps-line ps-code" dir="auto">
                              Set
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <mi>
                                          α
                                        </mi>
                                        <mo>
                                          ←
                                        </mo>
                                        <mfrac>
                                          <mrow>
                                            <msub>
                                              <mo>
                                                ∑
                                              </mo>
                                              <mrow>
                                                <mi>
                                                  i
                                                </mi>
                                                <mo>
                                                  ∈
                                                </mo>
                                                <msub>
                                                  <mi>
                                                    I
                                                  </mi>
                                                  <mtext>
                                                    stoch
                                                  </mtext>
                                                </msub>
                                              </mrow>
                                            </msub>
                                            <msub>
                                              <mover accent="true">
                                                <mi>
                                                  w
                                                </mi>
                                                <mo>
                                                  ^
                                                </mo>
                                              </mover>
                                              <mi>
                                                i
                                              </mi>
                                            </msub>
                                          </mrow>
                                          <mrow>
                                            <mi mathvariant="normal">
                                              ∣
                                            </mi>
                                            <msub>
                                              <mi>
                                                I
                                              </mi>
                                              <mtext>
                                                det
                                              </mtext>
                                            </msub>
                                            <mi mathvariant="normal">
                                              ∣
                                            </mi>
                                          </mrow>
                                        </mfrac>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        \alpha \gets \frac{\sum_{i \in I_\text{stoch}} \hat{w}_i}{|I_\text{det}|}
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.4306em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.0037em;">
                                      α
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ←
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1.7548em;vertical-align:-0.52em;"></span>
                                    <span class="mord">
                                      <span class="mopen nulldelimiter"></span>
                                      <span class="mfrac">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:1.2348em;">
                                              <span style="top:-2.655em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mtight">
                                                      ∣
                                                    </span>
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.07847em;">
                                                        I
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t vlist-t2">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.3448em;">
                                                              <span style="top:-2.3488em;margin-left:-0.0785em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord text mtight">
                                                                    <span class="mord mtight">
                                                                      det
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                            <span class="vlist-s">
                                                              ​
                                                            </span>
                                                          </span>
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.1512em;">
                                                              <span></span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                    <span class="mord mtight">
                                                      ∣
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span style="top:-3.23em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                              </span>
                                              <span style="top:-3.7098em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mop mtight">
                                                      <span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">
                                                        ∑
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t vlist-t2">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.1667em;">
                                                              <span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord mtight">
                                                                    <span class="mord mathnormal mtight">
                                                                      i
                                                                    </span>
                                                                    <span class="mrel mtight">
                                                                      ∈
                                                                    </span>
                                                                    <span class="mord mtight">
                                                                      <span class="mord mathnormal mtight" style="margin-right:0.07847em;">
                                                                        I
                                                                      </span>
                                                                      <span class="msupsub">
                                                                        <span class="vlist-t vlist-t2">
                                                                          <span class="vlist-r">
                                                                            <span class="vlist" style="height:0.3448em;">
                                                                              <span style="top:-2.3448em;margin-left:-0.0785em;margin-right:0.1em;">
                                                                                <span class="pstrut" style="height:2.6944em;"></span>
                                                                                <span class="mord text mtight">
                                                                                  <span class="mord mtight">
                                                                                    stoch
                                                                                  </span>
                                                                                </span>
                                                                              </span>
                                                                            </span>
                                                                            <span class="vlist-s">
                                                                              ​
                                                                            </span>
                                                                          </span>
                                                                          <span class="vlist-r">
                                                                            <span class="vlist" style="height:0.3496em;">
                                                                              <span></span>
                                                                            </span>
                                                                          </span>
                                                                        </span>
                                                                      </span>
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                            <span class="vlist-s">
                                                              ​
                                                            </span>
                                                          </span>
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.5712em;">
                                                              <span></span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                    <span class="mspace mtight" style="margin-right:0.1952em;"></span>
                                                    <span class="mord mtight">
                                                      <span class="mord accent mtight">
                                                        <span class="vlist-t">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.6944em;">
                                                              <span style="top:-2.7em;">
                                                                <span class="pstrut" style="height:2.7em;"></span>
                                                                <span class="mord mathnormal mtight" style="margin-right:0.02691em;">
                                                                  w
                                                                </span>
                                                              </span>
                                                              <span style="top:-2.7em;">
                                                                <span class="pstrut" style="height:2.7em;"></span>
                                                                <span class="accent-body" style="left:-0.1667em;">
                                                                  <span class="mord mtight">
                                                                    ^
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t vlist-t2">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.3281em;">
                                                              <span style="top:-2.357em;margin-left:-0.0269em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord mathnormal mtight">
                                                                    i
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                            <span class="vlist-s">
                                                              ​
                                                            </span>
                                                          </span>
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.143em;">
                                                              <span></span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.52em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mclose nulldelimiter"></span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              and generate
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <mi>
                                          U
                                        </mi>
                                        <mo>
                                          ∼
                                        </mo>
                                        <mtext>
                                          Uniform
                                        </mtext>
                                        <mo stretchy="false">
                                          (
                                        </mo>
                                        <mo stretchy="false">
                                          [
                                        </mo>
                                        <mn>
                                          0
                                        </mn>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mi>
                                          α
                                        </mi>
                                        <mo stretchy="false">
                                          ]
                                        </mo>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        U \sim \text{Uniform}([0, \alpha])
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.6833em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.10903em;">
                                      U
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ∼
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mord text">
                                      <span class="mord">
                                        Uniform
                                      </span>
                                    </span>
                                    <span class="mopen">
                                      ([
                                    </span>
                                    <span class="mord">
                                      0
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.0037em;">
                                      α
                                    </span>
                                    <span class="mclose">
                                      ])
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </p>
                            <p class="ps-line ps-code" dir="auto">
                              <span class="ps-keyword">
                                for
                              </span>
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <mi>
                                          i
                                        </mi>
                                        <mo>
                                          ∈
                                        </mo>
                                        <msub>
                                          <mi>
                                            I
                                          </mi>
                                          <mtext>
                                            stoch
                                          </mtext>
                                        </msub>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        i \in I_\text{stoch}
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.6986em;vertical-align:-0.0391em;"></span>
                                    <span class="mord mathnormal">
                                      i
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ∈
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.07847em;">
                                        I
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3361em;">
                                              <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord text mtight">
                                                    <span class="mord mtight">
                                                      stoch
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="ps-keyword">
                                do
                              </span>
                            </p>
                            <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                              <p class="ps-line ps-code" dir="auto">
                                Set
                                <span class="katex">
                                  <span class="katex-mathml">
                                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                                      <semantics>
                                        <mrow>
                                          <mi>
                                            U
                                          </mi>
                                          <mo>
                                            ←
                                          </mo>
                                          <mi>
                                            U
                                          </mi>
                                          <mo>
                                            −
                                          </mo>
                                          <msub>
                                            <mover accent="true">
                                              <mi>
                                                w
                                              </mi>
                                              <mo>
                                                ^
                                              </mo>
                                            </mover>
                                            <mi>
                                              i
                                            </mi>
                                          </msub>
                                        </mrow>
                                        <annotation encoding="application/x-tex">
                                          U \gets U - \hat{w}_i
                                        </annotation>
                                      </semantics>
                                    </math>
                                  </span>
                                  <span class="katex-html" aria-hidden="true">
                                    <span class="base">
                                      <span class="strut" style="height:0.6833em;"></span>
                                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                                        U
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                      <span class="mrel">
                                        ←
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span>
                                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                                        U
                                      </span>
                                      <span class="mspace" style="margin-right:0.2222em;"></span>
                                      <span class="mbin">
                                        −
                                      </span>
                                      <span class="mspace" style="margin-right:0.2222em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span>
                                      <span class="mord">
                                        <span class="mord accent">
                                          <span class="vlist-t">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.6944em;">
                                                <span style="top:-3em;">
                                                  <span class="pstrut" style="height:3em;"></span>
                                                  <span class="mord mathnormal" style="margin-right:0.02691em;">
                                                    w
                                                  </span>
                                                </span>
                                                <span style="top:-3em;">
                                                  <span class="pstrut" style="height:3em;"></span>
                                                  <span class="accent-body" style="left:-0.1667em;">
                                                    <span class="mord">
                                                      ^
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3117em;">
                                                <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </p>
                              <p class="ps-line ps-code" dir="auto">
                                <span class="ps-keyword">
                                  if
                                </span>
                                <span class="katex">
                                  <span class="katex-mathml">
                                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                                      <semantics>
                                        <mrow>
                                          <mi>
                                            U
                                          </mi>
                                          <mo>
                                            &lt;
                                          </mo>
                                          <mn>
                                            0
                                          </mn>
                                        </mrow>
                                        <annotation encoding="application/x-tex">
                                          U &lt; 0
                                        </annotation>
                                      </semantics>
                                    </math>
                                  </span>
                                  <span class="katex-html" aria-hidden="true">
                                    <span class="base">
                                      <span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span>
                                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                                        U
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                      <span class="mrel">
                                        &lt;
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:0.6444em;"></span>
                                      <span class="mord">
                                        0
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="ps-keyword">
                                  then
                                </span>
                              </p>
                              <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                                <p class="ps-line ps-code" dir="auto">
                                  Set
                                  <span class="katex">
                                    <span class="katex-mathml">
                                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                                        <semantics>
                                          <mrow>
                                            <msub>
                                              <mi>
                                                I
                                              </mi>
                                              <mtext>
                                                strat
                                              </mtext>
                                            </msub>
                                            <mo>
                                              ←
                                            </mo>
                                            <msub>
                                              <mi>
                                                I
                                              </mi>
                                              <mtext>
                                                strat
                                              </mtext>
                                            </msub>
                                            <mo>
                                              ∪
                                            </mo>
                                            <mo stretchy="false">
                                              {
                                            </mo>
                                            <mi>
                                              i
                                            </mi>
                                            <mo stretchy="false">
                                              }
                                            </mo>
                                          </mrow>
                                          <annotation encoding="application/x-tex">
                                            I_\text{strat} \gets I_\text{strat} \cup \{i\}
                                          </annotation>
                                        </semantics>
                                      </math>
                                    </span>
                                    <span class="katex-html" aria-hidden="true">
                                      <span class="base">
                                        <span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.07847em;">
                                            I
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2806em;">
                                                  <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord text mtight">
                                                        <span class="mord mtight">
                                                          strat
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                        <span class="mrel">
                                          ←
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                      </span>
                                      <span class="base">
                                        <span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.07847em;">
                                            I
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2806em;">
                                                  <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord text mtight">
                                                        <span class="mord mtight">
                                                          strat
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mspace" style="margin-right:0.2222em;"></span>
                                        <span class="mbin">
                                          ∪
                                        </span>
                                        <span class="mspace" style="margin-right:0.2222em;"></span>
                                      </span>
                                      <span class="base">
                                        <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                        <span class="mopen">
                                          {
                                        </span>
                                        <span class="mord mathnormal">
                                          i
                                        </span>
                                        <span class="mclose">
                                          }
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </p>
                                <p class="ps-line ps-code" dir="auto">
                                  Set
                                  <span class="katex">
                                    <span class="katex-mathml">
                                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                                        <semantics>
                                          <mrow>
                                            <mi>
                                              U
                                            </mi>
                                            <mo>
                                              ←
                                            </mo>
                                            <mi>
                                              U
                                            </mi>
                                            <mo>
                                              +
                                            </mo>
                                            <mi>
                                              α
                                            </mi>
                                          </mrow>
                                          <annotation encoding="application/x-tex">
                                            U \gets U + \alpha
                                          </annotation>
                                        </semantics>
                                      </math>
                                    </span>
                                    <span class="katex-html" aria-hidden="true">
                                      <span class="base">
                                        <span class="strut" style="height:0.6833em;"></span>
                                        <span class="mord mathnormal" style="margin-right:0.10903em;">
                                          U
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                        <span class="mrel">
                                          ←
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                      </span>
                                      <span class="base">
                                        <span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span>
                                        <span class="mord mathnormal" style="margin-right:0.10903em;">
                                          U
                                        </span>
                                        <span class="mspace" style="margin-right:0.2222em;"></span>
                                        <span class="mbin">
                                          +
                                        </span>
                                        <span class="mspace" style="margin-right:0.2222em;"></span>
                                      </span>
                                      <span class="base">
                                        <span class="strut" style="height:0.4306em;"></span>
                                        <span class="mord mathnormal" style="margin-right:0.0037em;">
                                          α
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </p>
                              </div>
                              <p class="ps-line ps-code" dir="auto">
                                <span class="ps-keyword">
                                  end if
                                </span>
                              </p>
                            </div>
                            <p class="ps-line ps-code" dir="auto">
                              <span class="ps-keyword">
                                end for
                              </span>
                            </p>
                            <p class="ps-line ps-code" dir="auto">
                              Set particles
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <mo stretchy="false">
                                          {
                                        </mo>
                                        <mo stretchy="false">
                                          (
                                        </mo>
                                        <msub>
                                          <mi>
                                            x
                                          </mi>
                                          <mi>
                                            i
                                          </mi>
                                        </msub>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <msub>
                                          <mi>
                                            w
                                          </mi>
                                          <mi>
                                            i
                                          </mi>
                                        </msub>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                        <msub>
                                          <mo stretchy="false">
                                            }
                                          </mo>
                                          <mrow>
                                            <mi>
                                              i
                                            </mi>
                                            <mo>
                                              =
                                            </mo>
                                            <mn>
                                              1
                                            </mn>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mo>
                                              …
                                            </mo>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mi mathvariant="normal">
                                              ∣
                                            </mi>
                                            <msub>
                                              <mi>
                                                I
                                              </mi>
                                              <mtext>
                                                det
                                              </mtext>
                                            </msub>
                                            <mi mathvariant="normal">
                                              ∣
                                            </mi>
                                          </mrow>
                                        </msub>
                                        <mo>
                                          ←
                                        </mo>
                                        <mo stretchy="false">
                                          {
                                        </mo>
                                        <mo stretchy="false">
                                          (
                                        </mo>
                                        <msub>
                                          <mi>
                                            x
                                          </mi>
                                          <mi>
                                            j
                                          </mi>
                                        </msub>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <msub>
                                          <mi>
                                            w
                                          </mi>
                                          <mi>
                                            j
                                          </mi>
                                        </msub>
                                        <mo>
                                          ⋅
                                        </mo>
                                        <mfrac>
                                          <mi>
                                            N
                                          </mi>
                                          <msup>
                                            <mi>
                                              N
                                            </mi>
                                            <mo mathvariant="normal" lspace="0em" rspace="0em">
                                              ′
                                            </mo>
                                          </msup>
                                        </mfrac>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                        <mo>
                                          ∣
                                        </mo>
                                        <mi>
                                          j
                                        </mi>
                                        <mo>
                                          ∈
                                        </mo>
                                        <msub>
                                          <mi>
                                            I
                                          </mi>
                                          <mtext>
                                            det
                                          </mtext>
                                        </msub>
                                        <mo stretchy="false">
                                          }
                                        </mo>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        \{(x_i, w_i)\}_{i=1,\ldots,|I_\text{det}|} \gets \{(x_j, w_j \cdot \frac{N}{N'}) \mid j \in I_\text{det}\}
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span>
                                    <span class="mopen">
                                      {(
                                    </span>
                                    <span class="mord">
                                      <span class="mord mathnormal">
                                        x
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.02691em;">
                                        w
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose">
                                      )
                                    </span>
                                    <span class="mclose">
                                      <span class="mclose">
                                        }
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3448em;">
                                              <span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                    <span class="mrel mtight">
                                                      =
                                                    </span>
                                                    <span class="mord mtight">
                                                      1
                                                    </span>
                                                    <span class="mpunct mtight">
                                                      ,
                                                    </span>
                                                    <span class="minner mtight">
                                                      …
                                                    </span>
                                                    <span class="mpunct mtight">
                                                      ,
                                                    </span>
                                                    <span class="mord mtight">
                                                      ∣
                                                    </span>
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.07847em;">
                                                        I
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t vlist-t2">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.3448em;">
                                                              <span style="top:-2.3488em;margin-left:-0.0785em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord text mtight">
                                                                    <span class="mord mtight">
                                                                      det
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                            <span class="vlist-s">
                                                              ​
                                                            </span>
                                                          </span>
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.1512em;">
                                                              <span></span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                    <span class="mord mtight">
                                                      ∣
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3552em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ←
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span>
                                    <span class="mopen">
                                      {(
                                    </span>
                                    <span class="mord">
                                      <span class="mord mathnormal">
                                        x
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                    j
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2861em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.02691em;">
                                        w
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                    j
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2861em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.2222em;"></span>
                                    <span class="mbin">
                                      ⋅
                                    </span>
                                    <span class="mspace" style="margin-right:0.2222em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1.2173em;vertical-align:-0.345em;"></span>
                                    <span class="mord">
                                      <span class="mopen nulldelimiter"></span>
                                      <span class="mfrac">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.8723em;">
                                              <span style="top:-2.655em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                        N
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.6828em;">
                                                              <span style="top:-2.786em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord mtight">
                                                                    <span class="mord mtight">
                                                                      ′
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span style="top:-3.23em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                              </span>
                                              <span style="top:-3.394em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                      N
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.345em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mclose nulldelimiter"></span>
                                    </span>
                                    <span class="mclose">
                                      )
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ∣
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.05724em;">
                                      j
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ∈
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.07847em;">
                                        I
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3361em;">
                                              <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord text mtight">
                                                    <span class="mord mtight">
                                                      det
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose">
                                      }
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </p>
                            <p class="ps-line ps-code" dir="auto">
                              Set particles
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <mo stretchy="false">
                                          {
                                        </mo>
                                        <mo stretchy="false">
                                          (
                                        </mo>
                                        <msub>
                                          <mi>
                                            x
                                          </mi>
                                          <mi>
                                            i
                                          </mi>
                                        </msub>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <msub>
                                          <mi>
                                            w
                                          </mi>
                                          <mi>
                                            i
                                          </mi>
                                        </msub>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                        <msub>
                                          <mo stretchy="false">
                                            }
                                          </mo>
                                          <mrow>
                                            <mi>
                                              i
                                            </mi>
                                            <mo>
                                              =
                                            </mo>
                                            <mi mathvariant="normal">
                                              ∣
                                            </mi>
                                            <msub>
                                              <mi>
                                                I
                                              </mi>
                                              <mtext>
                                                det
                                              </mtext>
                                            </msub>
                                            <mi mathvariant="normal">
                                              ∣
                                            </mi>
                                            <mo>
                                              +
                                            </mo>
                                            <mn>
                                              1
                                            </mn>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mo>
                                              …
                                            </mo>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mi>
                                              N
                                            </mi>
                                          </mrow>
                                        </msub>
                                        <mo>
                                          ←
                                        </mo>
                                        <mo stretchy="false">
                                          {
                                        </mo>
                                        <mo stretchy="false">
                                          (
                                        </mo>
                                        <msub>
                                          <mi>
                                            x
                                          </mi>
                                          <mi>
                                            j
                                          </mi>
                                        </msub>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mfrac>
                                          <mi>
                                            N
                                          </mi>
                                          <mrow>
                                            <msup>
                                              <mi>
                                                c
                                              </mi>
                                              <mo>
                                                ∗
                                              </mo>
                                            </msup>
                                            <msup>
                                              <mi>
                                                N
                                              </mi>
                                              <mo mathvariant="normal" lspace="0em" rspace="0em">
                                                ′
                                              </mo>
                                            </msup>
                                          </mrow>
                                        </mfrac>
                                        <msubsup>
                                          <mo>
                                            ∑
                                          </mo>
                                          <mrow>
                                            <mi>
                                              l
                                            </mi>
                                            <mo>
                                              =
                                            </mo>
                                            <mn>
                                              1
                                            </mn>
                                          </mrow>
                                          <mi>
                                            N
                                          </mi>
                                        </msubsup>
                                        <msubsup>
                                          <mo>
                                            ∑
                                          </mo>
                                          <mrow>
                                            <mi>
                                              k
                                            </mi>
                                            <mo>
                                              =
                                            </mo>
                                            <mn>
                                              1
                                            </mn>
                                          </mrow>
                                          <msub>
                                            <mi>
                                              K
                                            </mi>
                                            <mi>
                                              l
                                            </mi>
                                          </msub>
                                        </msubsup>
                                        <msub>
                                          <mi>
                                            w
                                          </mi>
                                          <mrow>
                                            <mo stretchy="false">
                                              (
                                            </mo>
                                            <mi>
                                              j
                                            </mi>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mi>
                                              k
                                            </mi>
                                            <mo stretchy="false">
                                              )
                                            </mo>
                                          </mrow>
                                        </msub>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                        <mo>
                                          ∣
                                        </mo>
                                        <mi>
                                          j
                                        </mi>
                                        <mo>
                                          ∈
                                        </mo>
                                        <msub>
                                          <mi>
                                            I
                                          </mi>
                                          <mtext>
                                            strat
                                          </mtext>
                                        </msub>
                                        <mo stretchy="false">
                                          }
                                        </mo>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        \{(x_i, w_i)\}_{i=|I_\text{det}|+1,\ldots,N} \gets \{(x_j, \frac{N}{c^* N'} \sum_{l=1}^{N} \sum_{k=1}^{K_l} w_{(j,k)}) \mid j \in I_\text{strat}\}
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span>
                                    <span class="mopen">
                                      {(
                                    </span>
                                    <span class="mord">
                                      <span class="mord mathnormal">
                                        x
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.02691em;">
                                        w
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose">
                                      )
                                    </span>
                                    <span class="mclose">
                                      <span class="mclose">
                                        }
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3448em;">
                                              <span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                    <span class="mrel mtight">
                                                      =
                                                    </span>
                                                    <span class="mord mtight">
                                                      ∣
                                                    </span>
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.07847em;">
                                                        I
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t vlist-t2">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.3448em;">
                                                              <span style="top:-2.3488em;margin-left:-0.0785em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord text mtight">
                                                                    <span class="mord mtight">
                                                                      det
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                            <span class="vlist-s">
                                                              ​
                                                            </span>
                                                          </span>
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.1512em;">
                                                              <span></span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                    <span class="mord mtight">
                                                      ∣
                                                    </span>
                                                    <span class="mbin mtight">
                                                      +
                                                    </span>
                                                    <span class="mord mtight">
                                                      1
                                                    </span>
                                                    <span class="mpunct mtight">
                                                      ,
                                                    </span>
                                                    <span class="minner mtight">
                                                      …
                                                    </span>
                                                    <span class="mpunct mtight">
                                                      ,
                                                    </span>
                                                    <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                      N
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3552em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ←
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1.3364em;vertical-align:-0.3552em;"></span>
                                    <span class="mopen">
                                      {(
                                    </span>
                                    <span class="mord">
                                      <span class="mord mathnormal">
                                        x
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                    j
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2861em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord">
                                      <span class="mopen nulldelimiter"></span>
                                      <span class="mfrac">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.8723em;">
                                              <span style="top:-2.655em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight">
                                                        c
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.6183em;">
                                                              <span style="top:-2.786em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mbin mtight">
                                                                    ∗
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                        N
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.6828em;">
                                                              <span style="top:-2.786em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord mtight">
                                                                    <span class="mord mtight">
                                                                      ′
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span style="top:-3.23em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                              </span>
                                              <span style="top:-3.394em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                      N
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.345em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mclose nulldelimiter"></span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mop">
                                      <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                        ∑
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.9812em;">
                                              <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.01968em;">
                                                      l
                                                    </span>
                                                    <span class="mrel mtight">
                                                      =
                                                    </span>
                                                    <span class="mord mtight">
                                                      1
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span style="top:-3.2029em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                      N
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2997em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mop">
                                      <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                        ∑
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.9812em;">
                                              <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                      k
                                                    </span>
                                                    <span class="mrel mtight">
                                                      =
                                                    </span>
                                                    <span class="mord mtight">
                                                      1
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span style="top:-3.2029em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.07153em;">
                                                        K
                                                      </span>
                                                      <span class="msupsub">
                                                        <span class="vlist-t vlist-t2">
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.3448em;">
                                                              <span style="top:-2.3488em;margin-left:-0.0715em;margin-right:0.0714em;">
                                                                <span class="pstrut" style="height:2.5em;"></span>
                                                                <span class="sizing reset-size3 size1 mtight">
                                                                  <span class="mord mathnormal mtight" style="margin-right:0.01968em;">
                                                                    l
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                            <span class="vlist-s">
                                                              ​
                                                            </span>
                                                          </span>
                                                          <span class="vlist-r">
                                                            <span class="vlist" style="height:0.1512em;">
                                                              <span></span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2997em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.02691em;">
                                        w
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3448em;">
                                              <span style="top:-2.5198em;margin-left:-0.0269em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mopen mtight">
                                                      (
                                                    </span>
                                                    <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                      j
                                                    </span>
                                                    <span class="mpunct mtight">
                                                      ,
                                                    </span>
                                                    <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                      k
                                                    </span>
                                                    <span class="mclose mtight">
                                                      )
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3552em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose">
                                      )
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ∣
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.05724em;">
                                      j
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ∈
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.07847em;">
                                        I
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2806em;">
                                              <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord text mtight">
                                                    <span class="mord mtight">
                                                      strat
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose">
                                      }
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </p>
                          </div>
                          <p class="ps-line ps-code" dir="auto">
                            <span class="ps-keyword">
                              end while
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto"></p>
                          <p class="ps-line ps-code" dir="auto">
                            <span class="ps-keyword">
                              return
                            </span>
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mo fence="true">
                                        (
                                      </mo>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <msub>
                                        <mi>
                                          x
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <msub>
                                        <mi>
                                          w
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <msub>
                                        <mo stretchy="false">
                                          )
                                        </mo>
                                        <mrow>
                                          <mi>
                                            i
                                          </mi>
                                          <mo>
                                            =
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mo>
                                            …
                                          </mo>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mi>
                                            N
                                          </mi>
                                        </mrow>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mover accent="true">
                                        <mi>
                                          Z
                                        </mi>
                                        <mo>
                                          ^
                                        </mo>
                                      </mover>
                                      <mo>
                                        =
                                      </mo>
                                      <mfrac>
                                        <mn>
                                          1
                                        </mn>
                                        <mi>
                                          N
                                        </mi>
                                      </mfrac>
                                      <msubsup>
                                        <mo>
                                          ∑
                                        </mo>
                                        <mrow>
                                          <mi>
                                            i
                                          </mi>
                                          <mo>
                                            =
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                        </mrow>
                                        <mi>
                                          N
                                        </mi>
                                      </msubsup>
                                      <msub>
                                        <mi>
                                          w
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo fence="true">
                                        )
                                      </mo>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      \left((x_i, w_i)_{i=1,\ldots,N}, \hat{Z} = \frac{1}{N} \sum_{i=1}^N w_i \right)
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:1.8em;vertical-align:-0.65em;"></span>
                                  <span class="minner">
                                    <span class="mopen delimcenter" style="top:0em;">
                                      <span class="delimsizing size2">
                                        (
                                      </span>
                                    </span>
                                    <span class="mopen">
                                      (
                                    </span>
                                    <span class="mord">
                                      <span class="mord mathnormal">
                                        x
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.02691em;">
                                        w
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose">
                                      <span class="mclose">
                                        )
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3283em;">
                                              <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                    <span class="mrel mtight">
                                                      =
                                                    </span>
                                                    <span class="mord mtight">
                                                      1
                                                    </span>
                                                    <span class="mpunct mtight">
                                                      ,
                                                    </span>
                                                    <span class="minner mtight">
                                                      …
                                                    </span>
                                                    <span class="mpunct mtight">
                                                      ,
                                                    </span>
                                                    <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                      N
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2861em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mpunct">
                                      ,
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord accent">
                                      <span class="vlist-t">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.9468em;">
                                            <span style="top:-3em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="mord mathnormal" style="margin-right:0.07153em;">
                                                Z
                                              </span>
                                            </span>
                                            <span style="top:-3.2523em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="accent-body" style="left:-0.1667em;">
                                                <span class="mord">
                                                  ^
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      =
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mord">
                                      <span class="mopen nulldelimiter"></span>
                                      <span class="mfrac">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.8451em;">
                                              <span style="top:-2.655em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                      N
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span style="top:-3.23em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                              </span>
                                              <span style="top:-3.394em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mtight">
                                                      1
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.345em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mclose nulldelimiter"></span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mop">
                                      <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                        ∑
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.9812em;">
                                              <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                    <span class="mrel mtight">
                                                      =
                                                    </span>
                                                    <span class="mord mtight">
                                                      1
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span style="top:-3.2029em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                    N
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.2997em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.1667em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal" style="margin-right:0.02691em;">
                                        w
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose delimcenter" style="top:0em;">
                                      <span class="delimsizing size2">
                                        )
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>
            <section data-references class="bibliography">
              <h2 id="reference-label" dir="auto">
                References
                <a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#reference-label" class="internal">
                  <span class="indicator-hook"></span>
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                  </svg>
                </a>
              </h2>
              <ul dir="auto">
                <li class="csl-entry" id="bib-lew2023sequentialmontecarlosteering">
                  Lew, A. K., Zhi-Xuan, T., Grand, G., &amp; Mansinghka, V. K. (2023).
                  <i>
                    Sequential Monte Carlo Steering of Large Language Models using Probabilistic Programs
                  </i>
                  . arXiv preprint arXiv:2306.03081
                  <a href="https://arxiv.org/abs/2306.03081" target="_blank" rel="noopener noreferrer" class="csl-external-link internal alias" data-arxiv-id="2306.03081">
                    <span class="indicator-hook"></span>
                    arxiv
                  </a>
                </li>
                <li class="csl-entry" id="bib-vaswani2023attentionneed">
                  Vaswani, A., Shazeer, N., Parmar, N., Uszkoreit, J., Jones, L., Gomez, A. N., Kaiser, L., &amp; Polosukhin, I. (2023).
                  <i>
                    Attention Is All You Need
                  </i>
                  . arXiv preprint arXiv:1706.03762
                  <a href="https://arxiv.org/abs/1706.03762" target="_blank" rel="noopener noreferrer" class="csl-external-link internal alias" data-arxiv-id="1706.03762">
                    <span class="indicator-hook"></span>
                    arxiv
                  </a>
                </li>
              </ul>
            </section>
          </article>
          <div class="page-footer">
            <section data-backlinks="true" class="backlinks">
              <h2 id="backlinks-label">
                Liens retour
                <a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#backlinks-label" class="internal">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                    <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                  </svg>
                </a>
              </h2>
              <div class="overflow">
                <a href="../posts/chatgpt" data-backlink="posts/chatgpt">
                  <div class="small">
                    On ChatGPT and its pedagogical consequences
                  </div>
                  <div class="description">
                    And its implication on how we assess learning. an overview.
                  </div>
                </a>
                <a href="../thoughts/Autoregressive-models" data-backlink="thoughts/Autoregressive-models">
                  <div class="small">
                    Autoregressive models
                  </div>
                  <div class="description">
                    A statistical model is autoregressive if it predicts future values based on past values. For example, an autoregressive model might seek to predict a stock’s future prices based on its past performance.
                  </div>
                </a>
                <a href="../thoughts/Embedding" data-backlink="thoughts/Embedding">
                  <div class="small">
                    Embedding
                  </div>
                  <div class="description">
                    See also Transformers.
                  </div>
                </a>
                <a href="../thoughts/Intelligence-amplification" data-backlink="thoughts/Intelligence-amplification">
                  <div class="small">
                    Intelligence amplification
                  </div>
                  <div class="description">
                    I’m playing around with calling our tech, as it is today, IA (intelligence amplification) instead of AI. IA have the vibe of tools for thought, needing human interaction, and resemble a lot more what we actually have today.
                  </div>
                </a>
                <a href="../thoughts/LLMs" data-backlink="thoughts/LLMs">
                  <div class="small">
                    LLMs
                  </div>
                  <div class="description">
                    large language models, often implemented as autoregressive transformers models. GPTs and friends Most variants of LLMs are decoder-only Have “capabilities” to understand natural language.
                  </div>
                </a>
                <a href="../thoughts/Machine-learning" data-backlink="thoughts/Machine-learning">
                  <div class="small">
                    Machine learning
                  </div>
                  <div class="description">
                    Detects pattern within data and use it to make useful prediction. Generally AI \subset ML \subset DL Some main exploration: Transformers CNN Optimization Gradient descent hyperparameter tuning Recommender systems Reinforcement learning Q-learning Policy Gradient Monte-Carlo Tree Search Generative Models GAN VAE Autoencoder Supervised Q-learning Low-rank adapters Fields mechanistic interpretability Related: linear algebra.
                  </div>
                </a>
                <a href="../thoughts/Turing-complete-Transformers" data-backlink="thoughts/Turing-complete-Transformers">
                  <div class="small">
                    Turing-complete Transformers
                  </div>
                  <div class="description">
                    Turing Complete Transformers: Two Transformers Are More Powerful Than One&quot;We prove transformers are not Turing complete, propose a new architecture that is Turing complete, ...
                  </div>
                </a>
                <a href="../thoughts/constrained-decoding" data-backlink="thoughts/constrained-decoding">
                  <div class="small">
                    constrained decoding
                  </div>
                  <div class="description">
                    structured generations in vLLM a la carte
                  </div>
                </a>
                <a href="../thoughts/optimization" data-backlink="thoughts/optimization">
                  <div class="small">
                    ml optimization
                  </div>
                  <div class="description">
                    A list of optimization functions that can be used in ML training to reduce loss, and more.
                  </div>
                </a>
                <a href="../thoughts/work" data-backlink="thoughts/work">
                  <div class="small">
                    work.
                  </div>
                  <div class="description">
                    Crafts that I have been brewing for the past while.
                  </div>
                </a>
              </div>
            </section>
            <footer class="minimal-footer">
              <ul class="icons">
                <li>
                  <a href="/" target="_self" aria-label="home">
                    <svg viewBox="64 64 896 896" focusable="false" data-icon="home" width="1em" height="1em" fill="currentColor" aria-hidden="true">
                      <path d="M946.5 505L560.1 118.8l-25.9-25.9a31.5 31.5 0 00-44.4 0L77.5 505a63.9 63.9 0 00-18.8 46c.4 35.2 29.7 63.3 64.9 63.3h42.5V940h691.8V614.3h43.4c17.1 0 33.2-6.7 45.3-18.8a63.6 63.6 0 0018.7-45.3c0-17-6.7-33.1-18.8-45.2zM568 868H456V664h112v204zm217.9-325.7V868H632V640c0-22.1-17.9-40-40-40H432c-22.1 0-40 17.9-40 40v228H238.1V542.3h-96l370-369.7 23.1 23.1L882 542.3h-96.1z"></path>
                    </svg>
                  </a>
                </li>
                <li>
                  <a href="https://github.com/aarnphm" target="_blank" aria-label="github">
                    <svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="var(--gray)" aria-label="true">
                      <path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0138.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path>
                    </svg>
                  </a>
                </li>
                <li>
                  <a href="https://twitter.com/aarnphm_" target="_blank" aria-label="twitter">
                    <svg viewBox="64 64 896 896" focusable="false" data-icon="twitter" width="1em" height="1em" fill="var(--gray)" aria-hidden="true">
                      <path d="M928 254.3c-30.6 13.2-63.9 22.7-98.2 26.4a170.1 170.1 0 0075-94 336.64 336.64 0 01-108.2 41.2A170.1 170.1 0 00672 174c-94.5 0-170.5 76.6-170.5 170.6 0 13.2 1.6 26.4 4.2 39.1-141.5-7.4-267.7-75-351.6-178.5a169.32 169.32 0 00-23.2 86.1c0 59.2 30.1 111.4 76 142.1a172 172 0 01-77.1-21.7v2.1c0 82.9 58.6 151.6 136.7 167.4a180.6 180.6 0 01-44.9 5.8c-11.1 0-21.6-1.1-32.2-2.6C211 652 273.9 701.1 348.8 702.7c-58.6 45.9-132 72.9-211.7 72.9-14.3 0-27.5-.5-41.2-2.1C171.5 822 261.2 850 357.8 850 671.4 850 843 590.2 843 364.7c0-7.4 0-14.8-.5-22.2 33.2-24.3 62.3-54.4 85.5-88.2z"></path>
                    </svg>
                  </a>
                </li>
                <li>
                  <a href="https://bsky.app/profile/aarnphm.xyz" target="_blank" aria-label="bsky">
                    <svg viewBox="0 0 512 512" focusable="false" data-icon="bsky" width="1em" height="1em" aria-hidden="true">
                      <path d="M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2c42.1-31.6 110.3-56 110.3 21.8c0 15.5-8.9 130.5-14.1 149.2C478.2 298 412 314.6 353.1 304.5c102.9 17.5 129.1 75.5 72.5 133.5c-107.4 110.2-154.3-27.6-166.3-62.9l0 0c-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8l0 0c-12 35.3-59 173.1-166.3 62.9c-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1C10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z" fill="#1185fe"></path>
                    </svg>
                  </a>
                </li>
              </ul>
              <p class="info">
                Créé avec
                <a href="https://quartz.jzhao.xyz/" target="_blank" rel="noopener noreferrer" aria-label="Quartz links">
                  Quartz v4.4.0
                </a>
                © 2024
              </p>
            </footer>
          </div>
        </section>
        <section class="right sidebar">
          <div class="graph">
            <div id="global-graph-outer">
              <div id="global-graph-container" data-cfg="{&quot;drag&quot;:true,&quot;zoom&quot;:true,&quot;depth&quot;:-1,&quot;scale&quot;:0.9,&quot;repelForce&quot;:0.5,&quot;centerForce&quot;:0.3,&quot;linkDistance&quot;:30,&quot;fontSize&quot;:0.6,&quot;opacityScale&quot;:1,&quot;showTags&quot;:true,&quot;removeTags&quot;:[],&quot;focusOnHover&quot;:true}"></div>
            </div>
          </div>
          <div class="reader" id="reader-view">
            <div class="reader-backdrop"></div>
            <div class="reader-container">
              <div class="reader-header">
                <button class="reader-close" aria-label="Close reader">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
              <div class="reader-content">
                <h1 class="reader-title">
                  Transformers
                </h1>
                <p dir="auto">
                  See also:
                  <a href="../thoughts/LLMs" class="internal" data-slug="thoughts/LLMs" data-no-popover="true">
                    <span class="indicator-hook"></span>
                    LLMs
                  </a>
                  ,
                  <a href="../thoughts/Embedding" class="internal" data-slug="thoughts/Embedding" data-no-popover="true">
                    <span class="indicator-hook"></span>
                    embedding
                  </a>
                  ,
                  <a href="https://bbycroft.net/llm" class="external alias">
                    <span class="indicator-hook"></span>
                    visualisation from Brendan Bycroft
                  </a>
                </p>
                <blockquote>
                  <p dir="auto">
                    A multi-layer perceptron (MLP) architecture built on top of a
                    <a href="../thoughts/Attention#muti-head-attention" class="internal" data-slug="thoughts/Attention" data-no-popover="true">
                      <span class="indicator-hook"></span>
                      multi-head attention
                    </a>
                    mechanism
                    <cite class id="citation--vaswani2023attentionneed--1">
                      (
                      <a href="#bib-vaswani2023attentionneed-reader" data-no-popover="true" data-bib class="internal">
                        <span class="indicator-hook"></span>
                        Vaswani et al., 2023
                      </a>
                      )
                    </cite>
                    to signal high entropy tokens to be amplified and less important tokens to be diminished.
                  </p>
                </blockquote>
                <p dir="auto">
                  ELI5: Mom often creates a food list consists of
                  <span class="katex">
                    <span class="katex-mathml">
                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                          <mrow>
                            <mi>
                              n
                            </mi>
                          </mrow>
                          <annotation encoding="application/x-tex">
                            n
                          </annotation>
                        </semantics>
                      </math>
                    </span>
                    <span class="katex-html" aria-hidden="true">
                      <span class="base">
                        <span class="strut" style="height:0.4306em;"></span>
                        <span class="mord mathnormal">
                          n
                        </span>
                      </span>
                    </span>
                  </span>
                  of items to buy. Your job is to guess what the last item on this list would be.
                </p>
                <p dir="auto">
                  Most implementations are
                  <a href="../thoughts/Autoregressive-models" class="internal" data-slug="thoughts/Autoregressive-models" data-no-popover="true">
                    <span class="indicator-hook"></span>
                    autoregressive
                  </a>
                  . Most major SOTA are decoder-only, as encoder-decoder models has lack behind due to their expensive encoding phase.
                </p>
                <p dir="auto">
                  <a href="../thoughts/state-space-models" class="internal" data-slug="thoughts/state-space-models" data-no-popover="true">
                    <span class="indicator-hook"></span>
                    state-space models
                  </a>
                  which address transformers’
                  <a href="https://arxiv.org/pdf/2009.06732" data-arxiv-id="2009.06732" class="internal" data-no-popover="true">
                    <span class="indicator-hook"></span>
                    efficiency issues
                  </a>
                  in attention layers within information-dense data
                </p>
                <h2 id="memory-limitations-reader" dir="auto">
                  memory limitations.
                  <a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#memory-limitations-reader" class="internal">
                    <span class="indicator-hook"></span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                  </a>
                </h2>
                <p dir="auto">
                  <em>
                    excerpt from
                    <a href="https://arxiv.org/html/2403.14123" data-arxiv-id="2403.14123" class="internal" data-no-popover="true">
                      <span class="indicator-hook"></span>
                      arxiv
                    </a>
                  </em>
                </p>
                <blockquote class="twitter-tweet" data-lang="fr">
                  <p lang="en" dir="auto">
                    &quot;How is LLaMa.cpp possible?&quot;
                    <br/>
                    great post by
                    <a href="https://twitter.com/finbarrtimbers?ref_src=twsrc%5Etfw" class="external alias">
                      <span class="indicator-hook"></span>
                      @finbarrtimbers
                    </a>
                    <a href="https://t.co/yF43inlY87" class="external">
                      <span class="indicator-hook"></span>
                      https://t.co/yF43inlY87
                    </a>
                    <br/>
                    <br/>
                    llama.cpp surprised many people (myself included) with how quickly you can run large LLMs on small computers, e.g. 7B runs @ ~16 tok/s on a MacBook. Wait don't you need supercomputers to work…
                    <a href="https://t.co/EIp9iPkZ6x" class="external alias">
                      <span class="indicator-hook"></span>
                      pic.twitter.com/EIp9iPkZ6x
                    </a>
                  </p>
                  — Andrej Karpathy (@karpathy)
                  <a href="https://twitter.com/karpathy/status/1691571869051445433?ref_src=twsrc%5Etfw" class="alias">
                    <span class="indicator-hook"></span>
                    15 août 2023
                  </a>
                </blockquote>
                <h2 id="inference-reader" dir="auto">
                  inference.
                  <a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#inference-reader" class="internal">
                    <span class="indicator-hook"></span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                  </a>
                </h2>
                <p dir="auto">
                  Either compute-bound (batch inference, saturated usage) or memory-bound (latency)
                </p>
                <p dir="auto">
                  <a href="../thoughts/vllm#speculative-decoding" class="internal" data-slug="thoughts/vllm" data-no-popover="true">
                    <span class="indicator-hook"></span>
                    speculative decoding
                  </a>
                  <span>
                    ⇒
                  </span>
                  memory-bound (to saturate FLOPs)
                </p>
                <h3 id="next-token-prediction-reader" dir="auto">
                  next-token prediction.
                  <a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#next-token-prediction-reader" class="internal">
                    <span class="indicator-hook"></span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                  </a>
                </h3>
                <p dir="auto">
                  Sampling: we essentially look forward K-tokens, and then we sample from the distribution of the next token.
                </p>
                <h2 id="feynman-kac-reader" dir="auto">
                  Feynman-Kac
                  <a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#feynman-kac-reader" class="internal">
                    <span class="indicator-hook"></span>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                      <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                    </svg>
                  </a>
                </h2>
                <p dir="auto">
                  Let
                  <span class="katex">
                    <span class="katex-mathml">
                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                          <mrow>
                            <mi mathvariant="script">
                              V
                            </mi>
                          </mrow>
                          <annotation encoding="application/x-tex">
                            \mathcal{V}
                          </annotation>
                        </semantics>
                      </math>
                    </span>
                    <span class="katex-html" aria-hidden="true">
                      <span class="base">
                        <span class="strut" style="height:0.6833em;"></span>
                        <span class="mord mathcal" style="margin-right:0.08222em;">
                          V
                        </span>
                      </span>
                    </span>
                  </span>
                  be the vocab of given transformers model, and
                  <span class="katex">
                    <span class="katex-mathml">
                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                          <mrow>
                            <mi mathvariant="script">
                              S
                            </mi>
                            <mo>
                              =
                            </mo>
                            <msup>
                              <mi mathvariant="script">
                                V
                              </mi>
                              <mo lspace="0em" rspace="0em">
                                ∗
                              </mo>
                            </msup>
                          </mrow>
                          <annotation encoding="application/x-tex">
                            \mathcal{S} = \mathcal{V}^{*}
                          </annotation>
                        </semantics>
                      </math>
                    </span>
                    <span class="katex-html" aria-hidden="true">
                      <span class="base">
                        <span class="strut" style="height:0.6833em;"></span>
                        <span class="mord mathcal" style="margin-right:0.075em;">
                          S
                        </span>
                        <span class="mspace" style="margin-right:0.2778em;"></span>
                        <span class="mrel">
                          =
                        </span>
                        <span class="mspace" style="margin-right:0.2778em;"></span>
                      </span>
                      <span class="base">
                        <span class="strut" style="height:0.6887em;"></span>
                        <span class="mord">
                          <span class="mord mathcal" style="margin-right:0.08222em;">
                            V
                          </span>
                          <span class="msupsub">
                            <span class="vlist-t">
                              <span class="vlist-r">
                                <span class="vlist" style="height:0.6887em;">
                                  <span style="top:-3.063em;margin-right:0.05em;">
                                    <span class="pstrut" style="height:2.7em;"></span>
                                    <span class="sizing reset-size6 size3 mtight">
                                      <span class="mord mtight">
                                        <span class="mord mtight">
                                          ∗
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                        </span>
                      </span>
                    </span>
                  </span>
                  the set of multi-token strings. Assume
                  <span class="katex">
                    <span class="katex-mathml">
                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                          <mrow>
                            <mi mathvariant="script">
                              V
                            </mi>
                          </mrow>
                          <annotation encoding="application/x-tex">
                            \mathcal{V}
                          </annotation>
                        </semantics>
                      </math>
                    </span>
                    <span class="katex-html" aria-hidden="true">
                      <span class="base">
                        <span class="strut" style="height:0.6833em;"></span>
                        <span class="mord mathcal" style="margin-right:0.08222em;">
                          V
                        </span>
                      </span>
                    </span>
                  </span>
                  contains token
                  <code>
                    EOS
                  </code>
                  and write
                  <span class="katex">
                    <span class="katex-mathml">
                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                          <mrow>
                            <mi mathvariant="script">
                              F
                            </mi>
                            <mo>
                              ⊆
                            </mo>
                            <mi mathvariant="script">
                              S
                            </mi>
                          </mrow>
                          <annotation encoding="application/x-tex">
                            \mathcal{F} \subseteq \mathcal{S}
                          </annotation>
                        </semantics>
                      </math>
                    </span>
                    <span class="katex-html" aria-hidden="true">
                      <span class="base">
                        <span class="strut" style="height:0.8193em;vertical-align:-0.136em;"></span>
                        <span class="mord mathcal" style="margin-right:0.09931em;">
                          F
                        </span>
                        <span class="mspace" style="margin-right:0.2778em;"></span>
                        <span class="mrel">
                          ⊆
                        </span>
                        <span class="mspace" style="margin-right:0.2778em;"></span>
                      </span>
                      <span class="base">
                        <span class="strut" style="height:0.6833em;"></span>
                        <span class="mord mathcal" style="margin-right:0.075em;">
                          S
                        </span>
                      </span>
                    </span>
                  </span>
                  for the set of
                  <code>
                    EOS
                  </code>
                  -terminated strings.
                </p>
                <blockquote class="callout definition" data-callout="definition">
                  <div class="callout-title" dir="auto">
                    <div class="callout-title-inner" dir="auto">
                      <p dir="auto">
                        <em>
                          Feynman-Kac Transformer model
                        </em>
                      </p>
                    </div>
                  </div>
                  <div class="callout-content" dir="auto">
                    <p dir="auto">
                      is a tuple
                      <span class="katex">
                        <span class="katex-mathml">
                          <math xmlns="http://www.w3.org/1998/Math/MathML">
                            <semantics>
                              <mrow>
                                <mo stretchy="false">
                                  (
                                </mo>
                                <msub>
                                  <mi>
                                    s
                                  </mi>
                                  <mn>
                                    0
                                  </mn>
                                </msub>
                                <mo separator="true">
                                  ,
                                </mo>
                                <mo stretchy="false">
                                  {
                                </mo>
                                <msub>
                                  <mi>
                                    M
                                  </mi>
                                  <mi>
                                    t
                                  </mi>
                                </msub>
                                <msub>
                                  <mo stretchy="false">
                                    }
                                  </mo>
                                  <mrow>
                                    <mi>
                                      t
                                    </mi>
                                    <mo>
                                      ≥
                                    </mo>
                                    <mn>
                                      1
                                    </mn>
                                  </mrow>
                                </msub>
                                <mo separator="true">
                                  ,
                                </mo>
                                <mo stretchy="false">
                                  {
                                </mo>
                                <msub>
                                  <mi>
                                    G
                                  </mi>
                                  <mi>
                                    t
                                  </mi>
                                </msub>
                                <msub>
                                  <mo stretchy="false">
                                    }
                                  </mo>
                                  <mrow>
                                    <mi>
                                      t
                                    </mi>
                                    <mo>
                                      ≥
                                    </mo>
                                    <mn>
                                      1
                                    </mn>
                                  </mrow>
                                </msub>
                                <mo stretchy="false">
                                  )
                                </mo>
                              </mrow>
                              <annotation encoding="application/x-tex">
                                (s_{0}, \{M_t\}_{t\ge 1}, \{G_t\}_{t\ge 1})
                              </annotation>
                            </semantics>
                          </math>
                        </span>
                        <span class="katex-html" aria-hidden="true">
                          <span class="base">
                            <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                            <span class="mopen">
                              (
                            </span>
                            <span class="mord">
                              <span class="mord mathnormal">
                                s
                              </span>
                              <span class="msupsub">
                                <span class="vlist-t vlist-t2">
                                  <span class="vlist-r">
                                    <span class="vlist" style="height:0.3011em;">
                                      <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                        <span class="pstrut" style="height:2.7em;"></span>
                                        <span class="sizing reset-size6 size3 mtight">
                                          <span class="mord mtight">
                                            <span class="mord mtight">
                                              0
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="vlist-s">
                                      ​
                                    </span>
                                  </span>
                                  <span class="vlist-r">
                                    <span class="vlist" style="height:0.15em;">
                                      <span></span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                            <span class="mpunct">
                              ,
                            </span>
                            <span class="mspace" style="margin-right:0.1667em;"></span>
                            <span class="mopen">
                              {
                            </span>
                            <span class="mord">
                              <span class="mord mathnormal" style="margin-right:0.10903em;">
                                M
                              </span>
                              <span class="msupsub">
                                <span class="vlist-t vlist-t2">
                                  <span class="vlist-r">
                                    <span class="vlist" style="height:0.2806em;">
                                      <span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;">
                                        <span class="pstrut" style="height:2.7em;"></span>
                                        <span class="sizing reset-size6 size3 mtight">
                                          <span class="mord mathnormal mtight">
                                            t
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="vlist-s">
                                      ​
                                    </span>
                                  </span>
                                  <span class="vlist-r">
                                    <span class="vlist" style="height:0.15em;">
                                      <span></span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                            <span class="mclose">
                              <span class="mclose">
                                }
                              </span>
                              <span class="msupsub">
                                <span class="vlist-t vlist-t2">
                                  <span class="vlist-r">
                                    <span class="vlist" style="height:0.3011em;">
                                      <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                        <span class="pstrut" style="height:2.7em;"></span>
                                        <span class="sizing reset-size6 size3 mtight">
                                          <span class="mord mtight">
                                            <span class="mord mathnormal mtight">
                                              t
                                            </span>
                                            <span class="mrel mtight">
                                              ≥
                                            </span>
                                            <span class="mord mtight">
                                              1
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="vlist-s">
                                      ​
                                    </span>
                                  </span>
                                  <span class="vlist-r">
                                    <span class="vlist" style="height:0.2452em;">
                                      <span></span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                            <span class="mpunct">
                              ,
                            </span>
                            <span class="mspace" style="margin-right:0.1667em;"></span>
                            <span class="mopen">
                              {
                            </span>
                            <span class="mord">
                              <span class="mord mathnormal">
                                G
                              </span>
                              <span class="msupsub">
                                <span class="vlist-t vlist-t2">
                                  <span class="vlist-r">
                                    <span class="vlist" style="height:0.2806em;">
                                      <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                        <span class="pstrut" style="height:2.7em;"></span>
                                        <span class="sizing reset-size6 size3 mtight">
                                          <span class="mord mathnormal mtight">
                                            t
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="vlist-s">
                                      ​
                                    </span>
                                  </span>
                                  <span class="vlist-r">
                                    <span class="vlist" style="height:0.15em;">
                                      <span></span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                            <span class="mclose">
                              <span class="mclose">
                                }
                              </span>
                              <span class="msupsub">
                                <span class="vlist-t vlist-t2">
                                  <span class="vlist-r">
                                    <span class="vlist" style="height:0.3011em;">
                                      <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                        <span class="pstrut" style="height:2.7em;"></span>
                                        <span class="sizing reset-size6 size3 mtight">
                                          <span class="mord mtight">
                                            <span class="mord mathnormal mtight">
                                              t
                                            </span>
                                            <span class="mrel mtight">
                                              ≥
                                            </span>
                                            <span class="mord mtight">
                                              1
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="vlist-s">
                                      ​
                                    </span>
                                  </span>
                                  <span class="vlist-r">
                                    <span class="vlist" style="height:0.2452em;">
                                      <span></span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                            <span class="mclose">
                              )
                            </span>
                          </span>
                        </span>
                      </span>
                      where:
                    </p>
                    <ul dir="auto">
                      <li>
                        <span class="katex">
                          <span class="katex-mathml">
                            <math xmlns="http://www.w3.org/1998/Math/MathML">
                              <semantics>
                                <mrow>
                                  <msub>
                                    <mi>
                                      s
                                    </mi>
                                    <mn>
                                      0
                                    </mn>
                                  </msub>
                                  <mo>
                                    ∈
                                  </mo>
                                  <mi mathvariant="script">
                                    S
                                  </mi>
                                </mrow>
                                <annotation encoding="application/x-tex">
                                  s_{0} \in \mathcal{S}
                                </annotation>
                              </semantics>
                            </math>
                          </span>
                          <span class="katex-html" aria-hidden="true">
                            <span class="base">
                              <span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span>
                              <span class="mord">
                                <span class="mord mathnormal">
                                  s
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.3011em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mtight">
                                              <span class="mord mtight">
                                                0
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.15em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                              <span class="mrel">
                                ∈
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                            </span>
                            <span class="base">
                              <span class="strut" style="height:0.6833em;"></span>
                              <span class="mord mathcal" style="margin-right:0.075em;">
                                S
                              </span>
                            </span>
                          </span>
                        </span>
                        is an
                        <em>
                          initial state
                        </em>
                        , which will take as empty string
                        <span class="katex">
                          <span class="katex-mathml">
                            <math xmlns="http://www.w3.org/1998/Math/MathML">
                              <semantics>
                                <mrow>
                                  <mi>
                                    ϵ
                                  </mi>
                                </mrow>
                                <annotation encoding="application/x-tex">
                                  \epsilon
                                </annotation>
                              </semantics>
                            </math>
                          </span>
                          <span class="katex-html" aria-hidden="true">
                            <span class="base">
                              <span class="strut" style="height:0.4306em;"></span>
                              <span class="mord mathnormal">
                                ϵ
                              </span>
                            </span>
                          </span>
                        </span>
                      </li>
                      <li>
                        <span class="katex">
                          <span class="katex-mathml">
                            <math xmlns="http://www.w3.org/1998/Math/MathML">
                              <semantics>
                                <mrow>
                                  <msub>
                                    <mi>
                                      M
                                    </mi>
                                    <mi>
                                      t
                                    </mi>
                                  </msub>
                                  <mo stretchy="false">
                                    (
                                  </mo>
                                  <msub>
                                    <mi>
                                      s
                                    </mi>
                                    <mi>
                                      t
                                    </mi>
                                  </msub>
                                  <mo>
                                    ∣
                                  </mo>
                                  <msub>
                                    <mi>
                                      s
                                    </mi>
                                    <mrow>
                                      <mi>
                                        t
                                      </mi>
                                      <mo>
                                        −
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                    </mrow>
                                  </msub>
                                  <mo separator="true">
                                    ,
                                  </mo>
                                  <msub>
                                    <mi>
                                      f
                                    </mi>
                                    <mi>
                                      θ
                                    </mi>
                                  </msub>
                                  <mo stretchy="false">
                                    )
                                  </mo>
                                </mrow>
                                <annotation encoding="application/x-tex">
                                  M_t(s_t \mid s_{t-1}, f_\theta)
                                </annotation>
                              </semantics>
                            </math>
                          </span>
                          <span class="katex-html" aria-hidden="true">
                            <span class="base">
                              <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                              <span class="mord">
                                <span class="mord mathnormal" style="margin-right:0.10903em;">
                                  M
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2806em;">
                                        <span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight">
                                              t
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.15em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mopen">
                                (
                              </span>
                              <span class="mord">
                                <span class="mord mathnormal">
                                  s
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2806em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight">
                                              t
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.15em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                              <span class="mrel">
                                ∣
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                            </span>
                            <span class="base">
                              <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                              <span class="mord">
                                <span class="mord mathnormal">
                                  s
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.3011em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                              <span class="mbin mtight">
                                                −
                                              </span>
                                              <span class="mord mtight">
                                                1
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2083em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mpunct">
                                ,
                              </span>
                              <span class="mspace" style="margin-right:0.1667em;"></span>
                              <span class="mord">
                                <span class="mord mathnormal" style="margin-right:0.10764em;">
                                  f
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.3361em;">
                                        <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                              θ
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.15em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mclose">
                                )
                              </span>
                            </span>
                          </span>
                        </span>
                        is a
                        <em>
                          Markov kernel
                        </em>
                        from
                        <span class="katex">
                          <span class="katex-mathml">
                            <math xmlns="http://www.w3.org/1998/Math/MathML">
                              <semantics>
                                <mrow>
                                  <msub>
                                    <mi>
                                      s
                                    </mi>
                                    <mrow>
                                      <mi>
                                        t
                                      </mi>
                                      <mo>
                                        −
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                    </mrow>
                                  </msub>
                                  <mo>
                                    ∈
                                  </mo>
                                  <msup>
                                    <mi mathvariant="script">
                                      F
                                    </mi>
                                    <mi>
                                      c
                                    </mi>
                                  </msup>
                                </mrow>
                                <annotation encoding="application/x-tex">
                                  s_{t-1} \in \mathcal{F}^c
                                </annotation>
                              </semantics>
                            </math>
                          </span>
                          <span class="katex-html" aria-hidden="true">
                            <span class="base">
                              <span class="strut" style="height:0.7474em;vertical-align:-0.2083em;"></span>
                              <span class="mord">
                                <span class="mord mathnormal">
                                  s
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.3011em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                              <span class="mbin mtight">
                                                −
                                              </span>
                                              <span class="mord mtight">
                                                1
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2083em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                              <span class="mrel">
                                ∈
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                            </span>
                            <span class="base">
                              <span class="strut" style="height:0.6833em;"></span>
                              <span class="mord">
                                <span class="mord mathcal" style="margin-right:0.09931em;">
                                  F
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.6644em;">
                                        <span style="top:-3.063em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight">
                                              c
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                        </span>
                        to
                        <span class="katex">
                          <span class="katex-mathml">
                            <math xmlns="http://www.w3.org/1998/Math/MathML">
                              <semantics>
                                <mrow>
                                  <msub>
                                    <mi>
                                      s
                                    </mi>
                                    <mi>
                                      t
                                    </mi>
                                  </msub>
                                  <mo>
                                    ∈
                                  </mo>
                                  <mi mathvariant="script">
                                    S
                                  </mi>
                                </mrow>
                                <annotation encoding="application/x-tex">
                                  s_t \in \mathcal{S}
                                </annotation>
                              </semantics>
                            </math>
                          </span>
                          <span class="katex-html" aria-hidden="true">
                            <span class="base">
                              <span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span>
                              <span class="mord">
                                <span class="mord mathnormal">
                                  s
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2806em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight">
                                              t
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.15em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                              <span class="mrel">
                                ∈
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                            </span>
                            <span class="base">
                              <span class="strut" style="height:0.6833em;"></span>
                              <span class="mord mathcal" style="margin-right:0.075em;">
                                S
                              </span>
                            </span>
                          </span>
                        </span>
                        , parameterised by a transformer network
                        <span class="katex">
                          <span class="katex-mathml">
                            <math xmlns="http://www.w3.org/1998/Math/MathML">
                              <semantics>
                                <mrow>
                                  <msub>
                                    <mi>
                                      f
                                    </mi>
                                    <mi>
                                      θ
                                    </mi>
                                  </msub>
                                  <mo>
                                    :
                                  </mo>
                                  <msup>
                                    <mi mathvariant="script">
                                      F
                                    </mi>
                                    <mi>
                                      c
                                    </mi>
                                  </msup>
                                  <mo>
                                    →
                                  </mo>
                                  <msup>
                                    <mi mathvariant="double-struck">
                                      R
                                    </mi>
                                    <mrow>
                                      <mo>
                                        ∣
                                      </mo>
                                      <mi mathvariant="script">
                                        V
                                      </mi>
                                      <mo>
                                        ∣
                                      </mo>
                                    </mrow>
                                  </msup>
                                </mrow>
                                <annotation encoding="application/x-tex">
                                  f_\theta: \mathcal{F}^c \to \mathbb{R}^{\mid \mathcal{V} \mid}
                                </annotation>
                              </semantics>
                            </math>
                          </span>
                          <span class="katex-html" aria-hidden="true">
                            <span class="base">
                              <span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span>
                              <span class="mord">
                                <span class="mord mathnormal" style="margin-right:0.10764em;">
                                  f
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.3361em;">
                                        <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                              θ
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.15em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                              <span class="mrel">
                                :
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                            </span>
                            <span class="base">
                              <span class="strut" style="height:0.6833em;"></span>
                              <span class="mord">
                                <span class="mord mathcal" style="margin-right:0.09931em;">
                                  F
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.6644em;">
                                        <span style="top:-3.063em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight">
                                              c
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                              <span class="mrel">
                                →
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                            </span>
                            <span class="base">
                              <span class="strut" style="height:0.888em;"></span>
                              <span class="mord">
                                <span class="mord mathbb">
                                  R
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.888em;">
                                        <span style="top:-3.063em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mtight">
                                              <span class="mrel mtight">
                                                ∣
                                              </span>
                                              <span class="mord mathcal mtight" style="margin-right:0.08222em;">
                                                V
                                              </span>
                                              <span class="mrel mtight">
                                                ∣
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                        </span>
                        mapping non-
                        <code>
                          EOS
                        </code>
                        -terminated strings to vectors of logits
                      </li>
                      <li>
                        <span class="katex">
                          <span class="katex-mathml">
                            <math xmlns="http://www.w3.org/1998/Math/MathML">
                              <semantics>
                                <mrow>
                                  <msub>
                                    <mi>
                                      G
                                    </mi>
                                    <mi>
                                      t
                                    </mi>
                                  </msub>
                                  <mo stretchy="false">
                                    (
                                  </mo>
                                  <msub>
                                    <mi>
                                      s
                                    </mi>
                                    <mrow>
                                      <mi>
                                        t
                                      </mi>
                                      <mo>
                                        −
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                    </mrow>
                                  </msub>
                                  <mo separator="true">
                                    ,
                                  </mo>
                                  <msub>
                                    <mi>
                                      s
                                    </mi>
                                    <mi>
                                      t
                                    </mi>
                                  </msub>
                                  <mo separator="true">
                                    ,
                                  </mo>
                                  <msub>
                                    <mi>
                                      f
                                    </mi>
                                    <mi>
                                      θ
                                    </mi>
                                  </msub>
                                  <mo stretchy="false">
                                    )
                                  </mo>
                                </mrow>
                                <annotation encoding="application/x-tex">
                                  G_t(s_{t-1}, s_t, f_\theta)
                                </annotation>
                              </semantics>
                            </math>
                          </span>
                          <span class="katex-html" aria-hidden="true">
                            <span class="base">
                              <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                              <span class="mord">
                                <span class="mord mathnormal">
                                  G
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2806em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight">
                                              t
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.15em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mopen">
                                (
                              </span>
                              <span class="mord">
                                <span class="mord mathnormal">
                                  s
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.3011em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                              <span class="mbin mtight">
                                                −
                                              </span>
                                              <span class="mord mtight">
                                                1
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2083em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mpunct">
                                ,
                              </span>
                              <span class="mspace" style="margin-right:0.1667em;"></span>
                              <span class="mord">
                                <span class="mord mathnormal">
                                  s
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2806em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight">
                                              t
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.15em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mpunct">
                                ,
                              </span>
                              <span class="mspace" style="margin-right:0.1667em;"></span>
                              <span class="mord">
                                <span class="mord mathnormal" style="margin-right:0.10764em;">
                                  f
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.3361em;">
                                        <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                              θ
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.15em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mclose">
                                )
                              </span>
                            </span>
                          </span>
                        </span>
                        is a
                        <em>
                          potential function
                        </em>
                        , mapping a pair
                        <span class="katex">
                          <span class="katex-mathml">
                            <math xmlns="http://www.w3.org/1998/Math/MathML">
                              <semantics>
                                <mrow>
                                  <mo stretchy="false">
                                    (
                                  </mo>
                                  <msub>
                                    <mi>
                                      s
                                    </mi>
                                    <mrow>
                                      <mi>
                                        t
                                      </mi>
                                      <mo>
                                        −
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                    </mrow>
                                  </msub>
                                  <mo separator="true">
                                    ,
                                  </mo>
                                  <msub>
                                    <mi>
                                      s
                                    </mi>
                                    <mi>
                                      t
                                    </mi>
                                  </msub>
                                  <mo stretchy="false">
                                    )
                                  </mo>
                                  <mo>
                                    ∈
                                  </mo>
                                  <msup>
                                    <mi mathvariant="script">
                                      F
                                    </mi>
                                    <mi>
                                      c
                                    </mi>
                                  </msup>
                                  <mo>
                                    ×
                                  </mo>
                                  <mi mathvariant="script">
                                    S
                                  </mi>
                                </mrow>
                                <annotation encoding="application/x-tex">
                                  (s_{t-1}, s_t) \in \mathcal{F}^c \times \mathcal{S}
                                </annotation>
                              </semantics>
                            </math>
                          </span>
                          <span class="katex-html" aria-hidden="true">
                            <span class="base">
                              <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                              <span class="mopen">
                                (
                              </span>
                              <span class="mord">
                                <span class="mord mathnormal">
                                  s
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.3011em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                              <span class="mbin mtight">
                                                −
                                              </span>
                                              <span class="mord mtight">
                                                1
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2083em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mpunct">
                                ,
                              </span>
                              <span class="mspace" style="margin-right:0.1667em;"></span>
                              <span class="mord">
                                <span class="mord mathnormal">
                                  s
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t vlist-t2">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.2806em;">
                                        <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight">
                                              t
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="vlist-s">
                                        ​
                                      </span>
                                    </span>
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.15em;">
                                        <span></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mclose">
                                )
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                              <span class="mrel">
                                ∈
                              </span>
                              <span class="mspace" style="margin-right:0.2778em;"></span>
                            </span>
                            <span class="base">
                              <span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span>
                              <span class="mord">
                                <span class="mord mathcal" style="margin-right:0.09931em;">
                                  F
                                </span>
                                <span class="msupsub">
                                  <span class="vlist-t">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.6644em;">
                                        <span style="top:-3.063em;margin-right:0.05em;">
                                          <span class="pstrut" style="height:2.7em;"></span>
                                          <span class="sizing reset-size6 size3 mtight">
                                            <span class="mord mathnormal mtight">
                                              c
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="mspace" style="margin-right:0.2222em;"></span>
                              <span class="mbin">
                                ×
                              </span>
                              <span class="mspace" style="margin-right:0.2222em;"></span>
                            </span>
                            <span class="base">
                              <span class="strut" style="height:0.6833em;"></span>
                              <span class="mord mathcal" style="margin-right:0.075em;">
                                S
                              </span>
                            </span>
                          </span>
                        </span>
                        to a real-valued non-negative score.
                      </li>
                    </ul>
                  </div>
                </blockquote>
                <p dir="auto">
                  Goal: generate from distribution
                  <span class="katex">
                    <span class="katex-mathml">
                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                          <mrow>
                            <mi mathvariant="double-struck">
                              P
                            </mi>
                          </mrow>
                          <annotation encoding="application/x-tex">
                            \mathbb{P}
                          </annotation>
                        </semantics>
                      </math>
                    </span>
                    <span class="katex-html" aria-hidden="true">
                      <span class="base">
                        <span class="strut" style="height:0.6889em;"></span>
                        <span class="mord mathbb">
                          P
                        </span>
                      </span>
                    </span>
                  </span>
                  that reweights Markove chain
                  <span class="katex">
                    <span class="katex-mathml">
                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                          <mrow>
                            <mi mathvariant="double-struck">
                              M
                            </mi>
                          </mrow>
                          <annotation encoding="application/x-tex">
                            \mathbb{M}
                          </annotation>
                        </semantics>
                      </math>
                    </span>
                    <span class="katex-html" aria-hidden="true">
                      <span class="base">
                        <span class="strut" style="height:0.6889em;"></span>
                        <span class="mord mathbb">
                          M
                        </span>
                      </span>
                    </span>
                  </span>
                  by potential functions
                  <span class="katex">
                    <span class="katex-mathml">
                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                          <mrow>
                            <msub>
                              <mi>
                                G
                              </mi>
                              <mi>
                                t
                              </mi>
                            </msub>
                          </mrow>
                          <annotation encoding="application/x-tex">
                            G_t
                          </annotation>
                        </semantics>
                      </math>
                    </span>
                    <span class="katex-html" aria-hidden="true">
                      <span class="base">
                        <span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span>
                        <span class="mord">
                          <span class="mord mathnormal">
                            G
                          </span>
                          <span class="msupsub">
                            <span class="vlist-t vlist-t2">
                              <span class="vlist-r">
                                <span class="vlist" style="height:0.2806em;">
                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                    <span class="pstrut" style="height:2.7em;"></span>
                                    <span class="sizing reset-size6 size3 mtight">
                                      <span class="mord mathnormal mtight">
                                        t
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="vlist-s">
                                  ​
                                </span>
                              </span>
                              <span class="vlist-r">
                                <span class="vlist" style="height:0.15em;">
                                  <span></span>
                                </span>
                              </span>
                            </span>
                          </span>
                        </span>
                      </span>
                    </span>
                  </span>
                  . We define
                  <mark>
                    <em>
                      step-t filtering posteriors
                    </em>
                    :
                  </mark>
                </p>
                <span class="katex-display">
                  <span class="katex">
                    <span class="katex-mathml">
                      <math xmlns="http://www.w3.org/1998/Math/MathML" display="block">
                        <semantics>
                          <mrow>
                            <msub>
                              <mi>
                                P
                              </mi>
                              <mi>
                                t
                              </mi>
                            </msub>
                            <mo stretchy="false">
                              (
                            </mo>
                            <msub>
                              <mi>
                                s
                              </mi>
                              <mi>
                                t
                              </mi>
                            </msub>
                            <mo stretchy="false">
                              )
                            </mo>
                            <mo>
                              =
                            </mo>
                            <mfrac>
                              <mrow>
                                <msub>
                                  <mi mathvariant="double-struck">
                                    E
                                  </mi>
                                  <mi mathvariant="double-struck">
                                    M
                                  </mi>
                                </msub>
                                <mrow>
                                  <mo fence="true">
                                    [
                                  </mo>
                                  <munderover>
                                    <mo>
                                      ∏
                                    </mo>
                                    <mrow>
                                      <mi>
                                        i
                                      </mi>
                                      <mo>
                                        =
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                    </mrow>
                                    <mrow>
                                      <mi>
                                        t
                                      </mi>
                                      <mo>
                                        ∧
                                      </mo>
                                      <mi>
                                        T
                                      </mi>
                                    </mrow>
                                  </munderover>
                                  <msub>
                                    <mi>
                                      G
                                    </mi>
                                    <mi>
                                      i
                                    </mi>
                                  </msub>
                                  <mo stretchy="false">
                                    (
                                  </mo>
                                  <msub>
                                    <mi>
                                      S
                                    </mi>
                                    <mrow>
                                      <mi>
                                        i
                                      </mi>
                                      <mo>
                                        −
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                    </mrow>
                                  </msub>
                                  <mo separator="true">
                                    ,
                                  </mo>
                                  <msub>
                                    <mi>
                                      S
                                    </mi>
                                    <mi>
                                      i
                                    </mi>
                                  </msub>
                                  <mo separator="true">
                                    ,
                                  </mo>
                                  <msub>
                                    <mi>
                                      f
                                    </mi>
                                    <mi>
                                      θ
                                    </mi>
                                  </msub>
                                  <mo stretchy="false">
                                    )
                                  </mo>
                                  <mo>
                                    ⋅
                                  </mo>
                                  <mo stretchy="false">
                                    [
                                  </mo>
                                  <msub>
                                    <mi>
                                      S
                                    </mi>
                                    <mi>
                                      t
                                    </mi>
                                  </msub>
                                  <mo>
                                    =
                                  </mo>
                                  <msub>
                                    <mi>
                                      s
                                    </mi>
                                    <mi>
                                      t
                                    </mi>
                                  </msub>
                                  <mo stretchy="false">
                                    ]
                                  </mo>
                                  <mo fence="true">
                                    ]
                                  </mo>
                                </mrow>
                              </mrow>
                              <mrow>
                                <msub>
                                  <mi mathvariant="double-struck">
                                    E
                                  </mi>
                                  <mi mathvariant="double-struck">
                                    M
                                  </mi>
                                </msub>
                                <mrow>
                                  <mo fence="true">
                                    [
                                  </mo>
                                  <munderover>
                                    <mo>
                                      ∏
                                    </mo>
                                    <mrow>
                                      <mi>
                                        i
                                      </mi>
                                      <mo>
                                        =
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                    </mrow>
                                    <mrow>
                                      <mi>
                                        t
                                      </mi>
                                      <mo>
                                        ∧
                                      </mo>
                                      <mi>
                                        T
                                      </mi>
                                    </mrow>
                                  </munderover>
                                  <msub>
                                    <mi>
                                      G
                                    </mi>
                                    <mi>
                                      i
                                    </mi>
                                  </msub>
                                  <mo stretchy="false">
                                    (
                                  </mo>
                                  <msub>
                                    <mi>
                                      S
                                    </mi>
                                    <mrow>
                                      <mi>
                                        i
                                      </mi>
                                      <mo>
                                        −
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                    </mrow>
                                  </msub>
                                  <mo separator="true">
                                    ,
                                  </mo>
                                  <msub>
                                    <mi>
                                      S
                                    </mi>
                                    <mi>
                                      i
                                    </mi>
                                  </msub>
                                  <mo separator="true">
                                    ,
                                  </mo>
                                  <msub>
                                    <mi>
                                      f
                                    </mi>
                                    <mi>
                                      θ
                                    </mi>
                                  </msub>
                                  <mo stretchy="false">
                                    )
                                  </mo>
                                  <mo fence="true">
                                    ]
                                  </mo>
                                </mrow>
                              </mrow>
                            </mfrac>
                          </mrow>
                          <annotation encoding="application/x-tex">
                            P_t(s_t) = \frac{\mathbb{E}_\mathbb{M} \left[ \prod_{i=1}^{t \wedge T} G_i(S_{i-1}, S_i, f_\theta) \cdot [S_t = s_t] \right]}{\mathbb{E}_\mathbb{M} \left[ \prod_{i=1}^{t \wedge T} G_i(S_{i-1}, S_i, f_\theta) \right]}
                          </annotation>
                        </semantics>
                      </math>
                    </span>
                    <span class="katex-html" aria-hidden="true">
                      <span class="base">
                        <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                        <span class="mord">
                          <span class="mord mathnormal" style="margin-right:0.13889em;">
                            P
                          </span>
                          <span class="msupsub">
                            <span class="vlist-t vlist-t2">
                              <span class="vlist-r">
                                <span class="vlist" style="height:0.2806em;">
                                  <span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;">
                                    <span class="pstrut" style="height:2.7em;"></span>
                                    <span class="sizing reset-size6 size3 mtight">
                                      <span class="mord mathnormal mtight">
                                        t
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="vlist-s">
                                  ​
                                </span>
                              </span>
                              <span class="vlist-r">
                                <span class="vlist" style="height:0.15em;">
                                  <span></span>
                                </span>
                              </span>
                            </span>
                          </span>
                        </span>
                        <span class="mopen">
                          (
                        </span>
                        <span class="mord">
                          <span class="mord mathnormal">
                            s
                          </span>
                          <span class="msupsub">
                            <span class="vlist-t vlist-t2">
                              <span class="vlist-r">
                                <span class="vlist" style="height:0.2806em;">
                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                    <span class="pstrut" style="height:2.7em;"></span>
                                    <span class="sizing reset-size6 size3 mtight">
                                      <span class="mord mathnormal mtight">
                                        t
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="vlist-s">
                                  ​
                                </span>
                              </span>
                              <span class="vlist-r">
                                <span class="vlist" style="height:0.15em;">
                                  <span></span>
                                </span>
                              </span>
                            </span>
                          </span>
                        </span>
                        <span class="mclose">
                          )
                        </span>
                        <span class="mspace" style="margin-right:0.2778em;"></span>
                        <span class="mrel">
                          =
                        </span>
                        <span class="mspace" style="margin-right:0.2778em;"></span>
                      </span>
                      <span class="base">
                        <span class="strut" style="height:3.88em;vertical-align:-1.69em;"></span>
                        <span class="mord">
                          <span class="mopen nulldelimiter"></span>
                          <span class="mfrac">
                            <span class="vlist-t vlist-t2">
                              <span class="vlist-r">
                                <span class="vlist" style="height:2.19em;">
                                  <span style="top:-2.11em;">
                                    <span class="pstrut" style="height:3.15em;"></span>
                                    <span class="mord">
                                      <span class="mord">
                                        <span class="mord mathbb">
                                          E
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3322em;">
                                                <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mathbb mtight">
                                                      M
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mspace" style="margin-right:0.1667em;"></span>
                                      <span class="minner">
                                        <span class="mopen delimcenter" style="top:0em;">
                                          <span class="delimsizing size2">
                                            [
                                          </span>
                                        </span>
                                        <span class="mop">
                                          <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                            ∏
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.9812em;">
                                                  <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight">
                                                          i
                                                        </span>
                                                        <span class="mrel mtight">
                                                          =
                                                        </span>
                                                        <span class="mord mtight">
                                                          1
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span style="top:-3.2029em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight">
                                                          t
                                                        </span>
                                                        <span class="mbin mtight">
                                                          ∧
                                                        </span>
                                                        <span class="mord mathnormal mtight" style="margin-right:0.13889em;">
                                                          T
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2997em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal">
                                            G
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3117em;">
                                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mopen">
                                          (
                                        </span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.05764em;">
                                            S
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3117em;">
                                                  <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight">
                                                          i
                                                        </span>
                                                        <span class="mbin mtight">
                                                          −
                                                        </span>
                                                        <span class="mord mtight">
                                                          1
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2083em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mpunct">
                                          ,
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.05764em;">
                                            S
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3117em;">
                                                  <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mpunct">
                                          ,
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.10764em;">
                                            f
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3361em;">
                                                  <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                        θ
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mclose">
                                          )
                                        </span>
                                        <span class="mclose delimcenter" style="top:0em;">
                                          <span class="delimsizing size2">
                                            ]
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span style="top:-3.38em;">
                                    <span class="pstrut" style="height:3.15em;"></span>
                                    <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                  </span>
                                  <span style="top:-4.19em;">
                                    <span class="pstrut" style="height:3.15em;"></span>
                                    <span class="mord">
                                      <span class="mord">
                                        <span class="mord mathbb">
                                          E
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3322em;">
                                                <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mathbb mtight">
                                                      M
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mspace" style="margin-right:0.1667em;"></span>
                                      <span class="minner">
                                        <span class="mopen delimcenter" style="top:0em;">
                                          <span class="delimsizing size2">
                                            [
                                          </span>
                                        </span>
                                        <span class="mop">
                                          <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                            ∏
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.9812em;">
                                                  <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight">
                                                          i
                                                        </span>
                                                        <span class="mrel mtight">
                                                          =
                                                        </span>
                                                        <span class="mord mtight">
                                                          1
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span style="top:-3.2029em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight">
                                                          t
                                                        </span>
                                                        <span class="mbin mtight">
                                                          ∧
                                                        </span>
                                                        <span class="mord mathnormal mtight" style="margin-right:0.13889em;">
                                                          T
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2997em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal">
                                            G
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3117em;">
                                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mopen">
                                          (
                                        </span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.05764em;">
                                            S
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3117em;">
                                                  <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight">
                                                          i
                                                        </span>
                                                        <span class="mbin mtight">
                                                          −
                                                        </span>
                                                        <span class="mord mtight">
                                                          1
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2083em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mpunct">
                                          ,
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.05764em;">
                                            S
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3117em;">
                                                  <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mpunct">
                                          ,
                                        </span>
                                        <span class="mspace" style="margin-right:0.1667em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.10764em;">
                                            f
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.3361em;">
                                                  <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                        θ
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mclose">
                                          )
                                        </span>
                                        <span class="mspace" style="margin-right:0.2222em;"></span>
                                        <span class="mbin">
                                          ⋅
                                        </span>
                                        <span class="mspace" style="margin-right:0.2222em;"></span>
                                        <span class="mopen">
                                          [
                                        </span>
                                        <span class="mord">
                                          <span class="mord mathnormal" style="margin-right:0.05764em;">
                                            S
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2806em;">
                                                  <span style="top:-2.55em;margin-left:-0.0576em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight">
                                                        t
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                        <span class="mrel">
                                          =
                                        </span>
                                        <span class="mspace" style="margin-right:0.2778em;"></span>
                                        <span class="mord">
                                          <span class="mord mathnormal">
                                            s
                                          </span>
                                          <span class="msupsub">
                                            <span class="vlist-t vlist-t2">
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.2806em;">
                                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                    <span class="pstrut" style="height:2.7em;"></span>
                                                    <span class="sizing reset-size6 size3 mtight">
                                                      <span class="mord mathnormal mtight">
                                                        t
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span class="vlist-s">
                                                  ​
                                                </span>
                                              </span>
                                              <span class="vlist-r">
                                                <span class="vlist" style="height:0.15em;">
                                                  <span></span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mclose">
                                          ]
                                        </span>
                                        <span class="mclose delimcenter" style="top:0em;">
                                          <span class="delimsizing size2">
                                            ]
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="vlist-s">
                                  ​
                                </span>
                              </span>
                              <span class="vlist-r">
                                <span class="vlist" style="height:1.69em;">
                                  <span></span>
                                </span>
                              </span>
                            </span>
                          </span>
                          <span class="mclose nulldelimiter"></span>
                        </span>
                      </span>
                    </span>
                  </span>
                </span>
                <p dir="auto">
                  <em>
                    Given that
                    <span class="katex">
                      <span class="katex-mathml">
                        <math xmlns="http://www.w3.org/1998/Math/MathML">
                          <semantics>
                            <mrow>
                              <mi>
                                T
                              </mi>
                            </mrow>
                            <annotation encoding="application/x-tex">
                              T
                            </annotation>
                          </semantics>
                        </math>
                      </span>
                      <span class="katex-html" aria-hidden="true">
                        <span class="base">
                          <span class="strut" style="height:0.6833em;"></span>
                          <span class="mord mathnormal" style="margin-right:0.13889em;">
                            T
                          </span>
                        </span>
                      </span>
                    </span>
                    is mostly finite
                  </em>
                  we can then define
                  <em>
                    overall posterior
                  </em>
                  <span class="katex">
                    <span class="katex-mathml">
                      <math xmlns="http://www.w3.org/1998/Math/MathML">
                        <semantics>
                          <mrow>
                            <mi mathvariant="double-struck">
                              P
                            </mi>
                            <mo stretchy="false">
                              (
                            </mo>
                            <mi>
                              s
                            </mi>
                            <mo stretchy="false">
                              )
                            </mo>
                            <mo>
                              =
                            </mo>
                            <msub>
                              <mrow>
                                <mi>
                                  lim
                                </mi>
                                <mo>
                                  ⁡
                                </mo>
                              </mrow>
                              <mrow>
                                <mi>
                                  t
                                </mi>
                                <mo>
                                  →
                                </mo>
                                <mi mathvariant="normal">
                                  ∞
                                </mi>
                              </mrow>
                            </msub>
                            <msub>
                              <mi mathvariant="double-struck">
                                P
                              </mi>
                              <mi>
                                t
                              </mi>
                            </msub>
                            <mo stretchy="false">
                              (
                            </mo>
                            <mi>
                              s
                            </mi>
                            <mo stretchy="false">
                              )
                            </mo>
                          </mrow>
                          <annotation encoding="application/x-tex">
                            \mathbb{P}(s) = \lim_{t \to \infty} \mathbb{P}_t(s)
                          </annotation>
                        </semantics>
                      </math>
                    </span>
                    <span class="katex-html" aria-hidden="true">
                      <span class="base">
                        <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                        <span class="mord mathbb">
                          P
                        </span>
                        <span class="mopen">
                          (
                        </span>
                        <span class="mord mathnormal">
                          s
                        </span>
                        <span class="mclose">
                          )
                        </span>
                        <span class="mspace" style="margin-right:0.2778em;"></span>
                        <span class="mrel">
                          =
                        </span>
                        <span class="mspace" style="margin-right:0.2778em;"></span>
                      </span>
                      <span class="base">
                        <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                        <span class="mop">
                          <span class="mop">
                            lim
                          </span>
                          <span class="msupsub">
                            <span class="vlist-t vlist-t2">
                              <span class="vlist-r">
                                <span class="vlist" style="height:0.2806em;">
                                  <span style="top:-2.55em;margin-right:0.05em;">
                                    <span class="pstrut" style="height:2.7em;"></span>
                                    <span class="sizing reset-size6 size3 mtight">
                                      <span class="mord mtight">
                                        <span class="mord mathnormal mtight">
                                          t
                                        </span>
                                        <span class="mrel mtight">
                                          →
                                        </span>
                                        <span class="mord mtight">
                                          ∞
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="vlist-s">
                                  ​
                                </span>
                              </span>
                              <span class="vlist-r">
                                <span class="vlist" style="height:0.15em;">
                                  <span></span>
                                </span>
                              </span>
                            </span>
                          </span>
                        </span>
                        <span class="mspace" style="margin-right:0.1667em;"></span>
                        <span class="mord">
                          <span class="mord mathbb">
                            P
                          </span>
                          <span class="msupsub">
                            <span class="vlist-t vlist-t2">
                              <span class="vlist-r">
                                <span class="vlist" style="height:0.2806em;">
                                  <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                    <span class="pstrut" style="height:2.7em;"></span>
                                    <span class="sizing reset-size6 size3 mtight">
                                      <span class="mord mathnormal mtight">
                                        t
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="vlist-s">
                                  ​
                                </span>
                              </span>
                              <span class="vlist-r">
                                <span class="vlist" style="height:0.15em;">
                                  <span></span>
                                </span>
                              </span>
                            </span>
                          </span>
                        </span>
                        <span class="mopen">
                          (
                        </span>
                        <span class="mord mathnormal">
                          s
                        </span>
                        <span class="mclose">
                          )
                        </span>
                      </span>
                    </span>
                  </span>
                  <cite class id="citation--lew2023sequentialmontecarlosteering--2">
                    (
                    <a href="#bib-lew2023sequentialmontecarlosteering-reader" data-no-popover="true" data-bib class="internal">
                      <span class="indicator-hook"></span>
                      Lew et al., 2023, p. see 2.2 for examples
                    </a>
                    )
                  </cite>
                </p>
                <div class="ps-root" data-inline-macros data-settings="{&quot;code&quot;:&quot;pseudo&quot;,&quot;css&quot;:&quot;latex-pseudo&quot;,&quot;removeCaptionCount&quot;:false,&quot;renderer&quot;:{&quot;indentSize&quot;:&quot;0.6em&quot;,&quot;commentDelimiter&quot;:&quot;  ▷&quot;,&quot;lineNumberPunc&quot;:&quot;:&quot;,&quot;lineNumber&quot;:true,&quot;noEnd&quot;:false,&quot;scopeLines&quot;:false,&quot;titlePrefix&quot;:&quot;Algorithm&quot;,&quot;mathEngine&quot;:&quot;katex&quot;}}" dir="auto">
                  <button class="clipboard-button ps-clipboard" aria-label="Copy pseudocode to clipboard" tabindex="-1">
                    <svg aria-hidden="true" class="copy-icon" width="16" height="16" version="1.1" viewBox="0 0 16 16" data-view-component>
                      <path fill-rule="evenodd" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 010 1.5h-1.5a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-1.5a.75.75 0 011.5 0v1.5A1.75 1.75 0 019.25 16h-7.5A1.75 1.75 0 010 14.25v-7.5z"></path>
                      <path fill-rule="evenodd" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0114.25 11h-7.5A1.75 1.75 0 015 9.25v-7.5zm1.75-.25a.25.25 0 00-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-7.5z"></path>
                    </svg>
                    <svg aria-hidden="true" class="check-icon" version="1.1" width="16" height="16" viewBox="0 0 16 16" data-view-component>
                      <path fill-rule="evenodd" fill="rgb(63, 185, 80)" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path>
                    </svg>
                  </button>
                  <span class="ps-mathml">
                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                      <semantics>
                        <annotation encoding="application/x-tex">
                          &quot;\\begin{algorithm}\n\\caption{Sequential Monte Carlo Transformer Steering}\n\\begin{algorithmic}\n\\State \\textbf{Input:} $N$ (\\# particles), $K$ (factor), Feynman-Kac Transformer model $\\{s_0, \\{M_t\\}_{t \\geq 1}, \\{G_t\\}_{t \\geq 1}\\}$\n\\State \\textbf{Output:} Weighted particle approximation $\\{(x_i, w_i)\\}_{i=1,\\ldots,N}$ of the posterior $\\mathbb{P}$ \\\\\n\\State \\textbf{Output:} Unbiased estimate $\\hat{Z}$ of the partition function $Z = \\mathbb{E}_\\mathbb{M}[\\prod_{t=1}^T G_t(s_t, s_{t-1}, f_\\theta)]$ \\\\\n\\State Initialize $f_\\theta \\gets \\texttt{CachedTransformer}()$\n\\State Initialize $(x_i, w_i) \\gets (s_0, 1)$ for $i = 1, \\ldots, N$\n\\State Initialize $t \\gets 1$\n\\While{$x_i \\not\\in \\mathcal{F}$ for some $i \\in \\{1, \\ldots, N\\}$}\n    \\State $K_i \\gets K (1 - \\mathbb{1}_{\\mathcal{F}}(x_i)) + \\mathbb{1}_{\\mathcal{F}}(x_i)$ for $i = 1, \\ldots, N$\n    \\State $N' \\gets \\sum_{i=1}^N K_i$\n    \\For{$i \\in \\{1, \\ldots, N\\}$}\n        \\If{$x_i \\in \\mathcal{F}$}\n            \\State Set $(x_{i,1}, w_{i,1}) \\gets (x_i, w_i \\cdot \\frac{N'}{N})$\n        \\Else\n            \\State Generate $x_{i,k} \\sim M_t(\\cdot \\mid x_i, f_\\theta)$ for $k = 1, \\ldots, K$\n            \\State Set $w_{i,k} \\gets w_i \\cdot G_t(x_i, x_{i,k}, f_\\theta) \\cdot \\frac{N'}{K N}$ for $k = 1, \\ldots, K$\n        \\EndIf\n    \\EndFor\n    \\State Set normalized weights $\\hat{w}_{i,k} \\gets \\frac{w_{(i,k)}}{\\sum_{j=1}^N \\sum_{l=1}^{K_j} w_{(j,l)}}$ for $i = 1, \\ldots, N$ and $k = 1, \\ldots, K_i$\n    \\State Set $c^* \\gets \\inf\\{c \\in \\mathbb{R}_{> 0} \\mid \\sum_{i=1}^N \\sum_{k=1}^{K_i} (\\mathbb{1} \\wedge c \\hat{w}_{(i,k)}) > N\\}$\n    \\State Set $(I_\\text{det}, I_\\text{stoch}, I_\\text{strat}) \\gets (\\{(i,k) \\mid c^{*} \\hat{w}_{i,k} \\geq 1\\}, \\{(i,k) \\mid c^{*} \\cdot \\hat{w}_{i,k} &lt; 1\\}, \\{\\})$\n    \\State Set $\\alpha \\gets \\frac{\\sum_{i \\in I_\\text{stoch}} \\hat{w}_i}{|I_\\text{det}|}$ and generate $U \\sim \\text{Uniform}([0, \\alpha])$\n    \\For{$i \\in I_\\text{stoch}$}\n        \\State Set $U \\gets U - \\hat{w}_i$\n        \\If{$U &lt; 0$}\n            \\State Set $I_\\text{strat} \\gets I_\\text{strat} \\cup \\{i\\}$\n            \\State Set $U \\gets U + \\alpha$\n        \\EndIf\n    \\EndFor\n    \\State Set particles $\\{(x_i, w_i)\\}_{i=1,\\ldots,|I_\\text{det}|} \\gets \\{(x_j, w_j \\cdot \\frac{N}{N'}) \\mid j \\in I_\\text{det}\\}$\n    \\State Set particles $\\{(x_i, w_i)\\}_{i=|I_\\text{det}|+1,\\ldots,N} \\gets \\{(x_j, \\frac{N}{c^* N'} \\sum_{l=1}^{N} \\sum_{k=1}^{K_l} w_{(j,k)}) \\mid j \\in I_\\text{strat}\\}$\n\\EndWhile\n\\State \\Return $\\left((x_i, w_i)_{i=1,\\ldots,N}, \\hat{Z} = \\frac{1}{N} \\sum_{i=1}^N w_i \\right)$\n\\end{algorithmic}\n\\end{algorithm}&quot;
                        </annotation>
                      </semantics>
                    </math>
                  </span>
                  <div class="ps-algorithm with-caption" dir="auto">
                    <p class="ps-line" style="text-indent:-0.6em;padding-left:0.6em;" dir="auto">
                      <span class="ps-keyword">
                        Algorithm 5
                      </span>
                      Sequential Monte Carlo Transformer Steering
                    </p>
                    <div class="ps-algorithmic" dir="auto">
                      <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                        <p class="ps-line ps-code" dir="auto">
                          <span style="font-weight:bold;">
                            Input:
                          </span>
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mi>
                                      N
                                    </mi>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    N
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.6833em;"></span>
                                <span class="mord mathnormal" style="margin-right:0.10903em;">
                                  N
                                </span>
                              </span>
                            </span>
                          </span>
                          (# particles),
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mi>
                                      K
                                    </mi>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    K
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.6833em;"></span>
                                <span class="mord mathnormal" style="margin-right:0.07153em;">
                                  K
                                </span>
                              </span>
                            </span>
                          </span>
                          (factor), Feynman-Kac Transformer model
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mo stretchy="false">
                                      {
                                    </mo>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mn>
                                        0
                                      </mn>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <mo stretchy="false">
                                      {
                                    </mo>
                                    <msub>
                                      <mi>
                                        M
                                      </mi>
                                      <mi>
                                        t
                                      </mi>
                                    </msub>
                                    <msub>
                                      <mo stretchy="false">
                                        }
                                      </mo>
                                      <mrow>
                                        <mi>
                                          t
                                        </mi>
                                        <mo>
                                          ≥
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                      </mrow>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <mo stretchy="false">
                                      {
                                    </mo>
                                    <msub>
                                      <mi>
                                        G
                                      </mi>
                                      <mi>
                                        t
                                      </mi>
                                    </msub>
                                    <msub>
                                      <mo stretchy="false">
                                        }
                                      </mo>
                                      <mrow>
                                        <mi>
                                          t
                                        </mi>
                                        <mo>
                                          ≥
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                      </mrow>
                                    </msub>
                                    <mo stretchy="false">
                                      }
                                    </mo>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    \{s_0, \{M_t\}_{t \geq 1}, \{G_t\}_{t \geq 1}\}
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                <span class="mopen">
                                  {
                                </span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    s
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3011em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mtight">
                                                0
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mopen">
                                  {
                                </span>
                                <span class="mord">
                                  <span class="mord mathnormal" style="margin-right:0.10903em;">
                                    M
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2806em;">
                                          <span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mclose">
                                  <span class="mclose">
                                    }
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3011em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mtight">
                                                <span class="mord mathnormal mtight">
                                                  t
                                                </span>
                                                <span class="mrel mtight">
                                                  ≥
                                                </span>
                                                <span class="mord mtight">
                                                  1
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2452em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mopen">
                                  {
                                </span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    G
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2806em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mclose">
                                  <span class="mclose">
                                    }
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3011em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mtight">
                                                <span class="mord mathnormal mtight">
                                                  t
                                                </span>
                                                <span class="mrel mtight">
                                                  ≥
                                                </span>
                                                <span class="mord mtight">
                                                  1
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2452em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mclose">
                                  }
                                </span>
                              </span>
                            </span>
                          </span>
                        </p>
                        <p class="ps-line ps-code" dir="auto">
                          <span style="font-weight:bold;">
                            Output:
                          </span>
                          Weighted particle approximation
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mo stretchy="false">
                                      {
                                    </mo>
                                    <mo stretchy="false">
                                      (
                                    </mo>
                                    <msub>
                                      <mi>
                                        x
                                      </mi>
                                      <mi>
                                        i
                                      </mi>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <msub>
                                      <mi>
                                        w
                                      </mi>
                                      <mi>
                                        i
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      )
                                    </mo>
                                    <msub>
                                      <mo stretchy="false">
                                        }
                                      </mo>
                                      <mrow>
                                        <mi>
                                          i
                                        </mi>
                                        <mo>
                                          =
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mo>
                                          …
                                        </mo>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mi>
                                          N
                                        </mi>
                                      </mrow>
                                    </msub>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    \{(x_i, w_i)\}_{i=1,\ldots,N}
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span>
                                <span class="mopen">
                                  {(
                                </span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    x
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3117em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                i
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal" style="margin-right:0.02691em;">
                                    w
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3117em;">
                                          <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                i
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mclose">
                                  )
                                </span>
                                <span class="mclose">
                                  <span class="mclose">
                                    }
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3283em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                                <span class="mrel mtight">
                                                  =
                                                </span>
                                                <span class="mord mtight">
                                                  1
                                                </span>
                                                <span class="mpunct mtight">
                                                  ,
                                                </span>
                                                <span class="minner mtight">
                                                  …
                                                </span>
                                                <span class="mpunct mtight">
                                                  ,
                                                </span>
                                                <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                  N
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2861em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                          of the posterior
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mi mathvariant="double-struck">
                                      P
                                    </mi>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    \mathbb{P}
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.6889em;"></span>
                                <span class="mord mathbb">
                                  P
                                </span>
                              </span>
                            </span>
                          </span>
                          <br/>
                        </p>
                        <p class="ps-line ps-code" dir="auto">
                          <span style="font-weight:bold;">
                            Output:
                          </span>
                          Unbiased estimate
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mover accent="true">
                                      <mi>
                                        Z
                                      </mi>
                                      <mo>
                                        ^
                                      </mo>
                                    </mover>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    \hat{Z}
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.9468em;"></span>
                                <span class="mord accent">
                                  <span class="vlist-t">
                                    <span class="vlist-r">
                                      <span class="vlist" style="height:0.9468em;">
                                        <span style="top:-3em;">
                                          <span class="pstrut" style="height:3em;"></span>
                                          <span class="mord mathnormal" style="margin-right:0.07153em;">
                                            Z
                                          </span>
                                        </span>
                                        <span style="top:-3.2523em;">
                                          <span class="pstrut" style="height:3em;"></span>
                                          <span class="accent-body" style="left:-0.1667em;">
                                            <span class="mord">
                                              ^
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                          of the partition function
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mi>
                                      Z
                                    </mi>
                                    <mo>
                                      =
                                    </mo>
                                    <msub>
                                      <mi mathvariant="double-struck">
                                        E
                                      </mi>
                                      <mi mathvariant="double-struck">
                                        M
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      [
                                    </mo>
                                    <msubsup>
                                      <mo>
                                        ∏
                                      </mo>
                                      <mrow>
                                        <mi>
                                          t
                                        </mi>
                                        <mo>
                                          =
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                      </mrow>
                                      <mi>
                                        T
                                      </mi>
                                    </msubsup>
                                    <msub>
                                      <mi>
                                        G
                                      </mi>
                                      <mi>
                                        t
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      (
                                    </mo>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mi>
                                        t
                                      </mi>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mrow>
                                        <mi>
                                          t
                                        </mi>
                                        <mo>
                                          −
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                      </mrow>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <msub>
                                      <mi>
                                        f
                                      </mi>
                                      <mi>
                                        θ
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      )
                                    </mo>
                                    <mo stretchy="false">
                                      ]
                                    </mo>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    Z = \mathbb{E}_\mathbb{M}[\prod_{t=1}^T G_t(s_t, s_{t-1}, f_\theta)]
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.6833em;"></span>
                                <span class="mord mathnormal" style="margin-right:0.07153em;">
                                  Z
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  =
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:1.2809em;vertical-align:-0.2997em;"></span>
                                <span class="mord">
                                  <span class="mord mathbb">
                                    E
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3322em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathbb mtight">
                                                M
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mopen">
                                  [
                                </span>
                                <span class="mop">
                                  <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                    ∏
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.9812em;">
                                          <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mtight">
                                                <span class="mord mathnormal mtight">
                                                  t
                                                </span>
                                                <span class="mrel mtight">
                                                  =
                                                </span>
                                                <span class="mord mtight">
                                                  1
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span style="top:-3.2029em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight" style="margin-right:0.13889em;">
                                                T
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2997em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    G
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2806em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mopen">
                                  (
                                </span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    s
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2806em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                t
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    s
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3011em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mtight">
                                                <span class="mord mathnormal mtight">
                                                  t
                                                </span>
                                                <span class="mbin mtight">
                                                  −
                                                </span>
                                                <span class="mord mtight">
                                                  1
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.2083em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal" style="margin-right:0.10764em;">
                                    f
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3361em;">
                                          <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                θ
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mclose">
                                  )]
                                </span>
                              </span>
                            </span>
                          </span>
                          <br/>
                        </p>
                        <p class="ps-line ps-code" dir="auto">
                          Initialize
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <msub>
                                      <mi>
                                        f
                                      </mi>
                                      <mi>
                                        θ
                                      </mi>
                                    </msub>
                                    <mo>
                                      ←
                                    </mo>
                                    <mtext mathvariant="monospace">
                                      CachedTransformer
                                    </mtext>
                                    <mo stretchy="false">
                                      (
                                    </mo>
                                    <mo stretchy="false">
                                      )
                                    </mo>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    f_\theta \gets \texttt{CachedTransformer}()
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal" style="margin-right:0.10764em;">
                                    f
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3361em;">
                                          <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                θ
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  ←
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                <span class="mord text">
                                  <span class="mord texttt">
                                    CachedTransformer
                                  </span>
                                </span>
                                <span class="mopen">
                                  (
                                </span>
                                <span class="mclose">
                                  )
                                </span>
                              </span>
                            </span>
                          </span>
                        </p>
                        <p class="ps-line ps-code" dir="auto">
                          Initialize
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mo stretchy="false">
                                      (
                                    </mo>
                                    <msub>
                                      <mi>
                                        x
                                      </mi>
                                      <mi>
                                        i
                                      </mi>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <msub>
                                      <mi>
                                        w
                                      </mi>
                                      <mi>
                                        i
                                      </mi>
                                    </msub>
                                    <mo stretchy="false">
                                      )
                                    </mo>
                                    <mo>
                                      ←
                                    </mo>
                                    <mo stretchy="false">
                                      (
                                    </mo>
                                    <msub>
                                      <mi>
                                        s
                                      </mi>
                                      <mn>
                                        0
                                      </mn>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <mn>
                                      1
                                    </mn>
                                    <mo stretchy="false">
                                      )
                                    </mo>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    (x_i, w_i) \gets (s_0, 1)
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                <span class="mopen">
                                  (
                                </span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    x
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3117em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                i
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal" style="margin-right:0.02691em;">
                                    w
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3117em;">
                                          <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                i
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mclose">
                                  )
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  ←
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                <span class="mopen">
                                  (
                                </span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    s
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3011em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mtight">
                                                0
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mord">
                                  1
                                </span>
                                <span class="mclose">
                                  )
                                </span>
                              </span>
                            </span>
                          </span>
                          for
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mi>
                                      i
                                    </mi>
                                    <mo>
                                      =
                                    </mo>
                                    <mn>
                                      1
                                    </mn>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <mo>
                                      …
                                    </mo>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <mi>
                                      N
                                    </mi>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    i = 1, \ldots, N
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.6595em;"></span>
                                <span class="mord mathnormal">
                                  i
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  =
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span>
                                <span class="mord">
                                  1
                                </span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="minner">
                                  …
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mord mathnormal" style="margin-right:0.10903em;">
                                  N
                                </span>
                              </span>
                            </span>
                          </span>
                        </p>
                        <p class="ps-line ps-code" dir="auto">
                          Initialize
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mi>
                                      t
                                    </mi>
                                    <mo>
                                      ←
                                    </mo>
                                    <mn>
                                      1
                                    </mn>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    t \gets 1
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.6151em;"></span>
                                <span class="mord mathnormal">
                                  t
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  ←
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:0.6444em;"></span>
                                <span class="mord">
                                  1
                                </span>
                              </span>
                            </span>
                          </span>
                        </p>
                        <p class="ps-line ps-code" dir="auto">
                          <span class="ps-keyword">
                            while
                          </span>
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <msub>
                                      <mi>
                                        x
                                      </mi>
                                      <mi>
                                        i
                                      </mi>
                                    </msub>
                                    <mo>
                                      ∉
                                    </mo>
                                    <mi mathvariant="script">
                                      F
                                    </mi>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    x_i \not\in \mathcal{F}
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span>
                                <span class="mord">
                                  <span class="mord mathnormal">
                                    x
                                  </span>
                                  <span class="msupsub">
                                    <span class="vlist-t vlist-t2">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.3117em;">
                                          <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                            <span class="pstrut" style="height:2.7em;"></span>
                                            <span class="sizing reset-size6 size3 mtight">
                                              <span class="mord mathnormal mtight">
                                                i
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="vlist-s">
                                          ​
                                        </span>
                                      </span>
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.15em;">
                                          <span></span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  <span class="mord vbox">
                                    <span class="thinbox">
                                      <span class="rlap">
                                        <span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span>
                                        <span class="inner">
                                          <span class="mord">
                                            <span class="mrel">
                                              
                                            </span>
                                          </span>
                                        </span>
                                        <span class="fix"></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span>
                                <span class="mrel">
                                  ∈
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:0.6833em;"></span>
                                <span class="mord mathcal" style="margin-right:0.09931em;">
                                  F
                                </span>
                              </span>
                            </span>
                          </span>
                          for some
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mi>
                                      i
                                    </mi>
                                    <mo>
                                      ∈
                                    </mo>
                                    <mo stretchy="false">
                                      {
                                    </mo>
                                    <mn>
                                      1
                                    </mn>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <mo>
                                      …
                                    </mo>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <mi>
                                      N
                                    </mi>
                                    <mo stretchy="false">
                                      }
                                    </mo>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    i \in \{1, \ldots, N\}
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:0.6986em;vertical-align:-0.0391em;"></span>
                                <span class="mord mathnormal">
                                  i
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                                <span class="mrel">
                                  ∈
                                </span>
                                <span class="mspace" style="margin-right:0.2778em;"></span>
                              </span>
                              <span class="base">
                                <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                <span class="mopen">
                                  {
                                </span>
                                <span class="mord">
                                  1
                                </span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="minner">
                                  …
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mpunct">
                                  ,
                                </span>
                                <span class="mspace" style="margin-right:0.1667em;"></span>
                                <span class="mord mathnormal" style="margin-right:0.10903em;">
                                  N
                                </span>
                                <span class="mclose">
                                  }
                                </span>
                              </span>
                            </span>
                          </span>
                          <span class="ps-keyword">
                            do
                          </span>
                        </p>
                        <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                          <p class="ps-line ps-code" dir="auto">
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <msub>
                                        <mi>
                                          K
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo>
                                        ←
                                      </mo>
                                      <mi>
                                        K
                                      </mi>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                      <mo>
                                        −
                                      </mo>
                                      <msub>
                                        <mn mathvariant="double-struck">
                                          1
                                        </mn>
                                        <mi mathvariant="script">
                                          F
                                        </mi>
                                      </msub>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <msub>
                                        <mi>
                                          x
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <mo>
                                        +
                                      </mo>
                                      <msub>
                                        <mn mathvariant="double-struck">
                                          1
                                        </mn>
                                        <mi mathvariant="script">
                                          F
                                        </mi>
                                      </msub>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <msub>
                                        <mi>
                                          x
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      K_i \gets K (1 - \mathbb{1}_{\mathcal{F}}(x_i)) + \mathbb{1}_{\mathcal{F}}(x_i)
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.07153em;">
                                      K
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ←
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.07153em;">
                                    K
                                  </span>
                                  <span class="mopen">
                                    (
                                  </span>
                                  <span class="mord">
                                    1
                                  </span>
                                  <span class="mspace" style="margin-right:0.2222em;"></span>
                                  <span class="mbin">
                                    −
                                  </span>
                                  <span class="mspace" style="margin-right:0.2222em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mord">
                                    <span class="mord">
                                      1
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3283em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathcal mtight" style="margin-right:0.09931em;">
                                                    F
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mopen">
                                    (
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      x
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    ))
                                  </span>
                                  <span class="mspace" style="margin-right:0.2222em;"></span>
                                  <span class="mbin">
                                    +
                                  </span>
                                  <span class="mspace" style="margin-right:0.2222em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mord">
                                    <span class="mord">
                                      1
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3283em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathcal mtight" style="margin-right:0.09931em;">
                                                    F
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mopen">
                                    (
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      x
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    )
                                  </span>
                                </span>
                              </span>
                            </span>
                            for
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi>
                                        i
                                      </mi>
                                      <mo>
                                        =
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mo>
                                        …
                                      </mo>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mi>
                                        N
                                      </mi>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      i = 1, \ldots, N
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6595em;"></span>
                                  <span class="mord mathnormal">
                                    i
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    =
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span>
                                  <span class="mord">
                                    1
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="minner">
                                    …
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.10903em;">
                                    N
                                  </span>
                                </span>
                              </span>
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <msup>
                                        <mi>
                                          N
                                        </mi>
                                        <mo mathvariant="normal" lspace="0em" rspace="0em">
                                          ′
                                        </mo>
                                      </msup>
                                      <mo>
                                        ←
                                      </mo>
                                      <msubsup>
                                        <mo>
                                          ∑
                                        </mo>
                                        <mrow>
                                          <mi>
                                            i
                                          </mi>
                                          <mo>
                                            =
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                        </mrow>
                                        <mi>
                                          N
                                        </mi>
                                      </msubsup>
                                      <msub>
                                        <mi>
                                          K
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      N' \gets \sum_{i=1}^N K_i
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.7519em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.10903em;">
                                      N
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.7519em;">
                                            <span style="top:-3.063em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mtight">
                                                    ′
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ←
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1.2809em;vertical-align:-0.2997em;"></span>
                                  <span class="mop">
                                    <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                      ∑
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.9812em;">
                                            <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                  <span class="mrel mtight">
                                                    =
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span style="top:-3.2029em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                  N
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2997em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.07153em;">
                                      K
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            <span class="ps-keyword">
                              for
                            </span>
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi>
                                        i
                                      </mi>
                                      <mo>
                                        ∈
                                      </mo>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mo>
                                        …
                                      </mo>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mi>
                                        N
                                      </mi>
                                      <mo stretchy="false">
                                        }
                                      </mo>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      i \in \{1, \ldots, N\}
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6986em;vertical-align:-0.0391em;"></span>
                                  <span class="mord mathnormal">
                                    i
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ∈
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mopen">
                                    {
                                  </span>
                                  <span class="mord">
                                    1
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="minner">
                                    …
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.10903em;">
                                    N
                                  </span>
                                  <span class="mclose">
                                    }
                                  </span>
                                </span>
                              </span>
                            </span>
                            <span class="ps-keyword">
                              do
                            </span>
                          </p>
                          <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                            <p class="ps-line ps-code" dir="auto">
                              <span class="ps-keyword">
                                if
                              </span>
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <msub>
                                          <mi>
                                            x
                                          </mi>
                                          <mi>
                                            i
                                          </mi>
                                        </msub>
                                        <mo>
                                          ∈
                                        </mo>
                                        <mi mathvariant="script">
                                          F
                                        </mi>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        x_i \in \mathcal{F}
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.6891em;vertical-align:-0.15em;"></span>
                                    <span class="mord">
                                      <span class="mord mathnormal">
                                        x
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ∈
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:0.6833em;"></span>
                                    <span class="mord mathcal" style="margin-right:0.09931em;">
                                      F
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="ps-keyword">
                                then
                              </span>
                            </p>
                            <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                              <p class="ps-line ps-code" dir="auto">
                                Set
                                <span class="katex">
                                  <span class="katex-mathml">
                                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                                      <semantics>
                                        <mrow>
                                          <mo stretchy="false">
                                            (
                                          </mo>
                                          <msub>
                                            <mi>
                                              x
                                            </mi>
                                            <mrow>
                                              <mi>
                                                i
                                              </mi>
                                              <mo separator="true">
                                                ,
                                              </mo>
                                              <mn>
                                                1
                                              </mn>
                                            </mrow>
                                          </msub>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <msub>
                                            <mi>
                                              w
                                            </mi>
                                            <mrow>
                                              <mi>
                                                i
                                              </mi>
                                              <mo separator="true">
                                                ,
                                              </mo>
                                              <mn>
                                                1
                                              </mn>
                                            </mrow>
                                          </msub>
                                          <mo stretchy="false">
                                            )
                                          </mo>
                                          <mo>
                                            ←
                                          </mo>
                                          <mo stretchy="false">
                                            (
                                          </mo>
                                          <msub>
                                            <mi>
                                              x
                                            </mi>
                                            <mi>
                                              i
                                            </mi>
                                          </msub>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <msub>
                                            <mi>
                                              w
                                            </mi>
                                            <mi>
                                              i
                                            </mi>
                                          </msub>
                                          <mo>
                                            ⋅
                                          </mo>
                                          <mfrac>
                                            <msup>
                                              <mi>
                                                N
                                              </mi>
                                              <mo mathvariant="normal" lspace="0em" rspace="0em">
                                                ′
                                              </mo>
                                            </msup>
                                            <mi>
                                              N
                                            </mi>
                                          </mfrac>
                                          <mo stretchy="false">
                                            )
                                          </mo>
                                        </mrow>
                                        <annotation encoding="application/x-tex">
                                          (x_{i,1}, w_{i,1}) \gets (x_i, w_i \cdot \frac{N'}{N})
                                        </annotation>
                                      </semantics>
                                    </math>
                                  </span>
                                  <span class="katex-html" aria-hidden="true">
                                    <span class="base">
                                      <span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span>
                                      <span class="mopen">
                                        (
                                      </span>
                                      <span class="mord">
                                        <span class="mord mathnormal">
                                          x
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3117em;">
                                                <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                      <span class="mpunct mtight">
                                                        ,
                                                      </span>
                                                      <span class="mord mtight">
                                                        1
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.2861em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mpunct">
                                        ,
                                      </span>
                                      <span class="mspace" style="margin-right:0.1667em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal" style="margin-right:0.02691em;">
                                          w
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3117em;">
                                                <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                      <span class="mpunct mtight">
                                                        ,
                                                      </span>
                                                      <span class="mord mtight">
                                                        1
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.2861em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mclose">
                                        )
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                      <span class="mrel">
                                        ←
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                      <span class="mopen">
                                        (
                                      </span>
                                      <span class="mord">
                                        <span class="mord mathnormal">
                                          x
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3117em;">
                                                <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mpunct">
                                        ,
                                      </span>
                                      <span class="mspace" style="margin-right:0.1667em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal" style="margin-right:0.02691em;">
                                          w
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3117em;">
                                                <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mspace" style="margin-right:0.2222em;"></span>
                                      <span class="mbin">
                                        ⋅
                                      </span>
                                      <span class="mspace" style="margin-right:0.2222em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:1.3185em;vertical-align:-0.345em;"></span>
                                      <span class="mord">
                                        <span class="mopen nulldelimiter"></span>
                                        <span class="mfrac">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.9735em;">
                                                <span style="top:-2.655em;">
                                                  <span class="pstrut" style="height:3em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                        N
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span style="top:-3.23em;">
                                                  <span class="pstrut" style="height:3em;"></span>
                                                  <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                                </span>
                                                <span style="top:-3.394em;">
                                                  <span class="pstrut" style="height:3em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                          N
                                                        </span>
                                                        <span class="msupsub">
                                                          <span class="vlist-t">
                                                            <span class="vlist-r">
                                                              <span class="vlist" style="height:0.8278em;">
                                                                <span style="top:-2.931em;margin-right:0.0714em;">
                                                                  <span class="pstrut" style="height:2.5em;"></span>
                                                                  <span class="sizing reset-size3 size1 mtight">
                                                                    <span class="mord mtight">
                                                                      <span class="mord mtight">
                                                                        ′
                                                                      </span>
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.345em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mclose nulldelimiter"></span>
                                      </span>
                                      <span class="mclose">
                                        )
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </p>
                            </div>
                            <p class="ps-line ps-code" dir="auto">
                              <span class="ps-keyword">
                                else
                              </span>
                            </p>
                            <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                              <p class="ps-line ps-code" dir="auto">
                                Generate
                                <span class="katex">
                                  <span class="katex-mathml">
                                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                                      <semantics>
                                        <mrow>
                                          <msub>
                                            <mi>
                                              x
                                            </mi>
                                            <mrow>
                                              <mi>
                                                i
                                              </mi>
                                              <mo separator="true">
                                                ,
                                              </mo>
                                              <mi>
                                                k
                                              </mi>
                                            </mrow>
                                          </msub>
                                          <mo>
                                            ∼
                                          </mo>
                                          <msub>
                                            <mi>
                                              M
                                            </mi>
                                            <mi>
                                              t
                                            </mi>
                                          </msub>
                                          <mo stretchy="false">
                                            (
                                          </mo>
                                          <mo>
                                            ⋅
                                          </mo>
                                          <mo>
                                            ∣
                                          </mo>
                                          <msub>
                                            <mi>
                                              x
                                            </mi>
                                            <mi>
                                              i
                                            </mi>
                                          </msub>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <msub>
                                            <mi>
                                              f
                                            </mi>
                                            <mi>
                                              θ
                                            </mi>
                                          </msub>
                                          <mo stretchy="false">
                                            )
                                          </mo>
                                        </mrow>
                                        <annotation encoding="application/x-tex">
                                          x_{i,k} \sim M_t(\cdot \mid x_i, f_\theta)
                                        </annotation>
                                      </semantics>
                                    </math>
                                  </span>
                                  <span class="katex-html" aria-hidden="true">
                                    <span class="base">
                                      <span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal">
                                          x
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3361em;">
                                                <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                      <span class="mpunct mtight">
                                                        ,
                                                      </span>
                                                      <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                        k
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.2861em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                      <span class="mrel">
                                        ∼
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal" style="margin-right:0.10903em;">
                                          M
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.2806em;">
                                                <span style="top:-2.55em;margin-left:-0.109em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mathnormal mtight">
                                                      t
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mopen">
                                        (
                                      </span>
                                      <span class="mord">
                                        ⋅
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                      <span class="mrel">
                                        ∣
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal">
                                          x
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3117em;">
                                                <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mpunct">
                                        ,
                                      </span>
                                      <span class="mspace" style="margin-right:0.1667em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal" style="margin-right:0.10764em;">
                                          f
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3361em;">
                                                <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                      θ
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mclose">
                                        )
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                for
                                <span class="katex">
                                  <span class="katex-mathml">
                                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                                      <semantics>
                                        <mrow>
                                          <mi>
                                            k
                                          </mi>
                                          <mo>
                                            =
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mo>
                                            …
                                          </mo>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mi>
                                            K
                                          </mi>
                                        </mrow>
                                        <annotation encoding="application/x-tex">
                                          k = 1, \ldots, K
                                        </annotation>
                                      </semantics>
                                    </math>
                                  </span>
                                  <span class="katex-html" aria-hidden="true">
                                    <span class="base">
                                      <span class="strut" style="height:0.6944em;"></span>
                                      <span class="mord mathnormal" style="margin-right:0.03148em;">
                                        k
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                      <span class="mrel">
                                        =
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span>
                                      <span class="mord">
                                        1
                                      </span>
                                      <span class="mpunct">
                                        ,
                                      </span>
                                      <span class="mspace" style="margin-right:0.1667em;"></span>
                                      <span class="minner">
                                        …
                                      </span>
                                      <span class="mspace" style="margin-right:0.1667em;"></span>
                                      <span class="mpunct">
                                        ,
                                      </span>
                                      <span class="mspace" style="margin-right:0.1667em;"></span>
                                      <span class="mord mathnormal" style="margin-right:0.07153em;">
                                        K
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </p>
                              <p class="ps-line ps-code" dir="auto">
                                Set
                                <span class="katex">
                                  <span class="katex-mathml">
                                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                                      <semantics>
                                        <mrow>
                                          <msub>
                                            <mi>
                                              w
                                            </mi>
                                            <mrow>
                                              <mi>
                                                i
                                              </mi>
                                              <mo separator="true">
                                                ,
                                              </mo>
                                              <mi>
                                                k
                                              </mi>
                                            </mrow>
                                          </msub>
                                          <mo>
                                            ←
                                          </mo>
                                          <msub>
                                            <mi>
                                              w
                                            </mi>
                                            <mi>
                                              i
                                            </mi>
                                          </msub>
                                          <mo>
                                            ⋅
                                          </mo>
                                          <msub>
                                            <mi>
                                              G
                                            </mi>
                                            <mi>
                                              t
                                            </mi>
                                          </msub>
                                          <mo stretchy="false">
                                            (
                                          </mo>
                                          <msub>
                                            <mi>
                                              x
                                            </mi>
                                            <mi>
                                              i
                                            </mi>
                                          </msub>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <msub>
                                            <mi>
                                              x
                                            </mi>
                                            <mrow>
                                              <mi>
                                                i
                                              </mi>
                                              <mo separator="true">
                                                ,
                                              </mo>
                                              <mi>
                                                k
                                              </mi>
                                            </mrow>
                                          </msub>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <msub>
                                            <mi>
                                              f
                                            </mi>
                                            <mi>
                                              θ
                                            </mi>
                                          </msub>
                                          <mo stretchy="false">
                                            )
                                          </mo>
                                          <mo>
                                            ⋅
                                          </mo>
                                          <mfrac>
                                            <msup>
                                              <mi>
                                                N
                                              </mi>
                                              <mo mathvariant="normal" lspace="0em" rspace="0em">
                                                ′
                                              </mo>
                                            </msup>
                                            <mrow>
                                              <mi>
                                                K
                                              </mi>
                                              <mi>
                                                N
                                              </mi>
                                            </mrow>
                                          </mfrac>
                                        </mrow>
                                        <annotation encoding="application/x-tex">
                                          w_{i,k} \gets w_i \cdot G_t(x_i, x_{i,k}, f_\theta) \cdot \frac{N'}{K N}
                                        </annotation>
                                      </semantics>
                                    </math>
                                  </span>
                                  <span class="katex-html" aria-hidden="true">
                                    <span class="base">
                                      <span class="strut" style="height:0.7167em;vertical-align:-0.2861em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal" style="margin-right:0.02691em;">
                                          w
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3361em;">
                                                <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                      <span class="mpunct mtight">
                                                        ,
                                                      </span>
                                                      <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                        k
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.2861em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                      <span class="mrel">
                                        ←
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:0.5945em;vertical-align:-0.15em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal" style="margin-right:0.02691em;">
                                          w
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3117em;">
                                                <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mspace" style="margin-right:0.2222em;"></span>
                                      <span class="mbin">
                                        ⋅
                                      </span>
                                      <span class="mspace" style="margin-right:0.2222em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal">
                                          G
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.2806em;">
                                                <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mathnormal mtight">
                                                      t
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mopen">
                                        (
                                      </span>
                                      <span class="mord">
                                        <span class="mord mathnormal">
                                          x
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3117em;">
                                                <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mathnormal mtight">
                                                      i
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mpunct">
                                        ,
                                      </span>
                                      <span class="mspace" style="margin-right:0.1667em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal">
                                          x
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3361em;">
                                                <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight">
                                                        i
                                                      </span>
                                                      <span class="mpunct mtight">
                                                        ,
                                                      </span>
                                                      <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                        k
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.2861em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mpunct">
                                        ,
                                      </span>
                                      <span class="mspace" style="margin-right:0.1667em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal" style="margin-right:0.10764em;">
                                          f
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.3361em;">
                                                <span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.02778em;">
                                                      θ
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mclose">
                                        )
                                      </span>
                                      <span class="mspace" style="margin-right:0.2222em;"></span>
                                      <span class="mbin">
                                        ⋅
                                      </span>
                                      <span class="mspace" style="margin-right:0.2222em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:1.3185em;vertical-align:-0.345em;"></span>
                                      <span class="mord">
                                        <span class="mopen nulldelimiter"></span>
                                        <span class="mfrac">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.9735em;">
                                                <span style="top:-2.655em;">
                                                  <span class="pstrut" style="height:3em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mathnormal mtight" style="margin-right:0.07153em;">
                                                        K
                                                      </span>
                                                      <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                        N
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                                <span style="top:-3.23em;">
                                                  <span class="pstrut" style="height:3em;"></span>
                                                  <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                                </span>
                                                <span style="top:-3.394em;">
                                                  <span class="pstrut" style="height:3em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord mtight">
                                                      <span class="mord mtight">
                                                        <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                          N
                                                        </span>
                                                        <span class="msupsub">
                                                          <span class="vlist-t">
                                                            <span class="vlist-r">
                                                              <span class="vlist" style="height:0.8278em;">
                                                                <span style="top:-2.931em;margin-right:0.0714em;">
                                                                  <span class="pstrut" style="height:2.5em;"></span>
                                                                  <span class="sizing reset-size3 size1 mtight">
                                                                    <span class="mord mtight">
                                                                      <span class="mord mtight">
                                                                        ′
                                                                      </span>
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.345em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                        <span class="mclose nulldelimiter"></span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                                for
                                <span class="katex">
                                  <span class="katex-mathml">
                                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                                      <semantics>
                                        <mrow>
                                          <mi>
                                            k
                                          </mi>
                                          <mo>
                                            =
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mo>
                                            …
                                          </mo>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mi>
                                            K
                                          </mi>
                                        </mrow>
                                        <annotation encoding="application/x-tex">
                                          k = 1, \ldots, K
                                        </annotation>
                                      </semantics>
                                    </math>
                                  </span>
                                  <span class="katex-html" aria-hidden="true">
                                    <span class="base">
                                      <span class="strut" style="height:0.6944em;"></span>
                                      <span class="mord mathnormal" style="margin-right:0.03148em;">
                                        k
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                      <span class="mrel">
                                        =
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span>
                                      <span class="mord">
                                        1
                                      </span>
                                      <span class="mpunct">
                                        ,
                                      </span>
                                      <span class="mspace" style="margin-right:0.1667em;"></span>
                                      <span class="minner">
                                        …
                                      </span>
                                      <span class="mspace" style="margin-right:0.1667em;"></span>
                                      <span class="mpunct">
                                        ,
                                      </span>
                                      <span class="mspace" style="margin-right:0.1667em;"></span>
                                      <span class="mord mathnormal" style="margin-right:0.07153em;">
                                        K
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </p>
                            </div>
                            <p class="ps-line ps-code" dir="auto">
                              <span class="ps-keyword">
                                end if
                              </span>
                            </p>
                          </div>
                          <p class="ps-line ps-code" dir="auto">
                            <span class="ps-keyword">
                              end for
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            Set normalized weights
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <msub>
                                        <mover accent="true">
                                          <mi>
                                            w
                                          </mi>
                                          <mo>
                                            ^
                                          </mo>
                                        </mover>
                                        <mrow>
                                          <mi>
                                            i
                                          </mi>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mi>
                                            k
                                          </mi>
                                        </mrow>
                                      </msub>
                                      <mo>
                                        ←
                                      </mo>
                                      <mfrac>
                                        <msub>
                                          <mi>
                                            w
                                          </mi>
                                          <mrow>
                                            <mo stretchy="false">
                                              (
                                            </mo>
                                            <mi>
                                              i
                                            </mi>
                                            <mo separator="true">
                                              ,
                                            </mo>
                                            <mi>
                                              k
                                            </mi>
                                            <mo stretchy="false">
                                              )
                                            </mo>
                                          </mrow>
                                        </msub>
                                        <mrow>
                                          <msubsup>
                                            <mo>
                                              ∑
                                            </mo>
                                            <mrow>
                                              <mi>
                                                j
                                              </mi>
                                              <mo>
                                                =
                                              </mo>
                                              <mn>
                                                1
                                              </mn>
                                            </mrow>
                                            <mi>
                                              N
                                            </mi>
                                          </msubsup>
                                          <msubsup>
                                            <mo>
                                              ∑
                                            </mo>
                                            <mrow>
                                              <mi>
                                                l
                                              </mi>
                                              <mo>
                                                =
                                              </mo>
                                              <mn>
                                                1
                                              </mn>
                                            </mrow>
                                            <msub>
                                              <mi>
                                                K
                                              </mi>
                                              <mi>
                                                j
                                              </mi>
                                            </msub>
                                          </msubsup>
                                          <msub>
                                            <mi>
                                              w
                                            </mi>
                                            <mrow>
                                              <mo stretchy="false">
                                                (
                                              </mo>
                                              <mi>
                                                j
                                              </mi>
                                              <mo separator="true">
                                                ,
                                              </mo>
                                              <mi>
                                                l
                                              </mi>
                                              <mo stretchy="false">
                                                )
                                              </mo>
                                            </mrow>
                                          </msub>
                                        </mrow>
                                      </mfrac>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      \hat{w}_{i,k} \gets \frac{w_{(i,k)}}{\sum_{j=1}^N \sum_{l=1}^{K_j} w_{(j,l)}}
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span>
                                  <span class="mord">
                                    <span class="mord accent">
                                      <span class="vlist-t">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.6944em;">
                                            <span style="top:-3em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="mord mathnormal" style="margin-right:0.02691em;">
                                                w
                                              </span>
                                            </span>
                                            <span style="top:-3em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="accent-body" style="left:-0.1667em;">
                                                <span class="mord">
                                                  ^
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3361em;">
                                            <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                  <span class="mpunct mtight">
                                                    ,
                                                  </span>
                                                  <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                    k
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2861em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ←
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1.8399em;vertical-align:-0.9698em;"></span>
                                  <span class="mord">
                                    <span class="mopen nulldelimiter"></span>
                                    <span class="mfrac">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.87em;">
                                            <span style="top:-2.3524em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mop mtight">
                                                    <span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">
                                                      ∑
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t vlist-t2">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.8852em;">
                                                            <span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord mtight">
                                                                  <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                                    j
                                                                  </span>
                                                                  <span class="mrel mtight">
                                                                    =
                                                                  </span>
                                                                  <span class="mord mtight">
                                                                    1
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                            <span style="top:-2.8971em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                                  N
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                          <span class="vlist-s">
                                                            ​
                                                          </span>
                                                        </span>
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.4603em;">
                                                            <span></span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="mspace mtight" style="margin-right:0.1952em;"></span>
                                                  <span class="mop mtight">
                                                    <span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">
                                                      ∑
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t vlist-t2">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:1.1966em;">
                                                            <span style="top:-2.1528em;margin-left:0em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord mtight">
                                                                  <span class="mord mathnormal mtight" style="margin-right:0.01968em;">
                                                                    l
                                                                  </span>
                                                                  <span class="mrel mtight">
                                                                    =
                                                                  </span>
                                                                  <span class="mord mtight">
                                                                    1
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                            <span style="top:-3.2085em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord mtight">
                                                                  <span class="mord mtight">
                                                                    <span class="mord mathnormal mtight" style="margin-right:0.07153em;">
                                                                      K
                                                                    </span>
                                                                    <span class="msupsub">
                                                                      <span class="vlist-t vlist-t2">
                                                                        <span class="vlist-r">
                                                                          <span class="vlist" style="height:0.3448em;">
                                                                            <span style="top:-2.3448em;margin-left:-0.0715em;margin-right:0.1em;">
                                                                              <span class="pstrut" style="height:2.6595em;"></span>
                                                                              <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                                                j
                                                                              </span>
                                                                            </span>
                                                                          </span>
                                                                          <span class="vlist-s">
                                                                            ​
                                                                          </span>
                                                                        </span>
                                                                        <span class="vlist-r">
                                                                          <span class="vlist" style="height:0.5092em;">
                                                                            <span></span>
                                                                          </span>
                                                                        </span>
                                                                      </span>
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                          <span class="vlist-s">
                                                            ​
                                                          </span>
                                                        </span>
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.3472em;">
                                                            <span></span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="mspace mtight" style="margin-right:0.1952em;"></span>
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.02691em;">
                                                      w
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t vlist-t2">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.3448em;">
                                                            <span style="top:-2.3448em;margin-left:-0.0269em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5357em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord mtight">
                                                                  <span class="mopen mtight">
                                                                    (
                                                                  </span>
                                                                  <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                                    j
                                                                  </span>
                                                                  <span class="mpunct mtight">
                                                                    ,
                                                                  </span>
                                                                  <span class="mord mathnormal mtight" style="margin-right:0.01968em;">
                                                                    l
                                                                  </span>
                                                                  <span class="mclose mtight">
                                                                    )
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                          <span class="vlist-s">
                                                            ​
                                                          </span>
                                                        </span>
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.3695em;">
                                                            <span></span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span style="top:-3.23em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                            </span>
                                            <span style="top:-3.5686em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.02691em;">
                                                      w
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t vlist-t2">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.3448em;">
                                                            <span style="top:-2.3448em;margin-left:-0.0269em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5357em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord mtight">
                                                                  <span class="mopen mtight">
                                                                    (
                                                                  </span>
                                                                  <span class="mord mathnormal mtight">
                                                                    i
                                                                  </span>
                                                                  <span class="mpunct mtight">
                                                                    ,
                                                                  </span>
                                                                  <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                                    k
                                                                  </span>
                                                                  <span class="mclose mtight">
                                                                    )
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                          <span class="vlist-s">
                                                            ​
                                                          </span>
                                                        </span>
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.3695em;">
                                                            <span></span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.9698em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose nulldelimiter"></span>
                                  </span>
                                </span>
                              </span>
                            </span>
                            for
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi>
                                        i
                                      </mi>
                                      <mo>
                                        =
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mo>
                                        …
                                      </mo>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mi>
                                        N
                                      </mi>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      i = 1, \ldots, N
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6595em;"></span>
                                  <span class="mord mathnormal">
                                    i
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    =
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span>
                                  <span class="mord">
                                    1
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="minner">
                                    …
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.10903em;">
                                    N
                                  </span>
                                </span>
                              </span>
                            </span>
                            and
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi>
                                        k
                                      </mi>
                                      <mo>
                                        =
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mo>
                                        …
                                      </mo>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <msub>
                                        <mi>
                                          K
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      k = 1, \ldots, K_i
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6944em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.03148em;">
                                    k
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    =
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span>
                                  <span class="mord">
                                    1
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="minner">
                                    …
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.07153em;">
                                      K
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:-0.0715em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            Set
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <msup>
                                        <mi>
                                          c
                                        </mi>
                                        <mo>
                                          ∗
                                        </mo>
                                      </msup>
                                      <mo>
                                        ←
                                      </mo>
                                      <mi>
                                        inf
                                      </mi>
                                      <mo>
                                        ⁡
                                      </mo>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <mi>
                                        c
                                      </mi>
                                      <mo>
                                        ∈
                                      </mo>
                                      <msub>
                                        <mi mathvariant="double-struck">
                                          R
                                        </mi>
                                        <mrow>
                                          <mo>
                                            >
                                          </mo>
                                          <mn>
                                            0
                                          </mn>
                                        </mrow>
                                      </msub>
                                      <mo>
                                        ∣
                                      </mo>
                                      <msubsup>
                                        <mo>
                                          ∑
                                        </mo>
                                        <mrow>
                                          <mi>
                                            i
                                          </mi>
                                          <mo>
                                            =
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                        </mrow>
                                        <mi>
                                          N
                                        </mi>
                                      </msubsup>
                                      <msubsup>
                                        <mo>
                                          ∑
                                        </mo>
                                        <mrow>
                                          <mi>
                                            k
                                          </mi>
                                          <mo>
                                            =
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                        </mrow>
                                        <msub>
                                          <mi>
                                            K
                                          </mi>
                                          <mi>
                                            i
                                          </mi>
                                        </msub>
                                      </msubsup>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <mn mathvariant="double-struck">
                                        1
                                      </mn>
                                      <mo>
                                        ∧
                                      </mo>
                                      <mi>
                                        c
                                      </mi>
                                      <msub>
                                        <mover accent="true">
                                          <mi>
                                            w
                                          </mi>
                                          <mo>
                                            ^
                                          </mo>
                                        </mover>
                                        <mrow>
                                          <mo stretchy="false">
                                            (
                                          </mo>
                                          <mi>
                                            i
                                          </mi>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mi>
                                            k
                                          </mi>
                                          <mo stretchy="false">
                                            )
                                          </mo>
                                        </mrow>
                                      </msub>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <mo>
                                        >
                                      </mo>
                                      <mi>
                                        N
                                      </mi>
                                      <mo stretchy="false">
                                        }
                                      </mo>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      c^* \gets \inf\{c \in \mathbb{R}_{> 0} \mid \sum_{i=1}^N \sum_{k=1}^{K_i} (\mathbb{1} \wedge c \hat{w}_{(i,k)}) > N\}
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6887em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      c
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.6887em;">
                                            <span style="top:-3.063em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mbin mtight">
                                                  ∗
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ←
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mop">
                                    in
                                    <span style="margin-right:0.07778em;">
                                      f
                                    </span>
                                  </span>
                                  <span class="mopen">
                                    {
                                  </span>
                                  <span class="mord mathnormal">
                                    c
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ∈
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mord">
                                    <span class="mord mathbb">
                                      R
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3011em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mrel mtight">
                                                    >
                                                  </span>
                                                  <span class="mord mtight">
                                                    0
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.1774em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ∣
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1.2809em;vertical-align:-0.2997em;"></span>
                                  <span class="mop">
                                    <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                      ∑
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.9812em;">
                                            <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                  <span class="mrel mtight">
                                                    =
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span style="top:-3.2029em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                  N
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2997em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mop">
                                    <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                      ∑
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.9812em;">
                                            <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                    k
                                                  </span>
                                                  <span class="mrel mtight">
                                                    =
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span style="top:-3.2029em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.07153em;">
                                                      K
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t vlist-t2">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.3281em;">
                                                            <span style="top:-2.357em;margin-left:-0.0715em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord mathnormal mtight">
                                                                  i
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                          <span class="vlist-s">
                                                            ​
                                                          </span>
                                                        </span>
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.143em;">
                                                            <span></span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2997em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mopen">
                                    (
                                  </span>
                                  <span class="mord">
                                    1
                                  </span>
                                  <span class="mspace" style="margin-right:0.2222em;"></span>
                                  <span class="mbin">
                                    ∧
                                  </span>
                                  <span class="mspace" style="margin-right:0.2222em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span>
                                  <span class="mord mathnormal">
                                    c
                                  </span>
                                  <span class="mord">
                                    <span class="mord accent">
                                      <span class="vlist-t">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.6944em;">
                                            <span style="top:-3em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="mord mathnormal" style="margin-right:0.02691em;">
                                                w
                                              </span>
                                            </span>
                                            <span style="top:-3em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="accent-body" style="left:-0.1667em;">
                                                <span class="mord">
                                                  ^
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3448em;">
                                            <span style="top:-2.5198em;margin-left:-0.0269em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mopen mtight">
                                                    (
                                                  </span>
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                  <span class="mpunct mtight">
                                                    ,
                                                  </span>
                                                  <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                    k
                                                  </span>
                                                  <span class="mclose mtight">
                                                    )
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3552em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    )
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    >
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.10903em;">
                                    N
                                  </span>
                                  <span class="mclose">
                                    }
                                  </span>
                                </span>
                              </span>
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            Set
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <msub>
                                        <mi>
                                          I
                                        </mi>
                                        <mtext>
                                          det
                                        </mtext>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <msub>
                                        <mi>
                                          I
                                        </mi>
                                        <mtext>
                                          stoch
                                        </mtext>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <msub>
                                        <mi>
                                          I
                                        </mi>
                                        <mtext>
                                          strat
                                        </mtext>
                                      </msub>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <mo>
                                        ←
                                      </mo>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <mi>
                                        i
                                      </mi>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mi>
                                        k
                                      </mi>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <mo>
                                        ∣
                                      </mo>
                                      <msup>
                                        <mi>
                                          c
                                        </mi>
                                        <mo lspace="0em" rspace="0em">
                                          ∗
                                        </mo>
                                      </msup>
                                      <msub>
                                        <mover accent="true">
                                          <mi>
                                            w
                                          </mi>
                                          <mo>
                                            ^
                                          </mo>
                                        </mover>
                                        <mrow>
                                          <mi>
                                            i
                                          </mi>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mi>
                                            k
                                          </mi>
                                        </mrow>
                                      </msub>
                                      <mo>
                                        ≥
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                      <mo stretchy="false">
                                        }
                                      </mo>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <mi>
                                        i
                                      </mi>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mi>
                                        k
                                      </mi>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <mo>
                                        ∣
                                      </mo>
                                      <msup>
                                        <mi>
                                          c
                                        </mi>
                                        <mo lspace="0em" rspace="0em">
                                          ∗
                                        </mo>
                                      </msup>
                                      <mo>
                                        ⋅
                                      </mo>
                                      <msub>
                                        <mover accent="true">
                                          <mi>
                                            w
                                          </mi>
                                          <mo>
                                            ^
                                          </mo>
                                        </mover>
                                        <mrow>
                                          <mi>
                                            i
                                          </mi>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mi>
                                            k
                                          </mi>
                                        </mrow>
                                      </msub>
                                      <mo>
                                        &lt;
                                      </mo>
                                      <mn>
                                        1
                                      </mn>
                                      <mo stretchy="false">
                                        }
                                      </mo>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <mo stretchy="false">
                                        }
                                      </mo>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      (I_\text{det}, I_\text{stoch}, I_\text{strat}) \gets (\{(i,k) \mid c^{*} \hat{w}_{i,k} \geq 1\}, \{(i,k) \mid c^{*} \cdot \hat{w}_{i,k} &lt; 1\}, \{\})
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mopen">
                                    (
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.07847em;">
                                      I
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3361em;">
                                            <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord text mtight">
                                                  <span class="mord mtight">
                                                    det
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.07847em;">
                                      I
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3361em;">
                                            <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord text mtight">
                                                  <span class="mord mtight">
                                                    stoch
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.07847em;">
                                      I
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2806em;">
                                            <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord text mtight">
                                                  <span class="mord mtight">
                                                    strat
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    )
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ←
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mopen">
                                    ({(
                                  </span>
                                  <span class="mord mathnormal">
                                    i
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.03148em;">
                                    k
                                  </span>
                                  <span class="mclose">
                                    )
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ∣
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      c
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.6887em;">
                                            <span style="top:-3.063em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mtight">
                                                    ∗
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mord">
                                    <span class="mord accent">
                                      <span class="vlist-t">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.6944em;">
                                            <span style="top:-3em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="mord mathnormal" style="margin-right:0.02691em;">
                                                w
                                              </span>
                                            </span>
                                            <span style="top:-3em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="accent-body" style="left:-0.1667em;">
                                                <span class="mord">
                                                  ^
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3361em;">
                                            <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                  <span class="mpunct mtight">
                                                    ,
                                                  </span>
                                                  <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                    k
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2861em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ≥
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mord">
                                    1
                                  </span>
                                  <span class="mclose">
                                    }
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mopen">
                                    {(
                                  </span>
                                  <span class="mord mathnormal">
                                    i
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.03148em;">
                                    k
                                  </span>
                                  <span class="mclose">
                                    )
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ∣
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:0.6887em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      c
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.6887em;">
                                            <span style="top:-3.063em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mtight">
                                                    ∗
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2222em;"></span>
                                  <span class="mbin">
                                    ⋅
                                  </span>
                                  <span class="mspace" style="margin-right:0.2222em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:0.9805em;vertical-align:-0.2861em;"></span>
                                  <span class="mord">
                                    <span class="mord accent">
                                      <span class="vlist-t">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.6944em;">
                                            <span style="top:-3em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="mord mathnormal" style="margin-right:0.02691em;">
                                                w
                                              </span>
                                            </span>
                                            <span style="top:-3em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="accent-body" style="left:-0.1667em;">
                                                <span class="mord">
                                                  ^
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3361em;">
                                            <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                  <span class="mpunct mtight">
                                                    ,
                                                  </span>
                                                  <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                    k
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2861em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    &lt;
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mord">
                                    1
                                  </span>
                                  <span class="mclose">
                                    }
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mopen">
                                    {
                                  </span>
                                  <span class="mclose">
                                    })
                                  </span>
                                </span>
                              </span>
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            Set
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi>
                                        α
                                      </mi>
                                      <mo>
                                        ←
                                      </mo>
                                      <mfrac>
                                        <mrow>
                                          <msub>
                                            <mo>
                                              ∑
                                            </mo>
                                            <mrow>
                                              <mi>
                                                i
                                              </mi>
                                              <mo>
                                                ∈
                                              </mo>
                                              <msub>
                                                <mi>
                                                  I
                                                </mi>
                                                <mtext>
                                                  stoch
                                                </mtext>
                                              </msub>
                                            </mrow>
                                          </msub>
                                          <msub>
                                            <mover accent="true">
                                              <mi>
                                                w
                                              </mi>
                                              <mo>
                                                ^
                                              </mo>
                                            </mover>
                                            <mi>
                                              i
                                            </mi>
                                          </msub>
                                        </mrow>
                                        <mrow>
                                          <mi mathvariant="normal">
                                            ∣
                                          </mi>
                                          <msub>
                                            <mi>
                                              I
                                            </mi>
                                            <mtext>
                                              det
                                            </mtext>
                                          </msub>
                                          <mi mathvariant="normal">
                                            ∣
                                          </mi>
                                        </mrow>
                                      </mfrac>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      \alpha \gets \frac{\sum_{i \in I_\text{stoch}} \hat{w}_i}{|I_\text{det}|}
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.4306em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.0037em;">
                                    α
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ←
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1.7548em;vertical-align:-0.52em;"></span>
                                  <span class="mord">
                                    <span class="mopen nulldelimiter"></span>
                                    <span class="mfrac">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:1.2348em;">
                                            <span style="top:-2.655em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mtight">
                                                    ∣
                                                  </span>
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.07847em;">
                                                      I
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t vlist-t2">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.3448em;">
                                                            <span style="top:-2.3488em;margin-left:-0.0785em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord text mtight">
                                                                  <span class="mord mtight">
                                                                    det
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                          <span class="vlist-s">
                                                            ​
                                                          </span>
                                                        </span>
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.1512em;">
                                                            <span></span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="mord mtight">
                                                    ∣
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span style="top:-3.23em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                            </span>
                                            <span style="top:-3.7098em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mop mtight">
                                                    <span class="mop op-symbol small-op mtight" style="position:relative;top:0em;">
                                                      ∑
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t vlist-t2">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.1667em;">
                                                            <span style="top:-2.1786em;margin-left:0em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord mtight">
                                                                  <span class="mord mathnormal mtight">
                                                                    i
                                                                  </span>
                                                                  <span class="mrel mtight">
                                                                    ∈
                                                                  </span>
                                                                  <span class="mord mtight">
                                                                    <span class="mord mathnormal mtight" style="margin-right:0.07847em;">
                                                                      I
                                                                    </span>
                                                                    <span class="msupsub">
                                                                      <span class="vlist-t vlist-t2">
                                                                        <span class="vlist-r">
                                                                          <span class="vlist" style="height:0.3448em;">
                                                                            <span style="top:-2.3448em;margin-left:-0.0785em;margin-right:0.1em;">
                                                                              <span class="pstrut" style="height:2.6944em;"></span>
                                                                              <span class="mord text mtight">
                                                                                <span class="mord mtight">
                                                                                  stoch
                                                                                </span>
                                                                              </span>
                                                                            </span>
                                                                          </span>
                                                                          <span class="vlist-s">
                                                                            ​
                                                                          </span>
                                                                        </span>
                                                                        <span class="vlist-r">
                                                                          <span class="vlist" style="height:0.3496em;">
                                                                            <span></span>
                                                                          </span>
                                                                        </span>
                                                                      </span>
                                                                    </span>
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                          <span class="vlist-s">
                                                            ​
                                                          </span>
                                                        </span>
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.5712em;">
                                                            <span></span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="mspace mtight" style="margin-right:0.1952em;"></span>
                                                  <span class="mord mtight">
                                                    <span class="mord accent mtight">
                                                      <span class="vlist-t">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.6944em;">
                                                            <span style="top:-2.7em;">
                                                              <span class="pstrut" style="height:2.7em;"></span>
                                                              <span class="mord mathnormal mtight" style="margin-right:0.02691em;">
                                                                w
                                                              </span>
                                                            </span>
                                                            <span style="top:-2.7em;">
                                                              <span class="pstrut" style="height:2.7em;"></span>
                                                              <span class="accent-body" style="left:-0.1667em;">
                                                                <span class="mord mtight">
                                                                  ^
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t vlist-t2">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.3281em;">
                                                            <span style="top:-2.357em;margin-left:-0.0269em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord mathnormal mtight">
                                                                  i
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                          <span class="vlist-s">
                                                            ​
                                                          </span>
                                                        </span>
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.143em;">
                                                            <span></span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.52em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose nulldelimiter"></span>
                                  </span>
                                </span>
                              </span>
                            </span>
                            and generate
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi>
                                        U
                                      </mi>
                                      <mo>
                                        ∼
                                      </mo>
                                      <mtext>
                                        Uniform
                                      </mtext>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <mo stretchy="false">
                                        [
                                      </mo>
                                      <mn>
                                        0
                                      </mn>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mi>
                                        α
                                      </mi>
                                      <mo stretchy="false">
                                        ]
                                      </mo>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      U \sim \text{Uniform}([0, \alpha])
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6833em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.10903em;">
                                    U
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ∼
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mord text">
                                    <span class="mord">
                                      Uniform
                                    </span>
                                  </span>
                                  <span class="mopen">
                                    ([
                                  </span>
                                  <span class="mord">
                                    0
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.0037em;">
                                    α
                                  </span>
                                  <span class="mclose">
                                    ])
                                  </span>
                                </span>
                              </span>
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            <span class="ps-keyword">
                              for
                            </span>
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mi>
                                        i
                                      </mi>
                                      <mo>
                                        ∈
                                      </mo>
                                      <msub>
                                        <mi>
                                          I
                                        </mi>
                                        <mtext>
                                          stoch
                                        </mtext>
                                      </msub>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      i \in I_\text{stoch}
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:0.6986em;vertical-align:-0.0391em;"></span>
                                  <span class="mord mathnormal">
                                    i
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ∈
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.07847em;">
                                      I
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3361em;">
                                            <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord text mtight">
                                                  <span class="mord mtight">
                                                    stoch
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                            <span class="ps-keyword">
                              do
                            </span>
                          </p>
                          <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                            <p class="ps-line ps-code" dir="auto">
                              Set
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <mi>
                                          U
                                        </mi>
                                        <mo>
                                          ←
                                        </mo>
                                        <mi>
                                          U
                                        </mi>
                                        <mo>
                                          −
                                        </mo>
                                        <msub>
                                          <mover accent="true">
                                            <mi>
                                              w
                                            </mi>
                                            <mo>
                                              ^
                                            </mo>
                                          </mover>
                                          <mi>
                                            i
                                          </mi>
                                        </msub>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        U \gets U - \hat{w}_i
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.6833em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.10903em;">
                                      U
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      ←
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.10903em;">
                                      U
                                    </span>
                                    <span class="mspace" style="margin-right:0.2222em;"></span>
                                    <span class="mbin">
                                      −
                                    </span>
                                    <span class="mspace" style="margin-right:0.2222em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span>
                                    <span class="mord">
                                      <span class="mord accent">
                                        <span class="vlist-t">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.6944em;">
                                              <span style="top:-3em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="mord mathnormal" style="margin-right:0.02691em;">
                                                  w
                                                </span>
                                              </span>
                                              <span style="top:-3em;">
                                                <span class="pstrut" style="height:3em;"></span>
                                                <span class="accent-body" style="left:-0.1667em;">
                                                  <span class="mord">
                                                    ^
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="msupsub">
                                        <span class="vlist-t vlist-t2">
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.3117em;">
                                              <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                                <span class="pstrut" style="height:2.7em;"></span>
                                                <span class="sizing reset-size6 size3 mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span class="vlist-s">
                                              ​
                                            </span>
                                          </span>
                                          <span class="vlist-r">
                                            <span class="vlist" style="height:0.15em;">
                                              <span></span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </p>
                            <p class="ps-line ps-code" dir="auto">
                              <span class="ps-keyword">
                                if
                              </span>
                              <span class="katex">
                                <span class="katex-mathml">
                                  <math xmlns="http://www.w3.org/1998/Math/MathML">
                                    <semantics>
                                      <mrow>
                                        <mi>
                                          U
                                        </mi>
                                        <mo>
                                          &lt;
                                        </mo>
                                        <mn>
                                          0
                                        </mn>
                                      </mrow>
                                      <annotation encoding="application/x-tex">
                                        U &lt; 0
                                      </annotation>
                                    </semantics>
                                  </math>
                                </span>
                                <span class="katex-html" aria-hidden="true">
                                  <span class="base">
                                    <span class="strut" style="height:0.7224em;vertical-align:-0.0391em;"></span>
                                    <span class="mord mathnormal" style="margin-right:0.10903em;">
                                      U
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                    <span class="mrel">
                                      &lt;
                                    </span>
                                    <span class="mspace" style="margin-right:0.2778em;"></span>
                                  </span>
                                  <span class="base">
                                    <span class="strut" style="height:0.6444em;"></span>
                                    <span class="mord">
                                      0
                                    </span>
                                  </span>
                                </span>
                              </span>
                              <span class="ps-keyword">
                                then
                              </span>
                            </p>
                            <div class="ps-block" style="margin-left:0.6em;" dir="auto">
                              <p class="ps-line ps-code" dir="auto">
                                Set
                                <span class="katex">
                                  <span class="katex-mathml">
                                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                                      <semantics>
                                        <mrow>
                                          <msub>
                                            <mi>
                                              I
                                            </mi>
                                            <mtext>
                                              strat
                                            </mtext>
                                          </msub>
                                          <mo>
                                            ←
                                          </mo>
                                          <msub>
                                            <mi>
                                              I
                                            </mi>
                                            <mtext>
                                              strat
                                            </mtext>
                                          </msub>
                                          <mo>
                                            ∪
                                          </mo>
                                          <mo stretchy="false">
                                            {
                                          </mo>
                                          <mi>
                                            i
                                          </mi>
                                          <mo stretchy="false">
                                            }
                                          </mo>
                                        </mrow>
                                        <annotation encoding="application/x-tex">
                                          I_\text{strat} \gets I_\text{strat} \cup \{i\}
                                        </annotation>
                                      </semantics>
                                    </math>
                                  </span>
                                  <span class="katex-html" aria-hidden="true">
                                    <span class="base">
                                      <span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal" style="margin-right:0.07847em;">
                                          I
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.2806em;">
                                                <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord text mtight">
                                                      <span class="mord mtight">
                                                        strat
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                      <span class="mrel">
                                        ←
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span>
                                      <span class="mord">
                                        <span class="mord mathnormal" style="margin-right:0.07847em;">
                                          I
                                        </span>
                                        <span class="msupsub">
                                          <span class="vlist-t vlist-t2">
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.2806em;">
                                                <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                                  <span class="pstrut" style="height:2.7em;"></span>
                                                  <span class="sizing reset-size6 size3 mtight">
                                                    <span class="mord text mtight">
                                                      <span class="mord mtight">
                                                        strat
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                              <span class="vlist-s">
                                                ​
                                              </span>
                                            </span>
                                            <span class="vlist-r">
                                              <span class="vlist" style="height:0.15em;">
                                                <span></span>
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                      <span class="mspace" style="margin-right:0.2222em;"></span>
                                      <span class="mbin">
                                        ∪
                                      </span>
                                      <span class="mspace" style="margin-right:0.2222em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                      <span class="mopen">
                                        {
                                      </span>
                                      <span class="mord mathnormal">
                                        i
                                      </span>
                                      <span class="mclose">
                                        }
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </p>
                              <p class="ps-line ps-code" dir="auto">
                                Set
                                <span class="katex">
                                  <span class="katex-mathml">
                                    <math xmlns="http://www.w3.org/1998/Math/MathML">
                                      <semantics>
                                        <mrow>
                                          <mi>
                                            U
                                          </mi>
                                          <mo>
                                            ←
                                          </mo>
                                          <mi>
                                            U
                                          </mi>
                                          <mo>
                                            +
                                          </mo>
                                          <mi>
                                            α
                                          </mi>
                                        </mrow>
                                        <annotation encoding="application/x-tex">
                                          U \gets U + \alpha
                                        </annotation>
                                      </semantics>
                                    </math>
                                  </span>
                                  <span class="katex-html" aria-hidden="true">
                                    <span class="base">
                                      <span class="strut" style="height:0.6833em;"></span>
                                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                                        U
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                      <span class="mrel">
                                        ←
                                      </span>
                                      <span class="mspace" style="margin-right:0.2778em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span>
                                      <span class="mord mathnormal" style="margin-right:0.10903em;">
                                        U
                                      </span>
                                      <span class="mspace" style="margin-right:0.2222em;"></span>
                                      <span class="mbin">
                                        +
                                      </span>
                                      <span class="mspace" style="margin-right:0.2222em;"></span>
                                    </span>
                                    <span class="base">
                                      <span class="strut" style="height:0.4306em;"></span>
                                      <span class="mord mathnormal" style="margin-right:0.0037em;">
                                        α
                                      </span>
                                    </span>
                                  </span>
                                </span>
                              </p>
                            </div>
                            <p class="ps-line ps-code" dir="auto">
                              <span class="ps-keyword">
                                end if
                              </span>
                            </p>
                          </div>
                          <p class="ps-line ps-code" dir="auto">
                            <span class="ps-keyword">
                              end for
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            Set particles
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <msub>
                                        <mi>
                                          x
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <msub>
                                        <mi>
                                          w
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <msub>
                                        <mo stretchy="false">
                                          }
                                        </mo>
                                        <mrow>
                                          <mi>
                                            i
                                          </mi>
                                          <mo>
                                            =
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mo>
                                            …
                                          </mo>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mi mathvariant="normal">
                                            ∣
                                          </mi>
                                          <msub>
                                            <mi>
                                              I
                                            </mi>
                                            <mtext>
                                              det
                                            </mtext>
                                          </msub>
                                          <mi mathvariant="normal">
                                            ∣
                                          </mi>
                                        </mrow>
                                      </msub>
                                      <mo>
                                        ←
                                      </mo>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <msub>
                                        <mi>
                                          x
                                        </mi>
                                        <mi>
                                          j
                                        </mi>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <msub>
                                        <mi>
                                          w
                                        </mi>
                                        <mi>
                                          j
                                        </mi>
                                      </msub>
                                      <mo>
                                        ⋅
                                      </mo>
                                      <mfrac>
                                        <mi>
                                          N
                                        </mi>
                                        <msup>
                                          <mi>
                                            N
                                          </mi>
                                          <mo mathvariant="normal" lspace="0em" rspace="0em">
                                            ′
                                          </mo>
                                        </msup>
                                      </mfrac>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <mo>
                                        ∣
                                      </mo>
                                      <mi>
                                        j
                                      </mi>
                                      <mo>
                                        ∈
                                      </mo>
                                      <msub>
                                        <mi>
                                          I
                                        </mi>
                                        <mtext>
                                          det
                                        </mtext>
                                      </msub>
                                      <mo stretchy="false">
                                        }
                                      </mo>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      \{(x_i, w_i)\}_{i=1,\ldots,|I_\text{det}|} \gets \{(x_j, w_j \cdot \frac{N}{N'}) \mid j \in I_\text{det}\}
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span>
                                  <span class="mopen">
                                    {(
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      x
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.02691em;">
                                      w
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    )
                                  </span>
                                  <span class="mclose">
                                    <span class="mclose">
                                      }
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3448em;">
                                            <span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                  <span class="mrel mtight">
                                                    =
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                  <span class="mpunct mtight">
                                                    ,
                                                  </span>
                                                  <span class="minner mtight">
                                                    …
                                                  </span>
                                                  <span class="mpunct mtight">
                                                    ,
                                                  </span>
                                                  <span class="mord mtight">
                                                    ∣
                                                  </span>
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.07847em;">
                                                      I
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t vlist-t2">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.3448em;">
                                                            <span style="top:-2.3488em;margin-left:-0.0785em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord text mtight">
                                                                  <span class="mord mtight">
                                                                    det
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                          <span class="vlist-s">
                                                            ​
                                                          </span>
                                                        </span>
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.1512em;">
                                                            <span></span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="mord mtight">
                                                    ∣
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3552em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ←
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1.0361em;vertical-align:-0.2861em;"></span>
                                  <span class="mopen">
                                    {(
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      x
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                  j
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2861em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.02691em;">
                                      w
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                  j
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2861em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2222em;"></span>
                                  <span class="mbin">
                                    ⋅
                                  </span>
                                  <span class="mspace" style="margin-right:0.2222em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1.2173em;vertical-align:-0.345em;"></span>
                                  <span class="mord">
                                    <span class="mopen nulldelimiter"></span>
                                    <span class="mfrac">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.8723em;">
                                            <span style="top:-2.655em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                      N
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.6828em;">
                                                            <span style="top:-2.786em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord mtight">
                                                                  <span class="mord mtight">
                                                                    ′
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span style="top:-3.23em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                            </span>
                                            <span style="top:-3.394em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                    N
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.345em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose nulldelimiter"></span>
                                  </span>
                                  <span class="mclose">
                                    )
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ∣
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.05724em;">
                                    j
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ∈
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.07847em;">
                                      I
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3361em;">
                                            <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord text mtight">
                                                  <span class="mord mtight">
                                                    det
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    }
                                  </span>
                                </span>
                              </span>
                            </span>
                          </p>
                          <p class="ps-line ps-code" dir="auto">
                            Set particles
                            <span class="katex">
                              <span class="katex-mathml">
                                <math xmlns="http://www.w3.org/1998/Math/MathML">
                                  <semantics>
                                    <mrow>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <msub>
                                        <mi>
                                          x
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <msub>
                                        <mi>
                                          w
                                        </mi>
                                        <mi>
                                          i
                                        </mi>
                                      </msub>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <msub>
                                        <mo stretchy="false">
                                          }
                                        </mo>
                                        <mrow>
                                          <mi>
                                            i
                                          </mi>
                                          <mo>
                                            =
                                          </mo>
                                          <mi mathvariant="normal">
                                            ∣
                                          </mi>
                                          <msub>
                                            <mi>
                                              I
                                            </mi>
                                            <mtext>
                                              det
                                            </mtext>
                                          </msub>
                                          <mi mathvariant="normal">
                                            ∣
                                          </mi>
                                          <mo>
                                            +
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mo>
                                            …
                                          </mo>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mi>
                                            N
                                          </mi>
                                        </mrow>
                                      </msub>
                                      <mo>
                                        ←
                                      </mo>
                                      <mo stretchy="false">
                                        {
                                      </mo>
                                      <mo stretchy="false">
                                        (
                                      </mo>
                                      <msub>
                                        <mi>
                                          x
                                        </mi>
                                        <mi>
                                          j
                                        </mi>
                                      </msub>
                                      <mo separator="true">
                                        ,
                                      </mo>
                                      <mfrac>
                                        <mi>
                                          N
                                        </mi>
                                        <mrow>
                                          <msup>
                                            <mi>
                                              c
                                            </mi>
                                            <mo>
                                              ∗
                                            </mo>
                                          </msup>
                                          <msup>
                                            <mi>
                                              N
                                            </mi>
                                            <mo mathvariant="normal" lspace="0em" rspace="0em">
                                              ′
                                            </mo>
                                          </msup>
                                        </mrow>
                                      </mfrac>
                                      <msubsup>
                                        <mo>
                                          ∑
                                        </mo>
                                        <mrow>
                                          <mi>
                                            l
                                          </mi>
                                          <mo>
                                            =
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                        </mrow>
                                        <mi>
                                          N
                                        </mi>
                                      </msubsup>
                                      <msubsup>
                                        <mo>
                                          ∑
                                        </mo>
                                        <mrow>
                                          <mi>
                                            k
                                          </mi>
                                          <mo>
                                            =
                                          </mo>
                                          <mn>
                                            1
                                          </mn>
                                        </mrow>
                                        <msub>
                                          <mi>
                                            K
                                          </mi>
                                          <mi>
                                            l
                                          </mi>
                                        </msub>
                                      </msubsup>
                                      <msub>
                                        <mi>
                                          w
                                        </mi>
                                        <mrow>
                                          <mo stretchy="false">
                                            (
                                          </mo>
                                          <mi>
                                            j
                                          </mi>
                                          <mo separator="true">
                                            ,
                                          </mo>
                                          <mi>
                                            k
                                          </mi>
                                          <mo stretchy="false">
                                            )
                                          </mo>
                                        </mrow>
                                      </msub>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <mo>
                                        ∣
                                      </mo>
                                      <mi>
                                        j
                                      </mi>
                                      <mo>
                                        ∈
                                      </mo>
                                      <msub>
                                        <mi>
                                          I
                                        </mi>
                                        <mtext>
                                          strat
                                        </mtext>
                                      </msub>
                                      <mo stretchy="false">
                                        }
                                      </mo>
                                    </mrow>
                                    <annotation encoding="application/x-tex">
                                      \{(x_i, w_i)\}_{i=|I_\text{det}|+1,\ldots,N} \gets \{(x_j, \frac{N}{c^* N'} \sum_{l=1}^{N} \sum_{k=1}^{K_l} w_{(j,k)}) \mid j \in I_\text{strat}\}
                                    </annotation>
                                  </semantics>
                                </math>
                              </span>
                              <span class="katex-html" aria-hidden="true">
                                <span class="base">
                                  <span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span>
                                  <span class="mopen">
                                    {(
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      x
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.02691em;">
                                      w
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    )
                                  </span>
                                  <span class="mclose">
                                    <span class="mclose">
                                      }
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3448em;">
                                            <span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                  <span class="mrel mtight">
                                                    =
                                                  </span>
                                                  <span class="mord mtight">
                                                    ∣
                                                  </span>
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.07847em;">
                                                      I
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t vlist-t2">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.3448em;">
                                                            <span style="top:-2.3488em;margin-left:-0.0785em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord text mtight">
                                                                  <span class="mord mtight">
                                                                    det
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                          <span class="vlist-s">
                                                            ​
                                                          </span>
                                                        </span>
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.1512em;">
                                                            <span></span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="mord mtight">
                                                    ∣
                                                  </span>
                                                  <span class="mbin mtight">
                                                    +
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                  <span class="mpunct mtight">
                                                    ,
                                                  </span>
                                                  <span class="minner mtight">
                                                    …
                                                  </span>
                                                  <span class="mpunct mtight">
                                                    ,
                                                  </span>
                                                  <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                    N
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3552em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ←
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1.3364em;vertical-align:-0.3552em;"></span>
                                  <span class="mopen">
                                    {(
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      x
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                  j
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2861em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mopen nulldelimiter"></span>
                                    <span class="mfrac">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.8723em;">
                                            <span style="top:-2.655em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight">
                                                      c
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.6183em;">
                                                            <span style="top:-2.786em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mbin mtight">
                                                                  ∗
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                      N
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.6828em;">
                                                            <span style="top:-2.786em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord mtight">
                                                                  <span class="mord mtight">
                                                                    ′
                                                                  </span>
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span style="top:-3.23em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                            </span>
                                            <span style="top:-3.394em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                    N
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.345em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose nulldelimiter"></span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mop">
                                    <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                      ∑
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.9812em;">
                                            <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight" style="margin-right:0.01968em;">
                                                    l
                                                  </span>
                                                  <span class="mrel mtight">
                                                    =
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span style="top:-3.2029em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                    N
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2997em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mop">
                                    <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                      ∑
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.9812em;">
                                            <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                    k
                                                  </span>
                                                  <span class="mrel mtight">
                                                    =
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span style="top:-3.2029em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mtight">
                                                    <span class="mord mathnormal mtight" style="margin-right:0.07153em;">
                                                      K
                                                    </span>
                                                    <span class="msupsub">
                                                      <span class="vlist-t vlist-t2">
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.3448em;">
                                                            <span style="top:-2.3488em;margin-left:-0.0715em;margin-right:0.0714em;">
                                                              <span class="pstrut" style="height:2.5em;"></span>
                                                              <span class="sizing reset-size3 size1 mtight">
                                                                <span class="mord mathnormal mtight" style="margin-right:0.01968em;">
                                                                  l
                                                                </span>
                                                              </span>
                                                            </span>
                                                          </span>
                                                          <span class="vlist-s">
                                                            ​
                                                          </span>
                                                        </span>
                                                        <span class="vlist-r">
                                                          <span class="vlist" style="height:0.1512em;">
                                                            <span></span>
                                                          </span>
                                                        </span>
                                                      </span>
                                                    </span>
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2997em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.02691em;">
                                      w
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3448em;">
                                            <span style="top:-2.5198em;margin-left:-0.0269em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mopen mtight">
                                                    (
                                                  </span>
                                                  <span class="mord mathnormal mtight" style="margin-right:0.05724em;">
                                                    j
                                                  </span>
                                                  <span class="mpunct mtight">
                                                    ,
                                                  </span>
                                                  <span class="mord mathnormal mtight" style="margin-right:0.03148em;">
                                                    k
                                                  </span>
                                                  <span class="mclose mtight">
                                                    )
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3552em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    )
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ∣
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:0.854em;vertical-align:-0.1944em;"></span>
                                  <span class="mord mathnormal" style="margin-right:0.05724em;">
                                    j
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    ∈
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                </span>
                                <span class="base">
                                  <span class="strut" style="height:1em;vertical-align:-0.25em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.07847em;">
                                      I
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2806em;">
                                            <span style="top:-2.55em;margin-left:-0.0785em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord text mtight">
                                                  <span class="mord mtight">
                                                    strat
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    }
                                  </span>
                                </span>
                              </span>
                            </span>
                          </p>
                        </div>
                        <p class="ps-line ps-code" dir="auto">
                          <span class="ps-keyword">
                            end while
                          </span>
                        </p>
                        <p class="ps-line ps-code" dir="auto"></p>
                        <p class="ps-line ps-code" dir="auto">
                          <span class="ps-keyword">
                            return
                          </span>
                          <span class="katex">
                            <span class="katex-mathml">
                              <math xmlns="http://www.w3.org/1998/Math/MathML">
                                <semantics>
                                  <mrow>
                                    <mo fence="true">
                                      (
                                    </mo>
                                    <mo stretchy="false">
                                      (
                                    </mo>
                                    <msub>
                                      <mi>
                                        x
                                      </mi>
                                      <mi>
                                        i
                                      </mi>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <msub>
                                      <mi>
                                        w
                                      </mi>
                                      <mi>
                                        i
                                      </mi>
                                    </msub>
                                    <msub>
                                      <mo stretchy="false">
                                        )
                                      </mo>
                                      <mrow>
                                        <mi>
                                          i
                                        </mi>
                                        <mo>
                                          =
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mo>
                                          …
                                        </mo>
                                        <mo separator="true">
                                          ,
                                        </mo>
                                        <mi>
                                          N
                                        </mi>
                                      </mrow>
                                    </msub>
                                    <mo separator="true">
                                      ,
                                    </mo>
                                    <mover accent="true">
                                      <mi>
                                        Z
                                      </mi>
                                      <mo>
                                        ^
                                      </mo>
                                    </mover>
                                    <mo>
                                      =
                                    </mo>
                                    <mfrac>
                                      <mn>
                                        1
                                      </mn>
                                      <mi>
                                        N
                                      </mi>
                                    </mfrac>
                                    <msubsup>
                                      <mo>
                                        ∑
                                      </mo>
                                      <mrow>
                                        <mi>
                                          i
                                        </mi>
                                        <mo>
                                          =
                                        </mo>
                                        <mn>
                                          1
                                        </mn>
                                      </mrow>
                                      <mi>
                                        N
                                      </mi>
                                    </msubsup>
                                    <msub>
                                      <mi>
                                        w
                                      </mi>
                                      <mi>
                                        i
                                      </mi>
                                    </msub>
                                    <mo fence="true">
                                      )
                                    </mo>
                                  </mrow>
                                  <annotation encoding="application/x-tex">
                                    \left((x_i, w_i)_{i=1,\ldots,N}, \hat{Z} = \frac{1}{N} \sum_{i=1}^N w_i \right)
                                  </annotation>
                                </semantics>
                              </math>
                            </span>
                            <span class="katex-html" aria-hidden="true">
                              <span class="base">
                                <span class="strut" style="height:1.8em;vertical-align:-0.65em;"></span>
                                <span class="minner">
                                  <span class="mopen delimcenter" style="top:0em;">
                                    <span class="delimsizing size2">
                                      (
                                    </span>
                                  </span>
                                  <span class="mopen">
                                    (
                                  </span>
                                  <span class="mord">
                                    <span class="mord mathnormal">
                                      x
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.02691em;">
                                      w
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose">
                                    <span class="mclose">
                                      )
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3283em;">
                                            <span style="top:-2.55em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                  <span class="mrel mtight">
                                                    =
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                  <span class="mpunct mtight">
                                                    ,
                                                  </span>
                                                  <span class="minner mtight">
                                                    …
                                                  </span>
                                                  <span class="mpunct mtight">
                                                    ,
                                                  </span>
                                                  <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                    N
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2861em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mpunct">
                                    ,
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord accent">
                                    <span class="vlist-t">
                                      <span class="vlist-r">
                                        <span class="vlist" style="height:0.9468em;">
                                          <span style="top:-3em;">
                                            <span class="pstrut" style="height:3em;"></span>
                                            <span class="mord mathnormal" style="margin-right:0.07153em;">
                                              Z
                                            </span>
                                          </span>
                                          <span style="top:-3.2523em;">
                                            <span class="pstrut" style="height:3em;"></span>
                                            <span class="accent-body" style="left:-0.1667em;">
                                              <span class="mord">
                                                ^
                                              </span>
                                            </span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mrel">
                                    =
                                  </span>
                                  <span class="mspace" style="margin-right:0.2778em;"></span>
                                  <span class="mord">
                                    <span class="mopen nulldelimiter"></span>
                                    <span class="mfrac">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.8451em;">
                                            <span style="top:-2.655em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                    N
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span style="top:-3.23em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="frac-line" style="border-bottom-width:0.04em;"></span>
                                            </span>
                                            <span style="top:-3.394em;">
                                              <span class="pstrut" style="height:3em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.345em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                    <span class="mclose nulldelimiter"></span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mop">
                                    <span class="mop op-symbol small-op" style="position:relative;top:0em;">
                                      ∑
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.9812em;">
                                            <span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mtight">
                                                  <span class="mord mathnormal mtight">
                                                    i
                                                  </span>
                                                  <span class="mrel mtight">
                                                    =
                                                  </span>
                                                  <span class="mord mtight">
                                                    1
                                                  </span>
                                                </span>
                                              </span>
                                            </span>
                                            <span style="top:-3.2029em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight" style="margin-right:0.10903em;">
                                                  N
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.2997em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mspace" style="margin-right:0.1667em;"></span>
                                  <span class="mord">
                                    <span class="mord mathnormal" style="margin-right:0.02691em;">
                                      w
                                    </span>
                                    <span class="msupsub">
                                      <span class="vlist-t vlist-t2">
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.3117em;">
                                            <span style="top:-2.55em;margin-left:-0.0269em;margin-right:0.05em;">
                                              <span class="pstrut" style="height:2.7em;"></span>
                                              <span class="sizing reset-size6 size3 mtight">
                                                <span class="mord mathnormal mtight">
                                                  i
                                                </span>
                                              </span>
                                            </span>
                                          </span>
                                          <span class="vlist-s">
                                            ​
                                          </span>
                                        </span>
                                        <span class="vlist-r">
                                          <span class="vlist" style="height:0.15em;">
                                            <span></span>
                                          </span>
                                        </span>
                                      </span>
                                    </span>
                                  </span>
                                  <span class="mclose delimcenter" style="top:0em;">
                                    <span class="delimsizing size2">
                                      )
                                    </span>
                                  </span>
                                </span>
                              </span>
                            </span>
                          </span>
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
                <section data-references class="bibliography">
                  <h2 id="reference-label-reader" dir="auto">
                    References
                    <a role="anchor" aria-hidden="true" tabindex="-1" data-no-popover="true" href="#reference-label-reader" class="internal">
                      <span class="indicator-hook"></span>
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                        <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
                      </svg>
                    </a>
                  </h2>
                  <ul dir="auto">
                    <li class="csl-entry" id="bib-lew2023sequentialmontecarlosteering-reader">
                      Lew, A. K., Zhi-Xuan, T., Grand, G., &amp; Mansinghka, V. K. (2023).
                      <i>
                        Sequential Monte Carlo Steering of Large Language Models using Probabilistic Programs
                      </i>
                      . arXiv preprint arXiv:2306.03081
                      <a href="https://arxiv.org/abs/2306.03081" target="_blank" rel="noopener noreferrer" class="internal" data-arxiv-id="2306.03081" data-no-popover="true">
                        <span class="indicator-hook"></span>
                        arxiv
                      </a>
                    </li>
                    <li class="csl-entry" id="bib-vaswani2023attentionneed-reader">
                      Vaswani, A., Shazeer, N., Parmar, N., Uszkoreit, J., Jones, L., Gomez, A. N., Kaiser, L., &amp; Polosukhin, I. (2023).
                      <i>
                        Attention Is All You Need
                      </i>
                      . arXiv preprint arXiv:1706.03762
                      <a href="https://arxiv.org/abs/1706.03762" target="_blank" rel="noopener noreferrer" class="internal" data-arxiv-id="1706.03762" data-no-popover="true">
                        <span class="indicator-hook"></span>
                        arxiv
                      </a>
                    </li>
                  </ul>
                </section>
              </div>
            </div>
          </div>
          <div class="image-popup-modal" id="image-popup-modal">
            <div class="image-popup-backdrop"></div>
            <div class="image-popup-content">
              <button class="image-popup-close" aria-label="Close popup">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
              <img class="image-popup-img" src alt/>
            </div>
          </div>
          <div id="mermaid-container">
            <div class="mermaid-backdrop"></div>
            <div id="mermaid-space">
              <div class="mermaid-header">
                <button class="close-button" aria-label="close button">
                  <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
              <div class="mermaid-content"></div>
            </div>
          </div>
        </section>
      </section>
    </main>
  </body>
  <script type="application/javascript">
    function i(){let l=this.parentElement;l.classList.toggle("is-collapsed");let e=l.classList.contains("is-collapsed")?this.scrollHeight:l.scrollHeight;l.style.maxHeight=e+"px";let s=l,t=l.parentElement;for(;t;){if(!t.classList.contains("callout"))return;let a=t.classList.contains("is-collapsed")?t.scrollHeight:t.scrollHeight+s.scrollHeight;t.style.maxHeight=a+"px",s=t,t=t.parentElement}}function r(l){let o=l.getBoundingClientRect(),e=1056,s=o.height;return o.top%e+s>e}function c(){let l=document.getElementsByClassName("callout is-collapsible");for(let e of l){let s=e.firstElementChild;if(s){s.addEventListener("click",i),window.addCleanup(()=>s.removeEventListener("click",i));let n=e.classList.contains("is-collapsed")?s.scrollHeight:e.scrollHeight;e.style.maxHeight=n+"px"}}let o=document.getElementsByClassName("callout");for(let e of o)r(e)&&(e.style.pageBreakBefore="always",e.classList.add("force-page-break"))}document.addEventListener("nav",c);window.addEventListener("resize",c);
  </script>
  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/copy-tex.min.js" type="application/javascript"></script>
  <script src="../postscript.js" type="module"></script>
</html>