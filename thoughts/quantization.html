<!doctype html>
<html lang="fr">
  <head>
    <title>Quantization</title>
    <meta charset="utf-8" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="og:site_name" content="Aaron's notes" />
    <meta property="og:locale" content="fr-FR" />
    <meta property="og:title" content="Quantization" />
    <meta property="og:type" content="website" />
    <meta name="twitter:site" content="@aarnphm_" />
    <meta name="twitter:creator" content="@aarnphm_" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Quantization" />
    <meta
      name="twitter:description"
      content="See also: this talk I gave at Hack the North 2023.reduce computational and memory costs of running inference with representing the weight and activations with low-precision data type int16 - half precision bfloat16 int8 Note This also applies to post-training quantization, where the methodology is applied after the model has been trained, instead of during load-time."
    />
    <meta
      property="og:description"
      content="See also: this talk I gave at Hack the North 2023.reduce computational and memory costs of running inference with representing the weight and activations with low-precision data type int16 - half precision bfloat16 int8 Note This also applies to post-training quantization, where the methodology is applied after the model has been trained, instead of during load-time."
    />
    <meta property="og:image:type" content="image/webp" />
    <meta
      property="og:image:alt"
      content="See also: this talk I gave at Hack the North 2023.reduce computational and memory costs of running inference with representing the weight and activations with low-precision data type int16 - half precision bfloat16 int8 Note This also applies to post-training quantization, where the methodology is applied after the model has been trained, instead of during load-time."
    />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:width" content="1200" />
    <meta property="og:height" content="630" />
    <meta
      property="og:image"
      content="https://aarnphm.xyz/static/social-images/thoughts-quantization.webp"
    />
    <meta property="og:url" content="https:/aarnphm.xyz/thoughts/quantization" />
    <meta
      property="og:image"
      content="https://aarnphm.xyz/static/social-images/thoughts-quantization.webp"
    />
    <meta
      name="twitter:image"
      content="https://aarnphm.xyz/static/social-images/thoughts-quantization.webp"
    />
    <meta property="twitter:domain" content="https://aarnphm.xyz/" />
    <meta property="twitter:url" content="https:/aarnphm.xyz/thoughts/quantization" />
    <link rel="icon" href="../static/icon.webp" />
    <link rel="canonical" href="https:/aarnphm.xyz/thoughts/quantization" />
    <meta
      name="description"
      content="See also: this talk I gave at Hack the North 2023.reduce computational and memory costs of running inference with representing the weight and activations with low-precision data type int16 - half precision bfloat16 int8 Note This also applies to post-training quantization, where the methodology is applied after the model has been trained, instead of during load-time."
    />
    <meta name="generator" content="Quartz" />
    <link href="../index.css" rel="stylesheet" type="text/css" spa-preserve />
    <link
      href="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.css"
      rel="stylesheet"
      type="text/css"
      spa-preserve
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css"
      rel="stylesheet"
      type="text/css"
      spa-preserve
    />
    <link
      href="https://unpkg.com/cursor-chat/dist/style.css"
      rel="stylesheet"
      type="text/css"
      spa-preserve
    />
    <script src="../prescript.js" type="application/javascript" spa-preserve></script>
    <script type="application/javascript" spa-preserve>
      const fetchData = fetch("../static/contentIndex.json").then((data) => data.json())
    </script>
  </head>
  <body data-slug="thoughts/quantization" data-enable-preview="true">
    <div id="quartz-root" class="page">
      <div id="quartz-body">
        <div class="center">
          <div class="page-header">
            <div class="popover-hint">
              <h1 class="article-title">Quantization</h1>
              <p class="content-meta">
                <span class="date-range"
                  ><span class="page-creation" title="Date de création du contenu de la page"
                    ><em>04 févr. 2024</em></span
                  >–<span class="page-source"
                    ><a class="ref-source"
                      ><span
                        class="page-modification"
                        title="Date de modification du contenu de la page"
                        ><em>19 févr. 2024</em></span
                      ></a
                    ></span
                  ></span
                ><span class="reading-time" title="Temps de lecture estimé">2 min read</span>
              </p>
              <ul class="tags">
                <li><a href="../tags/seed" class="internal tag-link">seed</a></li>
                <li><a href="../tags/ml" class="internal tag-link">ml</a></li>
              </ul>
            </div>
          </div>
          <article class="popover-hint">
            <p>
              See also:
              <a
                href="../thoughts/images/htn-openllm.pdf"
                class="internal alias"
                data-slug="thoughts/images/htn-openllm.pdf"
                >this talk</a
              >
              I gave at Hack the North 2023.
            </p>
            <blockquote>
              <p>
                reduce computational and memory costs of running inference with representing the
                weight and activations with low-precision data type
              </p>
            </blockquote>
            <ul>
              <li>
                <code>int16</code> -
                <a
                  href="../thoughts/quantization#fp32-to-fp16"
                  class="internal alias"
                  data-slug="thoughts/quantization"
                  >half precision</a
                >
              </li>
              <li><code>bfloat16</code></li>
              <li><code>int8</code></li>
            </ul>
            <blockquote class="callout note" data-callout="note">
              <div class="callout-title">
                <div class="callout-icon"></div>
                <div class="callout-title-inner"><p>Note</p></div>
              </div>
              <p>
                This also applies to post-training quantization, where the methodology is applied
                after the model has been trained, instead of during load-time.
              </p>
            </blockquote>
            <h2 id="fp32-to-fp16">
              <code>fp32</code> to <code>fp16</code
              ><a
                role="anchor"
                aria-hidden="true"
                tabindex="-1"
                data-no-popover="true"
                href="#fp32-to-fp16"
                class="internal"
                ><svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                  <path
                    d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
                  ></path></svg
              ></a>
            </h2>
            <blockquote>
              <p>Does my operation support <code>fp16</code>?</p>
            </blockquote>
            <ul>
              <li>
                CPU does support saving <code>fp16</code> weights, but computations are done in
                <code>fp32</code>
              </li>
            </ul>
            <blockquote>
              <p>Does my operation <em>sensitive</em> to <code>fp16</code>?</p>
            </blockquote>
            <p>
              For example <code>epsilon</code> in <code>LayerNormalization</code> usually is very
              small
              <span class="katex"
                ><span class="katex-html" aria-hidden="true"
                  ><span class="base"
                    ><span class="strut" style="height: 0.8141em"></span><span class="mord">1</span
                    ><span class="mord"
                      ><span class="mord mathnormal">e</span
                      ><span class="msupsub"
                        ><span class="vlist-t"
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 0.8141em"
                              ><span style="top: -3.063em; margin-right: 0.05em"
                                ><span class="pstrut" style="height: 2.7em"></span
                                ><span class="sizing reset-size6 size3 mtight"
                                  ><span class="mord mtight"
                                    ><span class="mord mtight">−</span
                                    ><span class="mord mtight">12</span></span
                                  ></span
                                ></span
                              ></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              >, but smallest value in <code>fp16</code> is
              <span class="katex"
                ><span class="katex-html" aria-hidden="true"
                  ><span class="base"
                    ><span class="strut" style="height: 0.4831em"></span><span class="mrel">≈</span
                    ><span class="mspace" style="margin-right: 0.2778em"></span></span
                  ><span class="base"
                    ><span class="strut" style="height: 0.8141em"></span><span class="mord">6</span
                    ><span class="mord"
                      ><span class="mord mathnormal">e</span
                      ><span class="msupsub"
                        ><span class="vlist-t"
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 0.8141em"
                              ><span style="top: -3.063em; margin-right: 0.05em"
                                ><span class="pstrut" style="height: 2.7em"></span
                                ><span class="sizing reset-size6 size3 mtight"
                                  ><span class="mord mtight"
                                    ><span class="mord mtight">−</span
                                    ><span class="mord mtight">5</span></span
                                  ></span
                                ></span
                              ></span
                            ></span
                          ></span
                        ></span
                      ></span
                    ></span
                  ></span
                ></span
              >, which cause <code>NaN</code> issues.
            </p>
            <h2 id="fp32-to-int8">
              <code>fp32</code> to <code>int8</code
              ><a
                role="anchor"
                aria-hidden="true"
                tabindex="-1"
                data-no-popover="true"
                href="#fp32-to-int8"
                class="internal"
                ><svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                  <path
                    d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
                  ></path></svg
              ></a>
            </h2>
            <p>
              Consider a float <code>x</code> in <code>[a, b]</code>, such that
              <em>affine quantization scheme</em>:
            </p>
            <span class="katex-display"
              ><span class="katex"
                ><span class="katex-html" aria-hidden="true"
                  ><span class="base"
                    ><span class="strut" style="height: 0.4306em"></span
                    ><span class="mord mathnormal">x</span
                    ><span class="mspace" style="margin-right: 0.2778em"></span
                    ><span class="mrel">=</span
                    ><span class="mspace" style="margin-right: 0.2778em"></span></span
                  ><span class="base"
                    ><span class="strut" style="height: 0.6833em"></span
                    ><span class="mord mathnormal" style="margin-right: 0.05764em">S</span
                    ><span class="mspace" style="margin-right: 0.2222em"></span
                    ><span class="mbin">⋅</span
                    ><span class="mspace" style="margin-right: 0.2222em"></span></span
                  ><span class="base"
                    ><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em"></span
                    ><span class="mopen">(</span
                    ><span class="mord"
                      ><span class="mord mathnormal">x</span
                      ><span class="msupsub"
                        ><span class="vlist-t vlist-t2"
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 0.1514em"
                              ><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em"
                                ><span class="pstrut" style="height: 2.7em"></span
                                ><span class="sizing reset-size6 size3 mtight"
                                  ><span
                                    class="mord mathnormal mtight"
                                    style="margin-right: 0.03588em"
                                    >q</span
                                  ></span
                                ></span
                              ></span
                            ><span class="vlist-s">​</span></span
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 0.2861em"
                              ><span></span></span></span></span></span></span
                    ><span class="mspace" style="margin-right: 0.2222em"></span
                    ><span class="mbin">−</span
                    ><span class="mspace" style="margin-right: 0.2222em"></span></span
                  ><span class="base"
                    ><span class="strut" style="height: 1em; vertical-align: -0.25em"></span
                    ><span class="mord mathnormal" style="margin-right: 0.07153em">Z</span
                    ><span class="mclose">)</span></span
                  ></span
                ></span
              ></span
            >
            <p>where:</p>
            <ul>
              <li>
                <span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span
                        class="strut"
                        style="height: 0.7167em; vertical-align: -0.2861em"
                      ></span
                      ><span class="mord"
                        ><span class="mord mathnormal">x</span
                        ><span class="msupsub"
                          ><span class="vlist-t vlist-t2"
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.1514em"
                                ><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em"
                                  ><span class="pstrut" style="height: 2.7em"></span
                                  ><span class="sizing reset-size6 size3 mtight"
                                    ><span
                                      class="mord mathnormal mtight"
                                      style="margin-right: 0.03588em"
                                      >q</span
                                    ></span
                                  ></span
                                ></span
                              ><span class="vlist-s">​</span></span
                            ><span class="vlist-r"
                              ><span class="vlist" style="height: 0.2861em"
                                ><span></span></span></span></span></span></span></span></span
                ></span>
                is the quantized <code>int8</code> associated with <code>x</code>
              </li>
              <li>
                <span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6833em"></span
                      ><span class="mord mathnormal" style="margin-right: 0.05764em">S</span></span
                    ></span
                  ></span
                >
                and
                <span class="katex"
                  ><span class="katex-html" aria-hidden="true"
                    ><span class="base"
                      ><span class="strut" style="height: 0.6833em"></span
                      ><span class="mord mathnormal" style="margin-right: 0.07153em">Z</span></span
                    ></span
                  ></span
                >
                are scaling and zero-point parameters
                <ul>
                  <li>
                    <span class="katex"
                      ><span class="katex-html" aria-hidden="true"
                        ><span class="base"
                          ><span class="strut" style="height: 0.6833em"></span
                          ><span class="mord mathnormal" style="margin-right: 0.05764em"
                            >S</span
                          ></span
                        ></span
                      ></span
                    >
                    is the scale, positive <code>float32</code>
                  </li>
                  <li>
                    <span class="katex"
                      ><span class="katex-html" aria-hidden="true"
                        ><span class="base"
                          ><span class="strut" style="height: 0.6833em"></span
                          ><span class="mord mathnormal" style="margin-right: 0.07153em"
                            >Z</span
                          ></span
                        ></span
                      ></span
                    >
                    is the zero-point, or the <code>int8</code> value corresponding to value
                    <code>0</code> in <code>fp32</code>
                  </li>
                </ul>
              </li>
            </ul>
            <p>
              Thus quantized value
              <span class="katex"
                ><span class="katex-html" aria-hidden="true"
                  ><span class="base"
                    ><span class="strut" style="height: 0.7167em; vertical-align: -0.2861em"></span
                    ><span class="mord"
                      ><span class="mord mathnormal">x</span
                      ><span class="msupsub"
                        ><span class="vlist-t vlist-t2"
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 0.1514em"
                              ><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em"
                                ><span class="pstrut" style="height: 2.7em"></span
                                ><span class="sizing reset-size6 size3 mtight"
                                  ><span
                                    class="mord mathnormal mtight"
                                    style="margin-right: 0.03588em"
                                    >q</span
                                  ></span
                                ></span
                              ></span
                            ><span class="vlist-s">​</span></span
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 0.2861em"
                              ><span></span></span></span></span></span></span></span></span
              ></span>
              is:
              <span class="katex"
                ><span class="katex-html" aria-hidden="true"
                  ><span class="base"
                    ><span class="strut" style="height: 0.7167em; vertical-align: -0.2861em"></span
                    ><span class="mord"
                      ><span class="mord mathnormal">x</span
                      ><span class="msupsub"
                        ><span class="vlist-t vlist-t2"
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 0.1514em"
                              ><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em"
                                ><span class="pstrut" style="height: 2.7em"></span
                                ><span class="sizing reset-size6 size3 mtight"
                                  ><span
                                    class="mord mathnormal mtight"
                                    style="margin-right: 0.03588em"
                                    >q</span
                                  ></span
                                ></span
                              ></span
                            ><span class="vlist-s">​</span></span
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 0.2861em"
                              ><span></span></span></span></span></span></span
                    ><span class="mspace" style="margin-right: 0.2778em"></span
                    ><span class="mrel">=</span
                    ><span class="mspace" style="margin-right: 0.2778em"></span></span
                  ><span class="base"
                    ><span class="strut" style="height: 1em; vertical-align: -0.25em"></span
                    ><span class="mord text"><span class="mord">round</span></span
                    ><span class="mopen">(</span><span class="mord mathnormal">x</span
                    ><span class="mord">/</span
                    ><span class="mord mathnormal" style="margin-right: 0.05764em">S</span
                    ><span class="mspace" style="margin-right: 0.2222em"></span
                    ><span class="mbin">+</span
                    ><span class="mspace" style="margin-right: 0.2222em"></span></span
                  ><span class="base"
                    ><span class="strut" style="height: 1em; vertical-align: -0.25em"></span
                    ><span class="mord mathnormal" style="margin-right: 0.07153em">Z</span
                    ><span class="mclose">)</span></span
                  ></span
                ></span
              >
            </p>
            <p>
              And <code>fp32</code> value outside of <code>[a, b]</code> is clipped to closest
              representable value.
            </p>
            <span class="katex-display"
              ><span class="katex"
                ><span class="katex-html" aria-hidden="true"
                  ><span class="base"
                    ><span class="strut" style="height: 0.7335em; vertical-align: -0.0391em"></span
                    ><span class="mord">∀</span><span class="mord mathnormal">x</span
                    ><span class="mspace" style="margin-right: 0.2778em"></span
                    ><span class="mrel">∈</span
                    ><span class="mspace" style="margin-right: 0.2778em"></span></span
                  ><span class="base"
                    ><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em"></span
                    ><span class="mopen">[</span><span class="mord mathnormal">a</span
                    ><span class="mpunct">,</span
                    ><span class="mspace" style="margin-right: 0.1667em"></span
                    ><span class="mord mathnormal">b</span><span class="mclose">]</span
                    ><span class="mspace" style="margin-right: 1em"></span
                    ><span class="mord"
                      ><span class="mord mathnormal">x</span
                      ><span class="msupsub"
                        ><span class="vlist-t vlist-t2"
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 0.1514em"
                              ><span style="top: -2.55em; margin-left: 0em; margin-right: 0.05em"
                                ><span class="pstrut" style="height: 2.7em"></span
                                ><span class="sizing reset-size6 size3 mtight"
                                  ><span
                                    class="mord mathnormal mtight"
                                    style="margin-right: 0.03588em"
                                    >q</span
                                  ></span
                                ></span
                              ></span
                            ><span class="vlist-s">​</span></span
                          ><span class="vlist-r"
                            ><span class="vlist" style="height: 0.2861em"
                              ><span></span></span></span></span></span></span
                    ><span class="mspace" style="margin-right: 0.2778em"></span
                    ><span class="mrel">=</span
                    ><span class="mspace" style="margin-right: 0.2778em"></span></span
                  ><span class="base"
                    ><span class="strut" style="height: 1em; vertical-align: -0.25em"></span
                    ><span class="mord text"><span class="mord">clip</span></span
                    ><span class="mopen">(</span
                    ><span class="mord text"><span class="mord">round</span></span
                    ><span class="mopen">(</span><span class="mord mathnormal">x</span
                    ><span class="mord">/</span
                    ><span class="mord mathnormal" style="margin-right: 0.05764em">S</span
                    ><span class="mspace" style="margin-right: 0.2222em"></span
                    ><span class="mbin">+</span
                    ><span class="mspace" style="margin-right: 0.2222em"></span></span
                  ><span class="base"
                    ><span class="strut" style="height: 1em; vertical-align: -0.25em"></span
                    ><span class="mord mathnormal" style="margin-right: 0.07153em">Z</span
                    ><span class="mclose">)</span><span class="mpunct">,</span
                    ><span class="mspace" style="margin-right: 0.1667em"></span
                    ><span class="mord text"><span class="mord">round</span></span
                    ><span class="mopen">(</span><span class="mord mathnormal">a</span
                    ><span class="mord">/</span
                    ><span class="mord mathnormal" style="margin-right: 0.05764em">S</span
                    ><span class="mspace" style="margin-right: 0.2222em"></span
                    ><span class="mbin">+</span
                    ><span class="mspace" style="margin-right: 0.2222em"></span></span
                  ><span class="base"
                    ><span class="strut" style="height: 1em; vertical-align: -0.25em"></span
                    ><span class="mord mathnormal" style="margin-right: 0.07153em">Z</span
                    ><span class="mclose">)</span><span class="mpunct">,</span
                    ><span class="mspace" style="margin-right: 0.1667em"></span
                    ><span class="mord text"><span class="mord">round</span></span
                    ><span class="mopen">(</span><span class="mord mathnormal">b</span
                    ><span class="mord">/</span
                    ><span class="mord mathnormal" style="margin-right: 0.05764em">S</span
                    ><span class="mspace" style="margin-right: 0.2222em"></span
                    ><span class="mbin">+</span
                    ><span class="mspace" style="margin-right: 0.2222em"></span></span
                  ><span class="base"
                    ><span class="strut" style="height: 1em; vertical-align: -0.25em"></span
                    ><span class="mord mathnormal" style="margin-right: 0.07153em">Z</span
                    ><span class="mclose">))</span></span
                  ></span
                ></span
              ></span
            >
            <p>
              See also:
              <a href="https://arxiv.org/abs/1712.05877" class="external"
                >paper<svg class="external-icon" viewBox="0 0 512 512">
                  <path
                    d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"
                  ></path></svg
              ></a>
            </p>
            <h2 id="quantization-time">
              quantization time<a
                role="anchor"
                aria-hidden="true"
                tabindex="-1"
                data-no-popover="true"
                href="#quantization-time"
                class="internal"
                ><svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                  <path
                    d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
                  ></path></svg
              ></a>
            </h2>
            <ul>
              <li>
                Post-training <strong>dynamic quantization</strong>: range of each activation is
                computed on the fly at <em>runtime</em>
              </li>
              <li>
                Post-training <strong>static quantization</strong>: range of each activation is
                computed <em>offline</em> before <em>runtime</em>
                <ul>
                  <li>Observers are put on activations to collect their value</li>
                  <li>certain number of forward passes on calibration datasets</li>
                  <li>
                    range of each computation are computed according to some
                    <em>calibration technique</em>
                  </li>
                </ul>
              </li>
              <li>
                <strong>Quantization aware training</strong>: range of each activation is computed
                <em>during training</em>
                <ul>
                  <li>
                    <code>fake_quantize</code> operations are inserted in the computation graph
                  </li>
                  <li>
                    <code>fake_quantize</code> is a no-op during inference, but during training, it
                    simulates the effect of quantization
                  </li>
                </ul>
              </li>
            </ul>
            <h2 id="methods-and-libraries">
              Methods and libraries<a
                role="anchor"
                aria-hidden="true"
                tabindex="-1"
                data-no-popover="true"
                href="#methods-and-libraries"
                class="internal"
                ><svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
                  <path
                    d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"
                  ></path></svg
              ></a>
            </h2>
            <p>
              <a href="https://github.com/TimDettmers/bitsandbytes" class="external"
                >bitsandbytes<svg class="external-icon" viewBox="0 0 512 512">
                  <path
                    d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"
                  ></path></svg></a
              > and <a href="https://arxiv.org/abs/2210.17323" class="external"
                >GPTQ<svg class="external-icon" viewBox="0 0 512 512">
                  <path
                    d="M320 0H288V64h32 82.7L201.4 265.4 178.7 288 224 333.3l22.6-22.6L448 109.3V192v32h64V192 32 0H480 320zM32 32H0V64 480v32H32 456h32V480 352 320H424v32 96H64V96h96 32V32H160 32z"
                  ></path></svg
              ></a>
            </p>
          </article>
        </div>
        <div class="right sidebar">
          <div class="search">
            <div id="search-icon">
              <p>Recherche</p>
              <div></div>
              <svg
                tabindex="0"
                aria-labelledby="title desc"
                role="img"
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 19.9 19.7"
              >
                <title id="title">Search</title>
                <desc id="desc">Search</desc>
                <g class="search-path" fill="none">
                  <path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"></path>
                  <circle cx="8" cy="8" r="7"></circle>
                </g>
              </svg>
            </div>
            <div id="search-container">
              <div id="search-space">
                <input
                  autocomplete="off"
                  id="search-bar"
                  name="search"
                  type="text"
                  aria-label="Rechercher quelque chose"
                  placeholder="Rechercher quelque chose"
                />
                <div id="search-layout" data-preview="true"></div>
              </div>
            </div>
          </div>
          <div class="keybind desktop-only" lang="fr">
            <kbd id="shortcut-key" data-mapping='["cmd--/","ctrl--/"]'>⌘ /</kbd>
            <div id="shortcut-container">
              <div id="shortcut-space">
                <div id="title">raccourcis clavier</div>
                <ul>
                  <li>
                    <div id="shortcuts">
                      <div><kbd id="clickable-kbd" data-keybind="cmd--k">⌘ k</kbd></div>
                      <span>recherche</span>
                    </div>
                  </li>
                  <li>
                    <div id="shortcuts">
                      <div><kbd id="clickable-kbd" data-keybind="cmd--g">⌘ g</kbd></div>
                      <span>graphique</span>
                    </div>
                  </li>
                  <li>
                    <div id="shortcuts">
                      <div><kbd id="clickable-kbd" data-keybind="cmd--\">⌘ \</kbd></div>
                      <span>page d'accueil</span>
                    </div>
                  </li>
                  <li>
                    <div id="shortcuts">
                      <div><kbd id="clickable-kbd" data-keybind="cmd--.">⌘ .</kbd></div>
                      <span>curseur de chat</span>
                    </div>
                  </li>
                  <li>
                    <div id="shortcuts">
                      <div><kbd id="clickable-kbd" data-keybind="cmd--l">⌘ l</kbd></div>
                      <span>projets</span>
                    </div>
                  </li>
                  <li>
                    <div id="shortcuts">
                      <div><kbd id="clickable-kbd" data-keybind="cmd--j">⌘ j</kbd></div>
                      <span>curius</span>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <div class="graph">
            <h3>Vue Graphique</h3>
            <div class="graph-outer">
              <div
                id="graph-container"
                data-cfg='{"drag":true,"zoom":true,"depth":1,"scale":1.1,"repelForce":0.5,"centerForce":0.3,"linkDistance":30,"fontSize":0.6,"opacityScale":1,"showTags":false,"removeTags":[],"focusOnHover":false}'
              ></div>
              <svg
                version="1.1"
                id="global-graph-icon"
                xmlns="http://www.w3.org/2000/svg"
                xmlns:xlink="http://www.w3.org/1999/xlink"
                x="0px"
                y="0px"
                viewBox="0 0 55 55"
                fill="currentColor"
                xml:space="preserve"
              >
                <path
                  d="M49,0c-3.309,0-6,2.691-6,6c0,1.035,0.263,2.009,0.726,2.86l-9.829,9.829C32.542,17.634,30.846,17,29,17
	s-3.542,0.634-4.898,1.688l-7.669-7.669C16.785,10.424,17,9.74,17,9c0-2.206-1.794-4-4-4S9,6.794,9,9s1.794,4,4,4
	c0.74,0,1.424-0.215,2.019-0.567l7.669,7.669C21.634,21.458,21,23.154,21,25s0.634,3.542,1.688,4.897L10.024,42.562
	C8.958,41.595,7.549,41,6,41c-3.309,0-6,2.691-6,6s2.691,6,6,6s6-2.691,6-6c0-1.035-0.263-2.009-0.726-2.86l12.829-12.829
	c1.106,0.86,2.44,1.436,3.898,1.619v10.16c-2.833,0.478-5,2.942-5,5.91c0,3.309,2.691,6,6,6s6-2.691,6-6c0-2.967-2.167-5.431-5-5.91
	v-10.16c1.458-0.183,2.792-0.759,3.898-1.619l7.669,7.669C41.215,39.576,41,40.26,41,41c0,2.206,1.794,4,4,4s4-1.794,4-4
	s-1.794-4-4-4c-0.74,0-1.424,0.215-2.019,0.567l-7.669-7.669C36.366,28.542,37,26.846,37,25s-0.634-3.542-1.688-4.897l9.665-9.665
	C46.042,11.405,47.451,12,49,12c3.309,0,6-2.691,6-6S52.309,0,49,0z M11,9c0-1.103,0.897-2,2-2s2,0.897,2,2s-0.897,2-2,2
	S11,10.103,11,9z M6,51c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S8.206,51,6,51z M33,49c0,2.206-1.794,4-4,4s-4-1.794-4-4
	s1.794-4,4-4S33,46.794,33,49z M29,31c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S32.309,31,29,31z M47,41c0,1.103-0.897,2-2,2
	s-2-0.897-2-2s0.897-2,2-2S47,39.897,47,41z M49,10c-2.206,0-4-1.794-4-4s1.794-4,4-4s4,1.794,4,4S51.206,10,49,10z"
                ></path>
              </svg>
            </div>
            <div id="global-graph-outer">
              <div
                id="global-graph-container"
                data-cfg='{"drag":false,"zoom":true,"depth":-1,"scale":0.9,"repelForce":0.3732,"centerForce":0.088,"linkDistance":30,"fontSize":0.5375,"opacityScale":1,"showTags":true,"removeTags":[],"focusOnHover":true}'
              ></div>
            </div>
          </div>
          <div class="toc desktop-only">
            <button type="button" id="toc" class>
              <h3>Table des Matières</h3>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
                class="fold"
              >
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
            <div id="toc-content">
              <ul class="overflow">
                <li class="depth-0">
                  <a href="#fp32-to-fp16" data-for="fp32-to-fp16">fp32 to fp16</a>
                </li>
                <li class="depth-0">
                  <a href="#fp32-to-int8" data-for="fp32-to-int8">fp32 to int8</a>
                </li>
                <li class="depth-0">
                  <a href="#quantization-time" data-for="quantization-time">quantization time</a>
                </li>
                <li class="depth-0">
                  <a href="#methods-and-libraries" data-for="methods-and-libraries"
                    >Methods and libraries</a
                  >
                </li>
              </ul>
            </div>
          </div>
          <div class="backlinks">
            <h3>Liens retour</h3>
            <ul class="overflow">
              <li><a href="../thoughts/LLMs" class="internal">LLMs</a></li>
              <li><a href="../thoughts/quantization" class="internal">Quantization</a></li>
            </ul>
          </div>
        </div>
      </div>
      <div class="spacer"></div>
    </div>
    <div id="cursor-chat-layer"><input type="text" id="cursor-chat-box" /></div>
  </body>
  <script
    src="https://cdn.jsdelivr.net/npm/pseudocode@2.4.1/build/pseudocode.min.js"
    type="application/javascript"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
    type="application/javascript"
  ></script>
  <script type="module">
    document.addEventListener("nav", async () => {
      if (document.querySelector(".pseudocode.latex-pseudo")) {
        pseudocode.renderClass("latex-pseudo")
      }
    })
  </script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/copy-tex.min.js"
    type="application/javascript"
  ></script>
  <script type="application/javascript">
    var h = Object.create
    var f = Object.defineProperty
    var m = Object.getOwnPropertyDescriptor
    var d = Object.getOwnPropertyNames
    var S = Object.getPrototypeOf,
      y = Object.prototype.hasOwnProperty
    var x = (n, t) => () => (t || n((t = { exports: {} }).exports, t), t.exports)
    var v = (n, t, E, A) => {
      if ((t && typeof t == "object") || typeof t == "function")
        for (let F of d(t))
          !y.call(n, F) &&
            F !== E &&
            f(n, F, { get: () => t[F], enumerable: !(A = m(t, F)) || A.enumerable })
      return n
    }
    var w = (n, t, E) => (
      (E = n != null ? h(S(n)) : {}),
      v(t || !n || !n.__esModule ? f(E, "default", { value: n, enumerable: !0 }) : E, n)
    )
    var c = x((T, B) => {
      "use strict"
      B.exports = b
      function a(n) {
        return n instanceof Buffer
          ? Buffer.from(n)
          : new n.constructor(n.buffer.slice(), n.byteOffset, n.length)
      }
      function b(n) {
        if (((n = n || {}), n.circles)) return R(n)
        return n.proto ? A : E
        function t(F, r) {
          for (var u = Object.keys(F), D = new Array(u.length), i = 0; i < u.length; i++) {
            var e = u[i],
              l = F[e]
            typeof l != "object" || l === null
              ? (D[e] = l)
              : l instanceof Date
                ? (D[e] = new Date(l))
                : ArrayBuffer.isView(l)
                  ? (D[e] = a(l))
                  : (D[e] = r(l))
          }
          return D
        }
        function E(F) {
          if (typeof F != "object" || F === null) return F
          if (F instanceof Date) return new Date(F)
          if (Array.isArray(F)) return t(F, E)
          if (F instanceof Map) return new Map(t(Array.from(F), E))
          if (F instanceof Set) return new Set(t(Array.from(F), E))
          var r = {}
          for (var u in F)
            if (Object.hasOwnProperty.call(F, u) !== !1) {
              var D = F[u]
              typeof D != "object" || D === null
                ? (r[u] = D)
                : D instanceof Date
                  ? (r[u] = new Date(D))
                  : D instanceof Map
                    ? (r[u] = new Map(t(Array.from(D), E)))
                    : D instanceof Set
                      ? (r[u] = new Set(t(Array.from(D), E)))
                      : ArrayBuffer.isView(D)
                        ? (r[u] = a(D))
                        : (r[u] = E(D))
            }
          return r
        }
        function A(F) {
          if (typeof F != "object" || F === null) return F
          if (F instanceof Date) return new Date(F)
          if (Array.isArray(F)) return t(F, A)
          if (F instanceof Map) return new Map(t(Array.from(F), A))
          if (F instanceof Set) return new Set(t(Array.from(F), A))
          var r = {}
          for (var u in F) {
            var D = F[u]
            typeof D != "object" || D === null
              ? (r[u] = D)
              : D instanceof Date
                ? (r[u] = new Date(D))
                : D instanceof Map
                  ? (r[u] = new Map(t(Array.from(D), A)))
                  : D instanceof Set
                    ? (r[u] = new Set(t(Array.from(D), A)))
                    : ArrayBuffer.isView(D)
                      ? (r[u] = a(D))
                      : (r[u] = A(D))
          }
          return r
        }
      }
      function R(n) {
        var t = [],
          E = []
        return n.proto ? r : F
        function A(u, D) {
          for (var i = Object.keys(u), e = new Array(i.length), l = 0; l < i.length; l++) {
            var s = i[l],
              C = u[s]
            if (typeof C != "object" || C === null) e[s] = C
            else if (C instanceof Date) e[s] = new Date(C)
            else if (ArrayBuffer.isView(C)) e[s] = a(C)
            else {
              var o = t.indexOf(C)
              o !== -1 ? (e[s] = E[o]) : (e[s] = D(C))
            }
          }
          return e
        }
        function F(u) {
          if (typeof u != "object" || u === null) return u
          if (u instanceof Date) return new Date(u)
          if (Array.isArray(u)) return A(u, F)
          if (u instanceof Map) return new Map(A(Array.from(u), F))
          if (u instanceof Set) return new Set(A(Array.from(u), F))
          var D = {}
          t.push(u), E.push(D)
          for (var i in u)
            if (Object.hasOwnProperty.call(u, i) !== !1) {
              var e = u[i]
              if (typeof e != "object" || e === null) D[i] = e
              else if (e instanceof Date) D[i] = new Date(e)
              else if (e instanceof Map) D[i] = new Map(A(Array.from(e), F))
              else if (e instanceof Set) D[i] = new Set(A(Array.from(e), F))
              else if (ArrayBuffer.isView(e)) D[i] = a(e)
              else {
                var l = t.indexOf(e)
                l !== -1 ? (D[i] = E[l]) : (D[i] = F(e))
              }
            }
          return t.pop(), E.pop(), D
        }
        function r(u) {
          if (typeof u != "object" || u === null) return u
          if (u instanceof Date) return new Date(u)
          if (Array.isArray(u)) return A(u, r)
          if (u instanceof Map) return new Map(A(Array.from(u), r))
          if (u instanceof Set) return new Set(A(Array.from(u), r))
          var D = {}
          t.push(u), E.push(D)
          for (var i in u) {
            var e = u[i]
            if (typeof e != "object" || e === null) D[i] = e
            else if (e instanceof Date) D[i] = new Date(e)
            else if (e instanceof Map) D[i] = new Map(A(Array.from(e), r))
            else if (e instanceof Set) D[i] = new Set(A(Array.from(e), r))
            else if (ArrayBuffer.isView(e)) D[i] = a(e)
            else {
              var l = t.indexOf(e)
              l !== -1 ? (D[i] = E[l]) : (D[i] = r(e))
            }
          }
          return t.pop(), E.pop(), D
        }
      }
    })
    var P = Object.hasOwnProperty
    var g = w(c(), 1),
      I = (0, g.default)()
    function p(n) {
      return n.document.body.dataset.slug
    }
    var L = (n) => `${p(window)}-checkbox-${n}`
    document.addEventListener("nav", () => {
      document.querySelectorAll("input.checkbox-toggle").forEach((t, E) => {
        let A = L(E),
          F = (r) => {
            let u = r.target?.checked ? "true" : "false"
            localStorage.setItem(A, u)
          }
        t.addEventListener("change", F),
          window.addCleanup(() => t.removeEventListener("change", F)),
          localStorage.getItem(A) === "true" && (t.checked = !0)
      })
    })
  </script>
  <script type="application/javascript">
    function c() {
      let t = this.parentElement
      t.classList.toggle("is-collapsed")
      let l = t.classList.contains("is-collapsed") ? this.scrollHeight : t.scrollHeight
      t.style.maxHeight = l + "px"
      let o = t,
        e = t.parentElement
      for (; e; ) {
        if (!e.classList.contains("callout")) return
        let n = e.classList.contains("is-collapsed")
          ? e.scrollHeight
          : e.scrollHeight + o.scrollHeight
        ;(e.style.maxHeight = n + "px"), (o = e), (e = e.parentElement)
      }
    }
    function i() {
      let t = document.getElementsByClassName("callout is-collapsible")
      for (let s of t) {
        let l = s.firstElementChild
        if (l) {
          l.addEventListener("click", c), window.addCleanup(() => l.removeEventListener("click", c))
          let e = s.classList.contains("is-collapsed") ? l.scrollHeight : s.scrollHeight
          s.style.maxHeight = e + "px"
        }
      }
    }
    document.addEventListener("nav", i)
    window.addEventListener("resize", i)
  </script>
  <script type="module">
    let mermaidImport = undefined
    document.addEventListener("nav", async () => {
      if (document.querySelector("code.mermaid")) {
        mermaidImport ||= await import(
          "https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.7.0/mermaid.esm.min.mjs"
        )
        const mermaid = mermaidImport.default
        const darkMode = document.documentElement.getAttribute("saved-theme") === "dark"
        mermaid.initialize({
          startOnLoad: false,
          securityLevel: "loose",
          theme: darkMode ? "dark" : "default",
        })

        await mermaid.run({
          querySelector: ".mermaid",
        })
      }
    })
  </script>
  <script type="module">
    document.addEventListener("nav", async () => {
      const chat = await import("https://esm.sh/cursor-chat")
      chat.initCursorChat(`cursor-chat-room-${window.location.host + window.location.pathname}`, {
        triggerKey: ".",
      })
    })
  </script>
  <script src="../postscript.js" type="module"></script>
</html>
